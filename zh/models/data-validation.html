
<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Data Validation" lang="zh_CN" name="title" />
<meta content="validation rules,validation data,validation errors,data validation,credit card numbers,core libraries,password email,model fields,login field,model definition,php class,many different aspects,eight characters,letters and numbers,business rules,validation process,date validation,error messages,array,formatting" lang="zh_CN" name="keywords" />

    <title>数据验证 &mdash; CakePHP Cookbook 2.x 文档</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/app.js"></script>
    <script type="text/javascript" src="../_static/modernizr.foundation.js"></script>
    <script type="text/javascript" src="../_static/foundation.js"></script>
    <link rel="top" title="CakePHP Cookbook 2.x 文档" href="../index.html" />
    <link rel="up" title="模型" href="../models.html" />
    <link rel="next" title="从控制器验证数据" href="data-validation/validating-data-from-the-controller.html" />
    <link rel="prev" title="删除数据" href="deleting-data.html" />
<link href="../_static/favicon.ico" type="image/x-icon" rel="icon" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="alternate" hreflang="en" href="../../en/models/data-validation.html" /><link rel="alternate" hreflang="pt" href="../../pt/models/data-validation.html" /><link rel="alternate" hreflang="es" href="../../es/models/data-validation.html" /><link rel="alternate" hreflang="ja" href="../../ja/models/data-validation.html" /><link rel="alternate" hreflang="fr" href="../../fr/models/data-validation.html" />

<link rel="search" type="application/opensearchdescription+xml" title="CakePHP Book 2.x Search" href="../_static/opensearchdescription-book-2-x.xml">
<script type="text/javascript">
window.lang = "zh_CN";
</script>

  </head>
  <body>

<div id="container">

<div id="cakephp-global-navigation">
	<ul>
		<li class="main"><a href="http://cakephp.org">CakePHP</a></li>
		<li class="primary"><a href="#" class="empty">Downloads</a>
			<ul class="second-level">
				<li><a href="https://github.com/cakephp/cakephp/tags">Releases</a></li>
				<li><a href="http://pear.cakephp.org">Pear channel</a></li>
			</ul>
		</li>
		<li class="primary"><a href="#" class="empty">Documentation</a>
			<ul class="second-level">
				<li><a href="http://api.cakephp.org">API</a></li>
				<li><a href="http://book.cakephp.org">Book</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://community.cakephp.org">Community</a>
			<ul class="second-level">
				<li><a href="http://webchat.freenode.net/?channels=cakephp&uio=MT1mYWxzZSY5PXRydWUmMTE9MjQ2b8">Help &amp; Support</a></li>
				<li><a href="https://github.com/cakephp/cakephp/issues">Issues</a></li>
				<li><a href="http://bakery.cakephp.org">The Bakery</a></li>
				<li><a href="http://stackoverflow.com/tags/cakephp">Stack Overflow</a></li>
				<li><a href="http://www.facebook.com/groups/cake.community">Facebook Group</a></li>
				<li><a href="http://goo.gl/mSC0s">Google+ Community</a></li>
				<li><a href="http://www.youtube.com/user/CakePHP">YouTube Channel</a></li>
				<li><a href="http://podcast.cakephp.org">CakePHP Podcast</a></li>
				<li><a href="http://twitter.com/CakePHP">Follow us on Twitter</a></li>
				<li><a href="http://groups.google.com/group/cake-php">Google Group</a></li>
				<li><a href="http://github.com/cakephp/cakephp/contributors">Contributors</a></li>
				<li><a href="http://plugins.cakephp.org">Plugins &amp; Packages</a></li>
				<li><a href="http://community.cakephp.org/get-involved">Get Involved</a></li>
				<li><a href="http://community.cakephp.org/guidelines">Guidelines</a></li>
				<li><a href="http://cakefest.org">CakeFest</a></li>
				<li><a href="http://cakephp.org/logos">Logo</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://cakephp.org/services">Services</a>
			<ul class="second-level">
				<li><a href="http://cakephp.org/services/certification">Certification</a></li>
				<li><a href="http://cakephp.org/services/consultation">Consultation</a></li>
				<li><a href="http://cakephp.org/services/support">Support</a></li>
				<li><a href="http://training.cakephp.org">Training</a></li>
			</ul>
		</li>
	</ul>
</div>

<div class="masthead">
	<div class="header-backing"></div>
	<div class="searchbar row">
		<div class="columns three phone-one">
			<a class="logo" href="../contents.html">
			<img src="../_static/cake-logo.png" alt="CakePHP" width="70" />
			</a>
		</div>
		
<div id="searchbox" class="columns nine phone-three">

	<form id="searchform" class="search" action="../search.html" method="get">
		<input class="search-input" autocomplete="off" type="search" name="q" size="18" />
		<input class="search-submit search-big button red" type="submit" value="搜索" />
		<input type="hidden" name="check_keywords" value="yes" />
		<input type="hidden" name="area" value="default" />

		<a href="#" id="tablet-nav" class="show-on-phones pale button small">Nav</a>
	</form>

</div>
	</div>
</div>
<div class="breadcrumb-header">
	<div class="related row">
		<div class="columns three root-link">
			<a href="../contents.html">Cookbook 2.x</a>
		</div>
		<div class="columns nine">
			<ul class="inline breadcrumb">
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../models.html" accesskey="U" itemprop="url"><span itemprop="title">模型</span></a>
			</li>
			</ul>
			<div class="versions dropdown">
				<a href="#">2.x Book</a>
				<ul>
					<li><a href="http://book.cakephp.org/3.0/en">3.0 Book</a></li>
					<li><a href="http://book.cakephp.org/1.3/zh_CN/">1.3 Book</a></li>
					<li><a href="http://book.cakephp.org/1.2/zh_CN/">1.2 Book</a></li>
					<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
				</ul>
			</div>

			<div class="languages dropdown">
				<a href="#">zh_CN</a>

				<ul>
				
					<li><a href="../../en/models/data-validation.html">en</a></li>
				
					<li><a href="../../pt/models/data-validation.html">pt</a></li>
				
					<li><a href="../../es/models/data-validation.html">es</a></li>
				
					<li><a href="../../ja/models/data-validation.html">ja</a></li>
				
					<li><a href="../../fr/models/data-validation.html">fr</a></li>
				
					<li></li>
				
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="content row">
	<div class="document columns nine push-three">
		<div class="body"><a class="button pale improve" href="https://github.com/cakephp/docs/edit/master/zh/models/data-validation.rst" target="_blank">Improve this Doc</a>
  <div class="section" id="id1">
<h1>数据验证<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>数据验证是任何应用程序的重要组成部分，因为这有助于确保模型中的数据符合应用程序的
业务规则。例如，你也许要确保密码至少有八个字符，或者用户名是唯一的。定义验证规则
使得表单的处理容易得多得多。</p>
<p>验证过程包含很多方面。本节中我们只涉及模型中的部分。基本上这意味着:当你调用模型
的 save() 方法时会发生什么。有关如何处理验证错误显示的更多信息，请参看
<a class="reference internal" href="../core-libraries/helpers/form.html"><em>FormHelper 助件</em></a> 。</p>
<p>数据验证的第一步是在模型中建立验证规则。这需要用到在模型中定义的 Model::validate
数组，例如:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">AppModel</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在上面的例子中，<tt class="docutils literal"><span class="pre">$validate</span></tt> 数组被加到 User 模型中，但此数组还不包含任何验证规
则。假设 users 表中有login，password，email和born这些字段，下面的例子中是一些针
对这些字段的简单验证规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">AppModel</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphaNumeric&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span>
        <span class="s1">&#39;born&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;date&#39;</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面的例子展示了验证规则如何作用于模型的字段。login 字段只接受字母和数字，email
应当是合法的电子邮件格式，以及 born 应当是合法的日期。定义了验证规则之后，如果提
交的数据不符合定义的规则，CakePHP 就能够在表单中自动显示错误信息。</p>
<p>CakePHP 有许多验证规则，使用起来相当容易。一些内置的验证规则可以让你检查电子邮件，
网址和信用卡的格式 – 不过我们稍后才会详细介绍这些。</p>
<p>这是一个利用内置验证规则的更复杂的例子:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">AppModel</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;alphaNumeric&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphaNumeric&#39;</span><span class="p">,</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Letters and numbers only&#39;</span>
            <span class="p">),</span>
            <span class="s1">&#39;between&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;between&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Between 5 to 15 characters&#39;</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;minLength&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">),</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Minimum 8 characters long&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span>
        <span class="s1">&#39;born&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Enter a valid date&#39;</span><span class="p">,</span>
            <span class="s1">&#39;allowEmpty&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>login 字段有两个验证规则:它只能包含字母和数字，长度介于5到15之间。password 字段
至少要有8个字符长。email 字段必须是合法的电子邮件，而 born 字段必须是合法的日期。
另外，请注意有关这些验证规则失败时 CakePHP 显示的错误信息。</p>
<p>如上例所示，一个字段可以有多个验证规则。另外，如果内置的规则不符合你的要求，在必
要时总是可以增加自己的验证规则。</p>
<p>现在你应该已经明白验证大致是如何工作的了，让我们再来看看这些规则在模型中是如何定
义的。定义验证规则有三种不同的方式: 简单的数组，每个字段带一个规则，每个字段带有
多个规则。</p>
<div class="section" id="id2">
<h2>简单的规则<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>正如名称所说的，这是定义验证规则最简单的方式。定义其规则的通常语法为:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;fieldName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ruleName&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>其中，&#8217;fieldName&#8217; 是定义的规则针对的字段名称，&#8217;ruleName&#8217; 是预先定义的规则名称，
比如&#8217;alphaNumeric&#8217;，&#8217;email&#8217; 或者 &#8216;isUnique&#8217;。</p>
<p>例如，为确保用户提供正确格式的电子邮件地址，你可以使用这个规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;user_email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>每个字段带一个规则<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>这种定义方式可以更好地控制验证规则工作。但在讨论这些之前，让我们先来看看给一个字
段加一个规则的常用模式:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// 或者: array(&#39;ruleName&#39;, &#39;param1&#39;, &#39;param2&#39; ...)</span>
    <span class="s1">&#39;fieldName1&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ruleName&#39;</span><span class="p">,</span>
        <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="s1">&#39;allowEmpty&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="c1">// 或者: &#39;update&#39;</span>
        <span class="s1">&#39;on&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Your Error Message&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>&#8216;rule&#8217; 键是必需的。如果只设置 &#8216;required&#8217; =&gt; true，表单验证不会正常工作。这是因为
&#8216;required&#8217; 实际上不是一个规则。</p>
<p>这里你可以看到，每个字段(上面只显示了一个字段)与一个数组联系在一起，该数组有5个
键: &#8216;rule&#8217;、&#8217;required&#8217;、&#8217;allowEmpty&#8217;、&#8217;on&#8217; 和 &#8216;message&#8217;。让我们看一下他们的具体
含义。</p>
<div class="section" id="rule">
<h3>rule<a class="headerlink" href="#rule" title="永久链接至标题">¶</a></h3>
<p>&#8216;rule&#8217; 键定义了验证的方法，可以是单一的值，也可以是一个数组。指定的 &#8216;rule&#8217; 可以
是模型的方法名称，核心验证类的方法，或者正则表达式。关于在缺省情况下可用的规则的
更多信息，请参看 <a class="reference internal" href="#core-validation-rules"><em>核心验证规则</em></a>。</p>
<p>如果某个规则不需要带任何参数，&#8217;rule&#8217; 就可以是单一值，例如:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphaNumeric&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>如果某个规则需要带一些参数(比如最大值，最小值或者范围)，&#8217;rule&#8217; 就应当是一个数组:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;minLength&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>谨记，&#8217;rule&#8217; 对于基于数组定义的规则是必需的。</p>
</div>
<div class="section" id="required">
<h3>required<a class="headerlink" href="#required" title="永久链接至标题">¶</a></h3>
<p>这个键接受布尔值，<tt class="docutils literal"><span class="pre">create</span></tt> 或者 <tt class="docutils literal"><span class="pre">update</span></tt>。把这个键置为 <tt class="docutils literal"><span class="pre">true</span></tt> 就会认为该字
段总是必需的。而把它设成 <tt class="docutils literal"><span class="pre">create</span></tt> 或 <tt class="docutils literal"><span class="pre">update</span></tt> 就会认为该字段只在创建或者更新
操作时是必需的。如果 &#8216;required&#8217; 的值为真，则该字段在数据数组中必须存在。例如，如
果验证规则如下定义:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphaNumeric&#39;</span><span class="p">,</span>
        <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>传给模型的 save() 方法的数据中必须含有 login 字段的数据，否则验证就会失败。该键
的缺省值为布尔类型 false。</p>
<p><tt class="docutils literal"><span class="pre">required</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt> 和验证规则 <tt class="docutils literal"><span class="pre">notBlank()</span></tt> 并不是一回事。
<tt class="docutils literal"><span class="pre">required</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt> 意味着数组的 <em>键</em> 必须存在 - 这不代表必须有值。所以，如果字
段在数据集中不存在，验证就会失败，但如果提交的值为空(&#8216;&#8217;)，验证有可能(取决于规则)
会成功。</p>
<div class="versionchanged">
<p><span class="versionmodified">在 2.1 版更改: </span>增加了对 <tt class="docutils literal"><span class="pre">create</span></tt> 和 <tt class="docutils literal"><span class="pre">update</span></tt> 的支持。</p>
</div>
</div>
<div class="section" id="allowempty">
<h3>allowEmpty<a class="headerlink" href="#allowempty" title="永久链接至标题">¶</a></h3>
<p>如果设为 <tt class="docutils literal"><span class="pre">false</span></tt> ，字段的值必须为 <em>非空</em>，而 &#8220;nonempty&#8221; 定义为
<tt class="docutils literal"><span class="pre">!empty($value)</span> <span class="pre">||</span> <span class="pre">is_numeric($value)</span></tt> 。对数字的检查是为了使 CakePHP 能正确处
理 <tt class="docutils literal"><span class="pre">$value</span></tt> 为零的情况。</p>
<p><tt class="docutils literal"><span class="pre">required</span></tt> 和 <tt class="docutils literal"><span class="pre">allowEmpty</span></tt> 的区别可能令人迷惑。<tt class="docutils literal"><span class="pre">'required'</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt> 意味着
在 <tt class="docutils literal"><span class="pre">$this-&gt;data``中没有该字段的</span> <span class="pre">*键*</span> <span class="pre">，你就不能保存模型(使用</span> <span class="pre">``isset</span></tt> 检查)；
然而，<tt class="docutils literal"><span class="pre">'allowEmpty'</span> <span class="pre">=&gt;</span> <span class="pre">false</span></tt> 正如前所述，确保当前字段的 <em>值</em> 不为空。</p>
</div>
<div class="section" id="on">
<h3>on<a class="headerlink" href="#on" title="永久链接至标题">¶</a></h3>
<p>&#8216;on&#8217;键可以设置为下列值之一: &#8216;update&#8217; 或者 &#8216;create&#8217; 。这提供了一种机制，允许某个
规则要么在创建新记录时起作用，要么在更新记录时起作用。</p>
<p>如果一条规则含有 &#8216;on&#8217; =&gt; &#8216;create&#8217;，该规则只会在新记录创建时起作用。类似的，如果
定义为 &#8216;on&#8217; =&gt; &#8216;update&#8217; ，则只会在记录更新时起作用。</p>
<p>&#8216;on&#8217; 的缺省值是 null。当 &#8216;on&#8217; 为 null 时，该规则在创建和更新时都会起作用。</p>
</div>
<div class="section" id="message">
<h3>message<a class="headerlink" href="#message" title="永久链接至标题">¶</a></h3>
<p>message 键是为规则定义验证失败时显示的错误信息:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;minLength&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;密码至少8个字符长&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">当验证失败默认显示的消息是&#8221;This field cannot be left blank.&#8221;</p>
</div>
</div>
</div>
<div class="section" id="id4">
<h2>每个字段多条规则<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>上面给出的方法比简单的规则赋值提供了更多的灵活性，但我们可以更进一步，可以更精细
地控制数据验证。下面介绍的方法可以让我们对一个模型字段设置多条验证规则。</p>
<p>如果想要给一个字段设置多条验证规则，大致这样:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;fieldName&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;ruleName&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ruleName&#39;</span><span class="p">,</span>
            <span class="c1">// 额外的键，比如 on，required 等等，放在这里 ...</span>
        <span class="p">),</span>
        <span class="s1">&#39;ruleName2&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ruleName2&#39;</span><span class="p">,</span>
            <span class="c1">// 额外的键，比如 on，required 等等，放在这里 ...</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>可以看到，这很象我们在前一节做的。在前一节，对每个字段我们只有一个数组的验证参数。
而现在，每个&#8217;字段名&#8217;有一个数组的规则索引，每个&#8217;规则名称&#8217;有一个单独数组的验证参数。</p>
<p>用一个实际的例子能够更好地说明:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;loginRule-1&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphaNumeric&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Only alphabets and numbers allowed&#39;</span><span class="p">,</span>
         <span class="p">),</span>
        <span class="s1">&#39;loginRule-2&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;minLength&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Minimum length of 8 characters&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>上面的例子对 login 字段设置了2个规则: loginRule-1和 loginRule-2。可以看到，每个
规则都由一个随意的名字标识。</p>
<p>当对一个字段使用多条规则时，&#8217;required&#8217; 和 &#8216;allowEmpty&#8217; 键只需在第一条规则中设置
一次。</p>
<div class="section" id="last">
<h3>last<a class="headerlink" href="#last" title="永久链接至标题">¶</a></h3>
<p>当一个字段有多条规则时，缺省情况下，如果一条规则验证失败，那么这条规则的错误信息
就会返回，而该字段的其它规则就不会继续执行了。如果你希望,即使在一条规则验证失败
时，验证也继续执行，就把该条规则的 <tt class="docutils literal"><span class="pre">last</span></tt> 设置为 <tt class="docutils literal"><span class="pre">false</span></tt>。</p>
<p>在下面的例子中，即使 &#8220;rule1&#8221; 验证失败，&#8221;rule2&#8221; 也会继续执行，而且，如果 &#8220;rule2&#8221;
也失败，则两条失败规则的错误信息都会返回:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphaNumeric&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Only alphabets and numbers allowed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;last&#39;</span>    <span class="o">=&gt;</span> <span class="k">false</span>
         <span class="p">),</span>
        <span class="s1">&#39;rule2&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;minLength&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Minimum length of 8 characters&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>当使用这种数组格式设置验证规则时，可以不带 <tt class="docutils literal"><span class="pre">message</span></tt> 键。请看下面的例子:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;Only alphabets and numbers allowed&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphaNumeric&#39;</span><span class="p">,</span>
         <span class="p">),</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>如果 <tt class="docutils literal"><span class="pre">alphaNumeric</span></tt> 规则验证失败，因为没有设置 <tt class="docutils literal"><span class="pre">message</span></tt> 键，该规则的键
&#8216;Only alphabets and numbers allowed&#8217; 就会作为错误信息返回。</p>
</div>
</div>
<div class="section" id="id5">
<h2>自定义验证规则<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>如果到此还没有找到你需要的验证规则，可以创建自己的验证规则。通过两种方法: 自定义
正则表达式，或者创建自定义验证方法。</p>
<div class="section" id="id6">
<h3>使用自定义的正则表达式进行验证<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p>如果可以使用正则表达式匹配需要的验证，那么可以设置自定义正则表达式作为字段验证规
则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/^[a-z0-9]{3,}$/i&#39;</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Only letters and integers, min 3 characters&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>上面的例子检查 login 字段是否只包含字母和数字，至少3个字符。</p>
<p><tt class="docutils literal"><span class="pre">rule</span></tt> 中的正则表达式必须由斜线界定起始。最后一个斜线之后的 &#8216;i&#8217; 是可以省略的，
表示正则表达式是大小写无关。</p>
</div>
<div class="section" id="id7">
<h3>添加自定义的验证方法<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>有时候使用正则表达式检查数据是不够的。比如，如果你想确保一个折扣号码只能使用25次，
就需要添加自己的验证函数，如下所示:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">AppModel</span> <span class="p">{</span>

    <span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;promotion_code&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;limitDuplicates&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;This code has been used too many times.&#39;</span>
        <span class="p">)</span>
    <span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">limitDuplicates</span><span class="p">(</span><span class="nv">$check</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $check 的值为: array(&#39;promotion_code&#39; =&gt; &#39;some-value&#39;)</span>
        <span class="c1">// $limit 的值为: 25</span>
        <span class="nv">$existing_promo_count</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="nv">$check</span><span class="p">,</span>
            <span class="s1">&#39;recursive&#39;</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">));</span>
        <span class="k">return</span> <span class="nv">$existing_promo_count</span> <span class="o">&lt;</span> <span class="nv">$limit</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>要验证的当前字段会以关联数组的形式传入函数的第一个参数，字段名为键，提交的数据为
值。</p>
<p>如果要给验证函数传入其他参数，需要在 &#8216;rule&#8217; 数组中加入更多元素，再在你的函数中
(在主要的 <tt class="docutils literal"><span class="pre">$check</span></tt> 参数之后)作为其他参数处理。</p>
<p>自定义的验证函数可以定义在模型中(正如上面的例子)，也可以定义在一个模型实现的行为
中。这包括映射方法(<em>mapped method</em>)。</p>
<p>模型/行为方法会优先考虑，之后才会查找 <tt class="docutils literal"><span class="pre">Validation</span></tt> 类的方法。这意味着你可以重
载现存的验证方法(例如 <tt class="docutils literal"><span class="pre">alphaNumeric()</span></tt>)，或者在应用程序级别(通过给
<tt class="docutils literal"><span class="pre">AppModel</span></tt> 添加方法)，或者在模型级别。</p>
<p>当编写一个可以用于多个字段的验证规则时，注意从 $check 提取字段的值。$check 数组
传入时以表单名为键，以字段的值为其值。要被验证的整个记录保存在 $this-&gt;data 成员
变量中:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">AppModel</span> <span class="p">{</span>

    <span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;slug&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphaNumericDashUnderscore&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Slug can only be letters,&#39;</span> <span class="o">.</span>
                <span class="s1">&#39; numbers, dash and underscore&#39;</span>
        <span class="p">)</span>
    <span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">alphaNumericDashUnderscore</span><span class="p">(</span><span class="nv">$check</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $data 数组用表单字段名为键传入</span>
        <span class="c1">// 必须提取其值，使函数通用</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$check</span><span class="p">);</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

        <span class="k">return</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;|^[0-9a-zA-Z_-]*$|&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">自定义的验证方法必须有 <tt class="docutils literal"><span class="pre">public</span></tt>。<tt class="docutils literal"><span class="pre">protected</span></tt> 和 <tt class="docutils literal"><span class="pre">private</span></tt> 的验证方法是
不支持的。</p>
</div>
<p>如果值合法，方法应该返回 <tt class="docutils literal"><span class="pre">true</span></tt>。如果验证失败，返回 <tt class="docutils literal"><span class="pre">false</span></tt>。其它合法的返回
值可以是字符串，作为错误信息显示。返回字符串意味着验证失败。字符串会覆盖
$validate 数组中设置的信息，作为字段不合法的原因，显示在视图的表单中。</p>
</div>
</div>
<div class="section" id="id8">
<h2>动态改变验证规则<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<p>使用 <tt class="docutils literal"><span class="pre">$validate</span></tt> 属性来声明验证规则是为一个类定义静态规则的好方法。但难免会有
一些情况下，你想对预先定义的规则集动态添加、修改或删除验证规则。</p>
<p>所有的验证规则都保存在一个 <tt class="docutils literal"><span class="pre">ModelValidator</span></tt> 对象中，你模型中每个字段的验证规则
集都在这里。定义新的规则简单到只需告诉该对象来存储需要的字段新的验证方法。</p>
<div class="section" id="id9">
<h3>添加新的验证规则<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">2.2 新版功能.</span></p>
</div>
<p><tt class="docutils literal"><span class="pre">ModelValidator</span></tt> 对象允许多种方法添加新字段到集合中。第一种是使用 <tt class="docutils literal"><span class="pre">add</span></tt> 方法:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// 在一个模型类中</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;notBlank&#39;</span><span class="p">,</span>
    <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;create&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
<p>这会为模型中的 <cite>password</cite> 字段添加一个规则。可以链接多个 add 方法来添加任意多个
规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// 在一个模型类中</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;notBlank&#39;</span><span class="p">,</span>
        <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;create&#39;</span>
    <span class="p">))</span>
    <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;between&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Password should be at least 8 chars long&#39;</span>
    <span class="p">));</span>
</pre></div>
</div>
<p>也可以为一个字段一次添加多个规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;notBlank&#39;</span><span class="p">,</span>
        <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;create&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;between&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphanumeric&#39;</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>或者，你可以用 validator 对象使用存取数组的方式直接对字段设置验证规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$validator</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">();</span>
<span class="nv">$validator</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;unique&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;isUnique&#39;</span><span class="p">,</span>
        <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;create&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;alphanumeric&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphanumeric&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>修改现存的验证规则<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">2.2 新版功能.</span></p>
</div>
<p>使用 validator 对象也可以修改当前的验证规则。有若干种方法可以修改现存规则，
对一个字段添加验证方法，或者从一个字段的验证规则集合中完全删除一条规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// 在一个模型类中</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setRule</span><span class="p">(</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
<span class="p">));</span>
</pre></div>
</div>
<p>你也可以用类似的方法完全替换掉一个字段的所有规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// 在一个模型类中</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
    <span class="s1">&#39;otherRule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>如果只要改变一个规则中的一个属性，可以直接设置 <tt class="docutils literal"><span class="pre">CakeValidationRule</span></tt> 对象的属性:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// 在一个模型类中</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">getRule</span><span class="p">(</span><span class="s1">&#39;required&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">message</span> <span class="o">=</span> <span class="s1">&#39;This field cannot be left blank&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>在定义验证规则属性可以使用的数组键，就可以作为 <tt class="docutils literal"><span class="pre">CakeValidationRule</span></tt> 中的属性的
名字，比如 &#8216;message&#8217; 和 &#8216;allowEmpty&#8217;。</p>
<p>类似于对集合添加新规则，也可以用存取数组的方式修改现存的规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$validator</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">();</span>
<span class="nv">$validator</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">][</span><span class="s1">&#39;unique&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;isUnique&#39;</span><span class="p">,</span>
    <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;create&#39;</span>
<span class="p">);</span>

<span class="nv">$validator</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">][</span><span class="s1">&#39;unique&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">last</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="nv">$validator</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">][</span><span class="s1">&#39;unique&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">message</span> <span class="o">=</span> <span class="s1">&#39;名字已经被占用&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>从集合中删除规则<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">2.2 新版功能.</span></p>
</div>
<p>可以完全删除一个字段的所有规则，或者一个字段规则集合中的一条规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// 完全删除一个字段的所有规则</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>

<span class="c1">// 删除字段 password 的 &#39;required&#39; 规则</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>另外，可以用数组访问的方式从集合中删除规则:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$validator</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">();</span>
<span class="c1">// 完全删除一个字段的所有规则</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$validator</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]);</span>

<span class="c1">// 完删除 password 字段的 &#39;required&#39; 规则</span>
 <span class="nb">unset</span><span class="p">(</span><span class="nv">$validator</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">][</span><span class="s1">&#39;required&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="core-validation-rules">
<span id="id12"></span><h2>核心验证规则<a class="headerlink" href="#core-validation-rules" title="永久链接至标题">¶</a></h2>
<dl class="class">
<dt id="Validation">
<em class="property">class </em><tt class="descname">Validation</tt><a class="headerlink" href="#Validation" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>CakePHP 的 Validation 类有许多验证规则，可以使模型数据的验证容易得多。这个类有许
多常用的验证方法，就可以不必自己写了。下面，可以看到所有验证规则的完整列表，以及
如何使用的例子。</p>
<dl class="staticmethod">
<dt id="Validation::alphaNumeric">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">alphaNumeric</tt><big>(</big><em>mixed $check</em><big>)</big><a class="headerlink" href="#Validation::alphaNumeric" title="永久链接至目标">¶</a></dt>
<dd><p>字段的数据只能含有字母和数字。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alphaNumeric&#39;</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Usernames must only contain letters and numbers.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::between">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">between</tt><big>(</big><em>string $check</em>, <em>integer $min</em>, <em>integer $max</em><big>)</big><a class="headerlink" href="#Validation::between" title="永久链接至目标">¶</a></dt>
<dd><p>字段的数据长度必须在指定的数字范围内。必须提供最小值和最大值。
Uses = not。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;between&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Passwords must be between 5 and 15 characters long.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>数据的长度是&#8221;数据的字符串表示方式的字节数&#8221;。注意，在处理非 ASCII
字符时可能会长于数据的字符数。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::blank">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">blank</tt><big>(</big><em>mixed $check</em><big>)</big><a class="headerlink" href="#Validation::blank" title="永久链接至目标">¶</a></dt>
<dd><p>这个规则用来保证字段为空或者只含有空字符。空字符包括空格、制表符、回车和换行。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blank&#39;</span><span class="p">,</span>
        <span class="s1">&#39;on&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;create&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::boolean">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">boolean</tt><big>(</big><em>string $check</em><big>)</big><a class="headerlink" href="#Validation::boolean" title="永久链接至目标">¶</a></dt>
<dd><p>字符的数据必须是布尔值。合法的值为 true 或 false，整数0或1，或者字符串&#8216;0&#8217;或
&#8216;1&#8217;。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;myCheckbox&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;boolean&#39;</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;myCheckbox 的值不正确&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::cc">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">cc</tt><big>(</big><em>mixed $check</em>, <em>mixed $type = 'fast'</em>, <em>boolean $deep = false</em>, <em>string $regex = null</em><big>)</big><a class="headerlink" href="#Validation::cc" title="永久链接至目标">¶</a></dt>
<dd><p>这个规则用来检查数据是否是一个合法的信用卡号码。它接受3个参数: &#8216;type&#8217;、
&#8216;deep&#8217; 和 &#8216;regex&#8217;。</p>
<p>&#8216;type&#8217; 键可以赋值为 &#8216;fast&#8217;，&#8217;all&#8217; 或者任意下面的值:</p>
<ul class="simple">
<li>amex</li>
<li>bankcard</li>
<li>diners</li>
<li>disc</li>
<li>electron</li>
<li>enroute</li>
<li>jcb</li>
<li>maestro</li>
<li>mc</li>
<li>solo</li>
<li>switch</li>
<li>visa</li>
<li>voyager</li>
</ul>
<p>如果 &#8216;type&#8217; 设置为 &#8216;fast&#8217;，数据就会用主要的信用卡号码格式来检查。设置 &#8216;type&#8217;
为 &#8216;all&#8217;，就会检查所有信用卡类型。你也可以设置 type 为一个你想匹配的类型的数
组。</p>
<p>&#8216;deep&#8217; 键应当设置为布尔值。如果设为 true，就会检查信用卡的 Luhn 算法(
<a class="reference external" href="http://en.wikipedia.org/wiki/Luhn_algorithm">http://en.wikipedia.org/wiki/Luhn_algorithm</a>
)。缺省值为 false。</p>
<p>&#8216;regex&#8217; 键允许提供自定义正则表达式，用来验证信用卡号码:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;ccnumber&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;visa&#39;</span><span class="p">,</span> <span class="s1">&#39;maestro&#39;</span><span class="p">),</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The credit card number you supplied was invalid.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::comparison">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">comparison</tt><big>(</big><em>mixed $check1</em>, <em>string $operator = null</em>, <em>integer $check2 = null</em><big>)</big><a class="headerlink" href="#Validation::comparison" title="永久链接至目标">¶</a></dt>
<dd><p>Comparison 用来比较数值。它支持&#8221;大于&#8221;、&#8221;小于&#8221;、&#8221;大于等于&#8221;、&#8221;小于等于&#8221;、
&#8220;等于&#8221;、&#8221;不等于&#8221;。下面是一些例子:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;age&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;comparison&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Must be at least 18 years old to qualify.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;age&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;comparison&#39;</span><span class="p">,</span> <span class="s1">&#39;greater or equal&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Must be at least 18 years old to qualify.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::custom">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">custom</tt><big>(</big><em>mixed $check</em>, <em>string $regex = null</em><big>)</big><a class="headerlink" href="#Validation::custom" title="永久链接至目标">¶</a></dt>
<dd><p>当需要自定义的正则表达式时使用:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;infinite&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;custom&#39;</span><span class="p">,</span> <span class="s1">&#39;\u221E&#39;</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please enter an infinite number.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::date">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">date</tt><big>(</big><em>string $check</em>, <em>mixed $format = 'ymd'</em>, <em>string $regex = null</em><big>)</big><a class="headerlink" href="#Validation::date" title="永久链接至目标">¶</a></dt>
<dd><p>这个规则确保数据是以合法的日期格式输入的。可以传入单个参数(可以是一个数组)，
用来检查输入日期的格式。参数的值可以为下列之一:</p>
<ul class="simple">
<li>&#8216;dmy&#8217; 例如27-12-2006或者27-12-06(分隔符可以是空格，英文句号，破折号，斜线)</li>
<li>&#8216;mdy&#8217; 例如12-27-2006或者12-27-06(分隔符可以是空格，英文句号，破折号，斜线)</li>
<li>&#8216;ymd&#8217; 例如2006-12-27或者06-12-27(分隔符可以是空格，英文句号，破折号，斜线)</li>
<li>&#8216;dMy&#8217; 例如27 December 2006或者27 Dec 2006</li>
<li>&#8216;Mdy&#8217; 例如December 27, 2006或者Dec 27, 2006(逗号可以省略)</li>
<li>&#8216;My&#8217;  例如(December 2006或者Dec 2006)</li>
<li>&#8216;my&#8217;  例如12/2006或者12/06(分隔符可以是空格，英文句号，破折号，斜线)</li>
</ul>
<p>如果没有提供该键，将使用缺省的键值 &#8216;ymd&#8217;:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;born&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;ymd&#39;</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Enter a valid date in YY-MM-DD format.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;allowEmpty&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>虽然很多数据存储方式要求某个特定的日期格式，但是也许应该考虑承担麻烦的部分，
接受众多的日期格式，然后再尝试进行转换，而不是强制用户使用指定的格式。能为用
户做的越多越好。</p>
<div class="versionchanged">
<p><span class="versionmodified">在 2.4 版更改: </span>加入 <tt class="docutils literal"><span class="pre">ym</span></tt> 和 <tt class="docutils literal"><span class="pre">y</span></tt> 格式。</p>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::datetime">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">datetime</tt><big>(</big><em>array $check</em>, <em>mixed $dateFormat = 'ymd'</em>, <em>string $regex = null</em><big>)</big><a class="headerlink" href="#Validation::datetime" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则确保数据是合法的 datetime 格式。可以传入一个参数(可以是数组)
来指定日期的格式。参数的值可以是下面的一个或多个:</p>
<ul class="simple">
<li>&#8216;dmy&#8217; 例如27-12-2006或者27-12-06(分隔符可以是空格，英文句号，破折号，斜线)</li>
<li>&#8216;mdy&#8217; 例如12-27-2006或者12-27-06(分隔符可以是空格，英文句号，破折号，斜线)</li>
<li>&#8216;ymd&#8217; 例如2006-12-27或者06-12-27(分隔符可以是空格，英文句号，破折号，斜线)</li>
<li>&#8216;dMy&#8217; 例如27 December 2006或者27 Dec 2006</li>
<li>&#8216;Mdy&#8217; 例如December 27, 2006或者Dec 27, 2006(逗号可以省略)</li>
<li>&#8216;My&#8217; 例如(December 2006或者Dec 2006)</li>
<li>&#8216;my&#8217; 例如12/2006或者12/06(分隔符可以是空格，英文句号，破折号，斜线)</li>
</ul>
<p>如果没有提供该键，将使用缺省的键值 &#8216;ymd&#8217;:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;birthday&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;dmy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please enter a valid date and time.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>也可以传入第二个参数，指定一个定制的正则表达式。如果使用这个参数，这就会是
执行的唯一验证。</p>
<p>注意，和 date()不同，datetime()会验证日期和时间。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::decimal">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">decimal</tt><big>(</big><em>integer $check</em>, <em>integer $places = null</em>, <em>string $regex = null</em><big>)</big><a class="headerlink" href="#Validation::decimal" title="永久链接至目标">¶</a></dt>
<dd><p>这个规则确保数据是合法的 decimal 数值。可以传入参数来指定小数点后需要多少位
小数。如果没有参数传入，数据将会当做科学计数法的浮点数来验证，这样的话，如果
小数点后面没有数字，验证就会失败:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;price&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;decimal&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::email">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">email</tt><big>(</big><em>string $check</em>, <em>boolean $deep = false</em>, <em>string $regex = null</em><big>)</big><a class="headerlink" href="#Validation::email" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则检查数据是否是合法的电子邮件地址。给规则的第二个参数传入布尔值
true，就会同时也验证电子邮件的主机地址是否也是合法的:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;email&#39;</span><span class="p">));</span>

<span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please supply a valid email address.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::equalTo">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">equalTo</tt><big>(</big><em>mixed $check</em>, <em>mixed $compareTo</em><big>)</big><a class="headerlink" href="#Validation::equalTo" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则确保数据的值等于给定的值，并且是相同的类型。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;food&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;equalTo&#39;</span><span class="p">,</span> <span class="s1">&#39;cake&#39;</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;This value must be the string cake&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::extension">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">extension</tt><big>(</big><em>mixed $check</em>, <em>array $extensions = array('gif'</em>, <em>'jpeg'</em>, <em>'png'</em>, <em>'jpg')</em><big>)</big><a class="headerlink" href="#Validation::extension" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则检查合法的文件扩展名，比如.jpg或者.png。
允许多个扩展名以数组的形式传入。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;image&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;extension&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;gif&#39;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;jpg&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please supply a valid image.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::fileSize">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">fileSize</tt><big>(</big><em>$check</em>, <em>$operator = null</em>, <em>$size = null</em><big>)</big><a class="headerlink" href="#Validation::fileSize" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则用来检查文件大小。可以用 <tt class="docutils literal"><span class="pre">$operator</span></tt> 来决定要
使用的比较方法。所有 <a class="reference internal" href="#Validation::comparison" title="Validation::comparison"><tt class="xref php php-func docutils literal"><span class="pre">comparison()</span></tt></a> 支持的
操作符这里都可以使用。这个方法可以自动处理来自 <tt class="docutils literal"><span class="pre">$_FILES</span></tt> 的数组，
它可以从 <tt class="docutils literal"><span class="pre">tmp_name</span></tt> 键读取，只要 <tt class="docutils literal"><span class="pre">$check</span></tt> 是个数组，并且含有这个键:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;image&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;fileSize&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;1MB&#39;</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Image must be less than 1MB&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">2.3 新版功能: </span>这个方法是在2.3版本中添加的。</p>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::inList">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">inList</tt><big>(</big><em>string $check</em>, <em>array $list</em><big>)</big><a class="headerlink" href="#Validation::inList" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则确保数据限于一个给定的集合中。它需要以数组形式提供的一组值。如果数据
能够和给定的数组中的一个值匹配，字段就是合法的。</p>
<p>例如:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;function&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
         <span class="s1">&#39;allowedChoice&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
             <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;inList&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="s1">&#39;Bar&#39;</span><span class="p">)),</span>
             <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Enter either Foo or Bar.&#39;</span>
         <span class="p">)</span>
     <span class="p">)</span>
 <span class="p">);</span>
</pre></div>
</div>
<p>默认区分大小写，可以设置 <tt class="docutils literal"><span class="pre">$caseInsensitive</span></tt> 为真来不区分大小写。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::ip">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">ip</tt><big>(</big><em>string $check</em>, <em>string $type = 'both'</em><big>)</big><a class="headerlink" href="#Validation::ip" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则确保提交的是合法的 IPv4 或 IPv6 的地址。允许 &#8216;both&#8217; (缺省值)，
&#8216;IPv4&#8217;或者&#8217;IPv6&#8217;。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;clientip&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;ip&#39;</span><span class="p">,</span> <span class="s1">&#39;IPv4&#39;</span><span class="p">),</span> <span class="c1">// 或者&#39;IPv6&#39;， 或者&#39;both&#39;(缺省值)</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please supply a valid IP address.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Model::Validation::isUnique">
<tt class="descclassname">Model::</tt><tt class="descname">isUnique</tt><big>(</big><big>)</big><a class="headerlink" href="#Model::Validation::isUnique" title="永久链接至目标">¶</a></dt>
<dd><p>字段的数据必须唯一，它不可以被其他任何数据行使用。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;isUnique&#39;</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;This username has already been taken.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>可以提供多个字段并且设置 <tt class="docutils literal"><span class="pre">$or</span></tt> 为 <tt class="docutils literal"><span class="pre">false</span></tt> 来验证一组字段是否唯一:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;isUnique&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">),</span> <span class="k">false</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;This username &amp; email combination has already been used.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>当跨多字段进行唯一规则验证时要确保字段列表中包含原始的字段。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::luhn">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">luhn</tt><big>(</big><em>string|array $check</em>, <em>boolean $deep = false</em><big>)</big><a class="headerlink" href="#Validation::luhn" title="永久链接至目标">¶</a></dt>
<dd><p>Luhn 算法：一个校验码公式，来验证各种识别号码。更多信息，请参见
<a class="reference external" href="http://en.wikipedia.org/wiki/Luhn_algorithm">Luhn 算法</a>。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::maxLength">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">maxLength</tt><big>(</big><em>string $check</em>, <em>integer $max</em><big>)</big><a class="headerlink" href="#Validation::maxLength" title="永久链接至目标">¶</a></dt>
<dd><p>这个规则确保数据在最大长度范围内。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;maxLength&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Usernames must be no larger than 15 characters long.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这里的长度是&#8221;数据的字符串表示的字节数&#8221;。注意，在处理非 ASCII 字符时，这可能
会长于数据的字符数。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::mimeType">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">mimeType</tt><big>(</big><em>mixed $check</em>, <em>array $mimeTypes</em><big>)</big><a class="headerlink" href="#Validation::mimeType" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">2.2 新版功能.</span></p>
</div>
<p>这个规则检查合法的 mimeType</p>
<div class="versionchanged">
<p><span class="versionmodified">在 2.5 版更改.</span></p>
</div>
<p>从 2.5 版本开始 <tt class="docutils literal"><span class="pre">$mimeTypes</span></tt> 可以是正则表达式字符串.</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;image&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;mimeType&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;image/gif&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Invalid mime type.&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;logo&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;mimeType&#39;</span><span class="p">,</span> <span class="s1">&#39;#image/.+#&#39;</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Invalid mime type.&#39;</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::minLength">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">minLength</tt><big>(</big><em>string $check</em>, <em>integer $min</em><big>)</big><a class="headerlink" href="#Validation::minLength" title="永久链接至目标">¶</a></dt>
<dd><p>这个规则确保数据满足最小长度要求。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;minLength&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Usernames must be at least 8 characters long.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这里的长度是&#8221;数据的字符串表示的字节数&#8221;。注意，在处理非 ASCII 字符时，这可能
会长于数据的字符数。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::money">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">money</tt><big>(</big><em>string $check</em>, <em>string $symbolPosition = 'left'</em><big>)</big><a class="headerlink" href="#Validation::money" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则确保数值是正确的财务金额。</p>
<p>第二个参数指定货币符号在哪里(左/右)。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;salary&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;money&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please supply a valid monetary amount.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::multiple">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">multiple</tt><big>(</big><em>mixed $check</em>, <em>mixed $options = array()</em><big>)</big><a class="headerlink" href="#Validation::multiple" title="永久链接至目标">¶</a></dt>
<dd><p>用这条规则验证一个多选输入。它支持&#8221;in&#8221;，&#8221;max&#8221;和&#8221;min&#8221;参数。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;multiple&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;multiple&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;in&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;do&#39;</span><span class="p">,</span> <span class="s1">&#39;re&#39;</span><span class="p">,</span> <span class="s1">&#39;mi&#39;</span><span class="p">,</span> <span class="s1">&#39;fa&#39;</span><span class="p">,</span> <span class="s1">&#39;sol&#39;</span><span class="p">,</span> <span class="s1">&#39;la&#39;</span><span class="p">,</span> <span class="s1">&#39;ti&#39;</span><span class="p">),</span>
            <span class="s1">&#39;min&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;max&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span>
        <span class="p">)),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please select one, two or three options&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>默认区分大小写，可以设置 <tt class="docutils literal"><span class="pre">$caseInsensitive</span></tt> 为真来不区分大小写。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::notEmpty">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">notEmpty</tt><big>(</big><em>mixed $check</em><big>)</big><a class="headerlink" href="#Validation::notEmpty" title="永久链接至目标">¶</a></dt>
<dd><div class="deprecated">
<p><span class="versionmodified">2.7 版后已移除.</span></p>
</div>
<p>不要再使用，而是用 <tt class="docutils literal"><span class="pre">notBlank</span></tt>。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::notBlank">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">notBlank</tt><big>(</big><em>mixed $check</em><big>)</big><a class="headerlink" href="#Validation::notBlank" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">2.7 新版功能.</span></p>
</div>
<p>确保一个字段不为空的基本规则。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;notBlank&#39;</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;This field cannot be left blank&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>不要对一个多选输入使用该规则，因为这会引起错误。请使用 &#8220;multiple&#8221;。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::numeric">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">numeric</tt><big>(</big><em>string $check</em><big>)</big><a class="headerlink" href="#Validation::numeric" title="永久链接至目标">¶</a></dt>
<dd><p>检查传入的数据是一个合法的数。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;cars&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;numeric&#39;</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please supply the number of cars.&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::naturalNumber">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">naturalNumber</tt><big>(</big><em>mixed $check</em>, <em>boolean $allowZero = false</em><big>)</big><a class="headerlink" href="#Validation::naturalNumber" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">2.2 新版功能.</span></p>
</div>
<p>这个规则检查传入的数据是否是正确的自然数。如果 <tt class="docutils literal"><span class="pre">$allowZero</span></tt> 设为 true，零
也可以接受。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;wheels&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;naturalNumber&#39;</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please supply the number of wheels.&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;airbags&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;naturalNumber&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please supply the number of airbags.&#39;</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::phone">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">phone</tt><big>(</big><em>mixed $check</em>, <em>string $regex = null</em>, <em>string $country = 'all'</em><big>)</big><a class="headerlink" href="#Validation::phone" title="永久链接至目标">¶</a></dt>
<dd><p>Phone 规则验证美国的电话号码。如果要验证美国以外的电话号码，可以在第二个参数
用一个正则表达式来处理其他的号码格式。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;phone&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;phone&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::postal">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">postal</tt><big>(</big><em>mixed $check</em>, <em>string $regex = null</em>, <em>string $country = 'us'</em><big>)</big><a class="headerlink" href="#Validation::postal" title="永久链接至目标">¶</a></dt>
<dd><p>Postal 规则验证美国(us)、加拿大(ca)、英国(uk)、意大利(it)、德国(de)和比利时
(be)的邮政编码。对于其他的邮政编码格式，可以在第二个参数提供一个正则表达式。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;zipcode&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;postal&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::range">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">range</tt><big>(</big><em>string $check</em>, <em>integer $lower = null</em>, <em>integer $upper = null</em><big>)</big><a class="headerlink" href="#Validation::range" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则确保数值在一个给定范围内。如果没有指定范围，规则会检查数值是当前平台
上的合法有限数。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;number&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please enter a number between -1 and 11&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>上面的例子会接受大于-1(比如 -0.99)而且小于11(比如 10.99)的任何数值。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">上下限的值是不包括在内的。</p>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::ssn">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">ssn</tt><big>(</big><em>mixed $check</em>, <em>string $regex = null</em>, <em>string $country = null</em><big>)</big><a class="headerlink" href="#Validation::ssn" title="永久链接至目标">¶</a></dt>
<dd><p>Ssn 规则验证美国(us)，丹麦(dk)，和荷兰(nl)的社会保险号码。对于其他的社会保险
号码，可以指定正则表达式。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;ssn&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;ssn&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::time">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">time</tt><big>(</big><em>string $check</em><big>)</big><a class="headerlink" href="#Validation::time" title="永久链接至目标">¶</a></dt>
<dd><p>Time 验证规则决定传入的字符串是否是正确的时间。以24小时(HH:MM)或上午/下午(
[H]H:MM[a|p]m)来验证。不允许/验证秒。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::uploadError">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">uploadError</tt><big>(</big><em>mixed $check</em><big>)</big><a class="headerlink" href="#Validation::uploadError" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">2.2 新版功能.</span></p>
</div>
<p>这条规则检查文件上载是否有错。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;image&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;uploadError&#39;</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Something went wrong with the upload.&#39;</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::url">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">url</tt><big>(</big><em>string $check</em>, <em>boolean $strict = false</em><big>)</big><a class="headerlink" href="#Validation::url" title="永久链接至目标">¶</a></dt>
<dd><p>这条规则检查合法的网址格式。支持 http(s)、ftp(s)、file、news 和 gopher 协议:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;website&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;url&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>为确保协议在网址中，可以象这样使用严格模式:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;website&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这个验证方法用到了复杂正则表达式，有时会在 Windows 平台上在使用 mod_php
模块的 Apache2 中出现问题。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::userDefined">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">userDefined</tt><big>(</big><em>mixed $check</em>, <em>object $object</em>, <em>string $method</em>, <em>array $args = null</em><big>)</big><a class="headerlink" href="#Validation::userDefined" title="永久链接至目标">¶</a></dt>
<dd><p>执行用户定义的验证。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Validation::uuid">
<em class="property">static </em><tt class="descclassname">Validation::</tt><tt class="descname">uuid</tt><big>(</big><em>string $check</em><big>)</big><a class="headerlink" href="#Validation::uuid" title="永久链接至目标">¶</a></dt>
<dd><p>检查数据是合法的 UUID: <a class="reference external" href="http://tools.ietf.org/html/rfc4122">http://tools.ietf.org/html/rfc4122</a>。</p>
</dd></dl>

</div>
<div class="section" id="id13">
<h2>本地化验证<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<p>验证规则 phone() 和 postal() 会把它们不知道如何处理的国家前缀交给适当命名的其他
类来处理。例如，如果住在荷兰，就可以创建这样一个类:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NlValidation</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">phone</span><span class="p">(</span><span class="nv">$check</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">postal</span><span class="p">(</span><span class="nv">$check</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这个文件可以放在 <tt class="docutils literal"><span class="pre">APP/Validation/</span></tt> 或者 <tt class="docutils literal"><span class="pre">App/PluginName/Validation/</span></tt>，但必须
在使用之前用 App::uses() 导入。在模型验证中可以这样使用 NlValidation 类:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$validate</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;phone_no&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;phone&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;nl&#39;</span><span class="p">)),</span>
    <span class="s1">&#39;postal_code&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;rule&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;postal&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;nl&#39;</span><span class="p">)),</span>
<span class="p">);</span>
</pre></div>
</div>
<p>当模型数据被验证时，验证程序会知道它无法处理 <tt class="docutils literal"><span class="pre">nl</span></tt> 地区，就会尝试把任务
交给 <tt class="docutils literal"><span class="pre">NlValidation::postal()</span></tt>，该方法的返回值就会被用作验证通过/失败的标志。这
个方法允许你创建一些类来处理一组或一个子集的地区，这是一个大的 switch 语句无法实
现的。单个验证方法的用法并没有改变，只是增加了跳转到其他验证的功能。</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">Localized 插件已经包括许多可以使用的规则:
<a class="reference external" href="https://github.com/cakephp/localized">https://github.com/cakephp/localized</a>。另外，随意贡献你的本地化验证规则。</p>
</div>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="data-validation/validating-data-from-the-controller.html">从控制器验证数据</a></li>
</ul>
</div>
</div>
</div>


		</div>
	</div>

	<div class="sidebar columns three pull-nine">
<div id="sidebar-navigation" class="hide-on-phones">
	<h2 class="hide-on-desktops">Table of Contents</h2>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">欢迎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cakephp-overview.html">CakePHP 概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">视图</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../models.html">模型</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="associations-linking-models-together.html">关联：将模型连接在一起</a></li>
<li class="toctree-l2"><a class="reference internal" href="retrieving-your-data.html">检索数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="saving-your-data.html">保存数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="deleting-data.html">删除数据</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">数据验证</a><ul>
<li class="toctree-l3"><a class="reference internal" href="data-validation/validating-data-from-the-controller.html">从控制器验证数据</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="callback-methods.html">回调方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors.html">行为</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasources.html">数据源</a></li>
<li class="toctree-l2"><a class="reference internal" href="model-attributes.html">模型属性</a></li>
<li class="toctree-l2"><a class="reference internal" href="additional-methods-and-properties.html">其它方法和属性</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtual-fields.html">虚字段</a></li>
<li class="toctree-l2"><a class="reference internal" href="transactions.html">事务</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries.html">核心库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">插件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">命令行与Shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">教程 &amp; 实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

<div class="page-contents">
	<h3>Page contents</h3>
	<ul>
<li><a class="reference internal" href="#">数据验证</a><ul>
<li><a class="reference internal" href="#id2">简单的规则</a></li>
<li><a class="reference internal" href="#id3">每个字段带一个规则</a><ul>
<li><a class="reference internal" href="#rule">rule</a></li>
<li><a class="reference internal" href="#required">required</a></li>
<li><a class="reference internal" href="#allowempty">allowEmpty</a></li>
<li><a class="reference internal" href="#on">on</a></li>
<li><a class="reference internal" href="#message">message</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">每个字段多条规则</a><ul>
<li><a class="reference internal" href="#last">last</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">自定义验证规则</a><ul>
<li><a class="reference internal" href="#id6">使用自定义的正则表达式进行验证</a></li>
<li><a class="reference internal" href="#id7">添加自定义的验证方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">动态改变验证规则</a><ul>
<li><a class="reference internal" href="#id9">添加新的验证规则</a></li>
<li><a class="reference internal" href="#id10">修改现存的验证规则</a></li>
<li><a class="reference internal" href="#id11">从集合中删除规则</a></li>
</ul>
</li>
<li><a class="reference internal" href="#core-validation-rules">核心验证规则</a></li>
<li><a class="reference internal" href="#id13">本地化验证</a></li>
</ul>
</li>
</ul>

</div>
	</div>

</div>

<div class="content row">
	<ul class="related-pages inline">
	<li>
		<a href="../genindex.html" title="总目录" accesskey="I">索引</a>
	</li>
	<li>
		<a href="data-validation/validating-data-from-the-controller.html" title="从控制器验证数据" accesskey="N">下一页</a>
	</li>
	<li>
		<a href="deleting-data.html" title="删除数据" accesskey="P">上一页</a>
	</li>
	</ul>
</div>

	<div class="footer-push"> </div>
</div>






<div class="footer">
	<div class="row">
		<div class="columns six offset-by-three contribute">
			<strong>Found an issue?</strong>
			Submit a correction on <a href="https://github.com/cakephp/docs">GitHub</a><br />
			<a href="http://book.cakephp.org/2.0/en/contributing/documentation.html">[ documentation on how to contribute ]</a>
		</div>
	</div>
	
	<div class="row">
		<div class="columns nine offset-by-three copyright">
					&copy; 版权所有 2014, Cake Software Foundation, Inc.
				最后更新于 Aug 24, 2015.
				Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
		</div>
	</div>
</div>

<div id="nav-modal" class="reveal-modal"> </div>
<div id="inline-search-results"></div>
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-743287-3']);
	_gaq.push(['_trackPageview']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
  </body>
</html>