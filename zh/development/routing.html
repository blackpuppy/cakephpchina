

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Routing" lang="zh" name="title" />
<meta content="controller actions,default routes,mod rewrite,code index,string url,php class,incoming requests,dispatcher,url url,meth,maps,match,parameters,array,config,cakephp,apache,router" lang="zh" name="keywords" />

    <title>路由</title>
    <link href="../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/app.js"></script>

    <link rel="alternate" hreflang="en" href="../../en/development/routing.html" /><link rel="alternate" hreflang="pt" href="../../pt/development/routing.html" /><link rel="alternate" hreflang="es" href="../../es/development/routing.html" /><link rel="alternate" hreflang="ja" href="../../ja/development/routing.html" /><link rel="alternate" hreflang="fr" href="../../fr/development/routing.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within CakePHP Cookbook 2.x 文档" href="../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="CakePHP Cookbook 2.x 文档" href="../index.html" />
    <link rel="up" title="开发" href="../development.html" />
    <link rel="next" title="会话" href="sessions.html" />
    <link rel="prev" title="配置" href="configuration.html" />

    <script type="text/javascript">
    window.lang = "zh";
    </script>
  </head>
  <body>

<div id="container">
	
	<header class="nav-down">
		<div class="container-fluid hidden-xs hidden-sm">
			<div class="row">
				<div class="col-sm-3 col-md-3">
					<a class="logo-cake" href="http://cakephp.org">
						<img src="../_static/logo-cake.png" alt="CakePHP" />
					</a>
				</div>

				<div class="col-sm-9 col-md-9">
					<nav class="navbar-right">
						<ul class="menu">
							<li class="first">
								<a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
								<ul class="submenu">
									
<li><a href="http://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>CookBook</a></li>
<li><a href="http://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="http://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="http://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="http://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
								</ul>
							</li>

							<li><a href="http://cakephp.org/business-solutions">Business Solutions</a></li>
							<li><a href="http://cakephp.org/showcase">Showcase</a></li>

							<li>
								<a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
								<div class="megamenu full">
									<div class="row">
										<div class="col-6 pl30">
											<ul class="megamenu-list">
												
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="http://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="http://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="http://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="http://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="http://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="http://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="http://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
											</ul>
										</div>
										<div class="col-6 pl30">
											<ul class="megamenu-list">
												
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="http://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="http://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="http://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="http://cakedc.com"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
											</ul>
										</div>
									</div>
								</div>
							</li>
						</ul>
					</nav>
				</div>
			</div>
		</div>

		
		<div class="container-fluid hidden-md hidden-lg">
			<div class="row">
				<div class="col-sm-6 col-xs-6">
					<a class="logo-cake" href="http://cakephp.org">
						<img src="../_static/logo-cake.png" alt="CakePHP" />
					</a>
				</div>

				<div class="col-sm-6 col-xs-6">
					<div class="navbar-right">
						<button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
							<i class="fa fa-bars toggle-modal"></i>
						</button>
					</div>
					<div id="wrap">
						<form class="search" action="../search.html" method="get">
							<input name="q" type="search" placeholder="What are you looking for?">
							<input id="search_submit" value="搜索" type="submit">
						</form>
					</div>
				</div>
			</div>
		</div>

		
		<section id="nav-cook" class="hidden-xs hidden-sm">
			<div class="container-fluid ">
				<div class="row ">
					<div class="col-md-12 back-book">
						<div class="col-md-4 col-md-offset-1 text-center t-cook-nav p0 hidden-sm hidden-xs">
							<h2>
								<a href="../contents.html">
									<span class="glyph_range icon-submenu icon-submenu-cook">B</span>
									CakePHP 2.x <strong>Cookbook</strong>
								</a>
							</h2>
						</div>

						<div class="col-md-4 hidden-sm">
							<form class="search" action="../search.html" method="get">
								<input type="hidden" name="check_keywords" value="yes" />
								<input type="hidden" name="area" value="default" />

								<div class="col-md-10 p0">
									<input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
								</div>
								<div class="col-md-2 p0 search-cook">
									<button type="submit">
										<span class="glyph_range icon-submenu icon-submenu-cook">A</span>
									</button>
								</div>
							</form>
						</div>

						
						<div class="col-md-3">
							<div class="col-md-6 p0">
								<div class="col-md-7 t-language p0">
									<h6>Language:</h6>
								</div>
								<div class="col-md-5 p0">
									<ul class="nav navbar-nav">
										<li class="dropdown">
											<a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
													role="button" aria-haspopup="true" aria-expanded="false" href="#">
														zh
														<i class="fa fa-menu-en fa-chevron-down"></i>
													</a>
											<ul class="dropdown-menu">
											
												<li><a href="../../en/development/routing.html">en</a></li>
											
												<li><a href="../../pt/development/routing.html">pt</a></li>
											
												<li><a href="../../es/development/routing.html">es</a></li>
											
												<li><a href="../../ja/development/routing.html">ja</a></li>
											
												<li><a href="../../fr/development/routing.html">fr</a></li>
											
												<li></li>
											
											</ul>
										</li>
									</ul>
								</div>
							</div>

							<div class="col-md-6 p0">
								<div class="col-md-7 t-language p0">
									<h6>Version:</h6>
								</div>
								<div class="col-md-5 p0">
									<ul class="nav navbar-nav">
										<li class="dropdown">
											<a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">2.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
											<ul class="dropdown-menu">
												<li><a href="http://book.cakephp.org/3.0/zh">3.x Book</a></li>
												<li><a href="http://book.cakephp.org/2.0/zh">2.x Book</a></li>
												<li><a href="http://book.cakephp.org/1.3/zh/">1.3 Book</a></li>
												<li><a href="http://book.cakephp.org/1.2/zh/">1.2 Book</a></li>
												<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
											</ul>
										</li>
									</ul>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</section>
	</header>

	
	<section class="nav-btn visible-sm visible-xs">
		<div class="container">
			<div class="row">
				<div class="col-sm-6 col-xs-6 text-center">
					<button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
				</div>

				<div class="col-sm-6 col-xs-6 text-center">
					<button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
				</div>
			</div>
		</div>
	</section>

	
	<div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title-cookbook" id="modal-header"></h4>
				</div>
				<div class="modal-body"></div>
			</div>
		</div>
	</div>

<div class="container page-container"><div id="improve-slideout">
		<i class="fa fa-pencil icon-improve"></i>
		<a href="https://github.com/cakephp/docs/edit/master/zh/development/routing.rst" target="_blank">
			<div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
		</a>
	</div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

	
	<div class="row">
		<div class="col-sm-12 col-md-9 col-md-push-3 space-left push-off"><div class="page-contents col-sm-5">
				<h3>Page Contents</h3>
				<ul>
<li><a class="reference internal" href="#">路由</a><ul>
<li><a class="reference internal" href="#routes-configuration">路由的配置</a></li>
<li><a class="reference internal" href="#id3">默认的路由</a></li>
<li><a class="reference internal" href="#connecting-routes">连接路由</a><ul>
<li><a class="reference internal" href="#route-elements">路由元素</a></li>
<li><a class="reference internal" href="#id6">传递参数给动作</a></li>
<li><a class="reference internal" href="#id7">每个路由的命名参数</a></li>
<li><a class="reference internal" href="#prefix-routing">前缀路由</a></li>
<li><a class="reference internal" href="#index-3">插件路由</a></li>
<li><a class="reference internal" href="#file-extensions">文件扩展名</a></li>
<li><a class="reference internal" href="#route-conditions">使用额外条件匹配路由</a></li>
</ul>
</li>
<li><a class="reference internal" href="#passed-arguments">传入参数</a></li>
<li><a class="reference internal" href="#named-parameters">命名参数</a><ul>
<li><a class="reference internal" href="#controlling-named-parameters">控制命名参数</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15">反向路由</a></li>
<li><a class="reference internal" href="#redirect-routing">重定向路由</a></li>
<li><a class="reference internal" href="#disabling-default-routes">关闭默认路由</a></li>
<li><a class="reference internal" href="#custom-route-classes">自定义路由类</a></li>
<li><a class="reference internal" href="#api">路由 API</a></li>
</ul>
</li>
</ul>

			</div><div class="document-body">
			
  <div class="section" id="id1">
<h1>路由<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>路由(<em>routing</em>)是把网址(<em>URL</em>)映射到控制器动作的功能。这个功能添加到 CakePHP 中，
是为了使友好网址更容易配置和更加灵活。使用路由不要求一定要用 Apache 的
mod_rewrite 模块，不过这会使地址栏看起来更加整洁。</p>
<p>CakePHP 的路由还包括反向路由的思想，即，参数数组可以逆转成字符串网址。使用反向路
由，你就可以轻松地重构应用程序的网址结构，而无需更新所有的代码。</p>
<div class="section" id="routes-configuration">
<span id="index-0"></span><span id="id2"></span><h2>路由的配置<a class="headerlink" href="#routes-configuration" title="永久链接至标题">¶</a></h2>
<p>应用程序中的路由是在 <code class="docutils literal"><span class="pre">app/Config/routes.php</span></code> 中配置的。当处理路由被
<code class="xref php php-class docutils literal"><span class="pre">Dispatcher</span></code> 引入，让你可以定义应用程序要使用的特定路由。在该文件中声
明的路由从上而下处理，直到收到的请求匹配。这意味着放置路由的顺序会影响路由的解析。
通常好的做法是，把最常访问的路由尽可能放在路由文件的最上面。这可以省去对每个请求
不得不检查若干个不能匹配的路由。</p>
<p>路由以它们连入的顺序来解析和匹配。如果你定义两个类似的路由，定义的第一个路由比后
定义的那个有更高的优先级。在连接路由之后，你可以使用
<a class="reference internal" href="#Router::promote" title="Router::promote"><code class="xref php php-meth docutils literal"><span class="pre">Router::promote()</span></code></a> 来操纵路由的顺序。</p>
<p>CakePHP 也带有一些默认的路由帮你开始。以后如果你肯定不需要它们了，可以把它们关闭。
欲知如何关闭默认的路由，请参见 <a class="reference internal" href="#disabling-default-routes"><span class="std std-ref">关闭默认路由</span></a>。</p>
</div>
<div class="section" id="id3">
<h2>默认的路由<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>在了解如何配置自己的路由之前，你应当知道 CakePHP 带有一组默认的路由。CakePHP 的
默认路由适用于任何应用程序的很多情况。把一个动作的名称放入请求中，就可以直接从网
址访问该动作。也可以用网址传递参数到控制器动作。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// 网址（*URL*）模式的默认路由：</span>
<span class="nx">http</span><span class="o">://</span><span class="nx">example</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">controller</span><span class="o">/</span><span class="nx">action</span><span class="o">/</span><span class="nx">param1</span><span class="o">/</span><span class="nx">param2</span><span class="o">/</span><span class="nx">param3</span>
</pre></div>
</div>
<p>网址 /posts/view 映射到 PostsController 的 view() 动作，而网址
/products/view_clearance 映射到 ProductsController 的 view_clearance() 动作。</p>
<p>默认的路由设置也让你可以用网址传递参数到动作。例如，对 /posts/view/25 的请求等于
调用 PostsController 的 view(25)。默认的路由也提供插件的路由、前缀路由，如果你选
择使用这些功能的话。</p>
<p>内置的路由位于 <code class="docutils literal"><span class="pre">Cake/Config/routes.php</span></code>。你可以通过在应用程序的
<a class="reference internal" href="../appendices/glossary.html#term-routes-php"><span class="xref std std-term">routes.php</span></a> 文件中去掉默认路由来关闭它们。</p>
</div>
<div class="section" id="connecting-routes">
<span id="index-1"></span><span id="id4"></span><h2>连接路由<a class="headerlink" href="#connecting-routes" title="永久链接至标题">¶</a></h2>
<p>定义你自己的路由让你可以定义应用程序如何对一个给定的网址作出反应。用
<a class="reference internal" href="#Router::connect" title="Router::connect"><code class="xref php php-meth docutils literal"><span class="pre">Router::connect()</span></code></a> 方法在 <code class="docutils literal"><span class="pre">app/Config/routes.php</span></code> 文件中定义定义自
己的路由。</p>
<p><code class="docutils literal"><span class="pre">connect()</span></code> 方法接受最多三个参数：希望匹配的网址、路由元素的默认值、和帮助路由
匹配网址中的元素的正则表达式规则。</p>
<p>路由定义的基本格式为:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;URL&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;defaultValue&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;option&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;matchingRegex&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>第一个参数用来告诉路由器你要控制哪种网址。网址是斜线分隔的普通字符串，但也可以包
含通配符(*)或者 <a class="reference internal" href="#route-elements"><span class="std std-ref">路由元素</span></a>。使用通配符告诉路由器，你愿意接受任何提供
的额外参数。不含*的路由只匹配提供的模板模式。</p>
<p>一旦指定了网址，用 <code class="docutils literal"><span class="pre">connect()</span></code> 的最后两个参数来告诉 CakePHP，一旦一个请求匹配
了，要如何处理它。第二个参数是一个关联数组。数组的键应当以网址中的路由元素来命名，
或者是默认元素： <code class="docutils literal"><span class="pre">:controller</span></code> 、 <code class="docutils literal"><span class="pre">:action</span></code> 和 <code class="docutils literal"><span class="pre">:plugin</span></code>。数组中的值是这些
键的缺省值。让我们看一些基本的例子，再来看如何使用 connect() 的第三个参数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/pages/*&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pages&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;display&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>以上这个路由在随 CakePHP 发布的 routes.php 文件中。该路由匹配任何以 <code class="docutils literal"><span class="pre">/pages/</span></code>
开始的网址，并把它交给 <code class="docutils literal"><span class="pre">PagesController();</span></code> 的 <code class="docutils literal"><span class="pre">display()</span></code> 动作。请求
/pages/products 会映射到 <code class="docutils literal"><span class="pre">PagesController-&gt;display('products')</span></code>。</p>
<p>除了贪婪的星号 <code class="docutils literal"><span class="pre">/*</span></code>，还有 <code class="docutils literal"><span class="pre">/**</span></code> 后缀星号语法。使用后缀双星号，会捕获网址的其
余部分为一个传入参数。当你要使用含有 <code class="docutils literal"><span class="pre">/</span></code> 的参数时就有用了:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/pages/**&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pages&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>传入的网址 <code class="docutils literal"><span class="pre">/pages/the-example-/-and-proof</span></code> 会导致单个传入参数
<code class="docutils literal"><span class="pre">the-example-/-and-proof</span></code>。</p>
<div class="versionadded">
<p><span class="versionmodified">2.1 新版功能: </span>在 2.1 版本中增加了后缀双星号。</p>
</div>
<p>你可以使用 <a class="reference internal" href="#Router::connect" title="Router::connect"><code class="xref php php-meth docutils literal"><span class="pre">Router::connect()</span></code></a> 的第二个参数来提供任何由路由的默认值组
成的路由参数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/government&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pages&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这个例子说明如何使用 <code class="docutils literal"><span class="pre">connect()</span></code> 方法的第二个参数来定义默认参数。如果你构建一
个网站，有针对不同类别客户的产品，你也许会考虑创建一个路由。这让你可以链接
<code class="docutils literal"><span class="pre">/government</span></code>，而不是 <code class="docutils literal"><span class="pre">/pages/display/5</span></code>。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">尽管你可以连接不同的路由，默认的路由还是会继续有效。在这样的设置下，可以从2个
不同的网址访问相同的内容。欲知如何关闭默认路由，以及只提供你定义的网址，请参看
<a class="reference internal" href="#disabling-default-routes"><span class="std std-ref">关闭默认路由</span></a>。</p>
</div>
<p>另一个路由器的常见用法是为控制器定义&#8221;别名&#8221;。比方说，我们不要访问通常的网址
<code class="docutils literal"><span class="pre">/users/some_action/5</span></code>，希望能够通过 <code class="docutils literal"><span class="pre">/cooks/some_action/5</span></code> 来访问。下面的路
由轻易地实现了:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/cooks/:action/*&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这就是告诉路由器，任何以 <code class="docutils literal"><span class="pre">/cooks/</span></code> 开始的网址应当交给用户控制器。调用的动作取
决于 <code class="docutils literal"><span class="pre">:action</span></code> 参数的值。使用 <a class="reference internal" href="#route-elements"><span class="std std-ref">路由元素</span></a>，就能够创造路由变量，接受
用户输入或者变量。上面的路由也使用了贪婪的星号。贪婪的星号告诉
<a class="reference internal" href="#Router" title="Router"><code class="xref php php-class docutils literal"><span class="pre">Router</span></code></a>，这个路由应当接受任何给定的额外位置参数。这些参数会被放入
<a class="reference internal" href="#passed-arguments"><span class="std std-ref">传入参数</span></a> 数组供访问。</p>
<p>当生成网址时，也使用路由。如果上述路由最先匹配，使用
<code class="docutils literal"><span class="pre">array('controller'</span> <span class="pre">=&gt;</span> <span class="pre">'users',</span> <span class="pre">'action'</span> <span class="pre">=&gt;</span> <span class="pre">'some_action',</span> <span class="pre">5)</span></code> 作为网址，就会
输出 /cooks/some_action/5。</p>
<p>默认情况下，所有命名(<em>named</em>)和传入(<em>passed</em>)参数会从匹配贪婪模板的网址中提取。
不过，如果需要，可以使用 <a class="reference internal" href="#Router::connectNamed" title="Router::connectNamed"><code class="xref php php-meth docutils literal"><span class="pre">Router::connectNamed()</span></code></a> 来配置哪个命名参数如
何解析。</p>
<div class="section" id="route-elements">
<span id="id5"></span><h3>路由元素<a class="headerlink" href="#route-elements" title="永久链接至标题">¶</a></h3>
<p>你可以指定自己的路由元素，这么做让你有能力能够定义控制器动作的参数在网址中应当占
据的位置。当发出一个请求时，这些路由元素的值就会在控制器的
<code class="docutils literal"><span class="pre">$this-&gt;request-&gt;params</span></code> 中。这不同于命名参数(<em>named parameters</em>)处理的方式，
所以请注意区别：命名参数(/controller/action/name:value)在
<code class="docutils literal"><span class="pre">$this-&gt;request-&gt;params['named']</span></code> 中，而自定义路由元素数据在
<code class="docutils literal"><span class="pre">$this-&gt;request-&gt;params</span></code> 中。当你定义自定义路由元素时，你可以指定可选的正则表
达式 — 这告诉 CakePHP 如何判断网址的格式是否正确。如果你选择不提供正则表达式，任
何非 <code class="docutils literal"><span class="pre">/</span></code> 字符就会被当做参数的一部分:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/:controller/:id&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这个简单的例子展示了如何通过构建一个看起来象 <code class="docutils literal"><span class="pre">/controllername/:id</span></code> 这样的网址，
来创造一个快捷的方式从任何控制器来查看模型。提供给 connect() 方法的网址指定了两
个路由元素： <code class="docutils literal"><span class="pre">:controller</span></code> 和 <code class="docutils literal"><span class="pre">:id</span></code>。<code class="docutils literal"><span class="pre">:controller</span></code> 元素是 CakePHP 的默认路
由元素，所以路由器知道如何匹配和辨认网址中的控制器名称。<code class="docutils literal"><span class="pre">:id</span></code> 元素是自定义路由
元素，必须在 connect() 方法的第三个参数中用正则表达式进一步说明。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">路由元素使用的模式必须不能含有任何捕获分组(<em>capturing group</em>)。如果含有捕获
分组，路由器就无法正常工作。</p>
</div>
<p>一旦定义了路由，请求 <code class="docutils literal"><span class="pre">/apples/5</span></code> 就等同于请求 <code class="docutils literal"><span class="pre">/apples/view/5</span></code>。二者都会调用
ApplesController 控制器的 view() 方法。在 view() 方法内，需要用
<code class="docutils literal"><span class="pre">$this-&gt;request-&gt;params['id']</span></code> 来访问传入的 ID。</p>
<p>如果在应用程序中只有一个控制器，并且不想让控制器名称出现在网站中，你可以把所有网
址映射到控制器的动作。例如，要把所有网址映射到 <code class="docutils literal"><span class="pre">home</span></code> 控制器的动作，例如，使用
网址 <code class="docutils literal"><span class="pre">/demo</span></code> 而不是 <code class="docutils literal"><span class="pre">/home/demo</span></code>，可以这样:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span><span class="s1">&#39;/:action&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;home&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>如果想提供大小写无关的网址，可以使用正则表达式的内嵌修饰符(<em>inline modifier</em>):</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/:userShortcut&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;teachers&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;userShortcut&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;(?i:principal)&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>再看一个例子，你就是路由专家了:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/:controller/:year/:month/:day&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;year&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[12][0-9]{3}&#39;</span><span class="p">,</span>
        <span class="s1">&#39;month&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;0[1-9]|1[012]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;day&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;0[1-9]|[12][0-9]|3[01]&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这个有些复杂，但是说明了路由可以多么强大。提供的网址有四个路由元素。第一个我们很
熟悉：这是默认路由元素，告诉 CakePHP 这是控制器名称。</p>
<p>接着，我们指定一些缺省值。不管控制器是什么，我们都要调用 index() 动作。</p>
<p>最后，我们指定一些正则表达式，匹配数字形式的年、月和日。注意，在这个正则表达式中
是不支持括号(分组)的。你可以使用其它的，象上面那样，但是不能用括号分组。</p>
<p>一旦定义好，路由就可以匹配 <code class="docutils literal"><span class="pre">/articles/2007/02/01</span></code> 、 <code class="docutils literal"><span class="pre">/posts/2004/11/16</span></code>，把
请求传递给相应控制器的 index() 动作，并把日期参数放入 <code class="docutils literal"><span class="pre">$this-&gt;request-&gt;params</span></code>
中。</p>
<p>有几个路由元素在 CakePHP 中有特殊意义，不应当使用，除非你需要这种特殊意义。</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">controller</span></code> 用于命名路由的控制器。</li>
<li><code class="docutils literal"><span class="pre">action</span></code> 用于命名路由的控制器动作。</li>
<li><code class="docutils literal"><span class="pre">plugin</span></code> 用于命名控制器所在的插件(<em>plugin</em>)。</li>
<li><code class="docutils literal"><span class="pre">prefix</span></code> 用于 <a class="reference internal" href="#prefix-routing"><span class="std std-ref">前缀路由</span></a>。</li>
<li><code class="docutils literal"><span class="pre">ext</span></code> 用于 <a class="reference internal" href="#file-extensions"><span class="std std-ref">文件扩展名</span></a> 路由。</li>
</ul>
</div>
<div class="section" id="id6">
<h3>传递参数给动作<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p>当使用 <a class="reference internal" href="#route-elements"><span class="std std-ref">路由元素</span></a> 连接路由时，你也许想要路由的元素转而作为传入参数
(<em>passed arguments</em>)。使用 <a class="reference internal" href="#Router::connect" title="Router::connect"><code class="xref php php-meth docutils literal"><span class="pre">Router::connect()</span></code></a> 方法的第三个参数，你可
以定义哪个路由元素应当也被作为传入参数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// SomeController.php</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">view</span><span class="p">(</span><span class="nv">$articleId</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$slug</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 这里是一些代码...</span>
<span class="p">}</span>

<span class="c1">// routes.php</span>
<span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/blog/:id-:slug&#39;</span><span class="p">,</span> <span class="c1">// 例如 /blog/3-CakePHP_Rocks</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="c1">// 顺序有关，因为这会简单地把 &quot;:id&quot; 映射到动作中的 $articleId 参数</span>
        <span class="s1">&#39;pass&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;slug&#39;</span><span class="p">),</span>
        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[0-9]+&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>那么现在，得益于反向路由的功能，你可以传入下面这样的网址，而 CakePHP 就能够知道
如何构成路由中定义的网址:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// view.ctp</span>
<span class="c1">// 这会返回链接 /blog/3-CakePHP_Rocks</span>
<span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span><span class="s1">&#39;CakePHP Rocks&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span>
    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;slug&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CakePHP_Rocks&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>每个路由的命名参数<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>尽管你可以用 <a class="reference internal" href="#Router::connectNamed" title="Router::connectNamed"><code class="xref php php-meth docutils literal"><span class="pre">Router::connectNamed()</span></code></a> 在全局范围控制命名参数
(<em>named parameter</em>)，你也可以用 <code class="docutils literal"><span class="pre">Router::connect()</span></code> 的第三个参数控制在路由级别
的命名参数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/:controller/:action/*&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;named&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;wibble&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fish&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">),</span>
            <span class="s1">&#39;fizz&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;buzz&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;val-[\d]+&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>以上路由定义使用 <code class="docutils literal"><span class="pre">named</span></code> 键来定义应当如何 处理几个命名参数。让我们仔细看看每个
不同的规则：</p>
<ul class="simple">
<li>&#8216;wibble&#8217; 没有额外信息。这意味着，如果在匹配该路由的网址中找到，总是会解析。</li>
<li>&#8216;fish&#8217; 有条件数组，包含 &#8216;action&#8217; 键。这意味着，仅当动作也是索引时，fish 才会被
解析为命名参数。</li>
<li>&#8216;fizz&#8217; 也有条件数组。不过，它含有两个控制器，这意味着，仅当控制器匹配数组中的
一个时，&#8217;fizz&#8217; 才会被解析。</li>
<li>&#8216;buzz&#8217; 有字符串条件。字符串条件被作为正则表达式片段。只有符合模式的 buzz 值才
会被解析。</li>
</ul>
<p>如果使用了命名参数，但它不符合提供的条件，就会被当作传入参数(<em>passed argument</em>)，
而非命名参数。</p>
</div>
<div class="section" id="prefix-routing">
<span id="index-2"></span><span id="id8"></span><h3>前缀路由<a class="headerlink" href="#prefix-routing" title="永久链接至标题">¶</a></h3>
<p>许多应用程序要求有一个管理区，特权用户可以进行改动。这经常是通过一个特殊的网址来
完成的，比如 <code class="docutils literal"><span class="pre">/admin/users/edit/5</span></code>。在 CakePHP 中，前缀路由(<em>prefix routing</em>)
可以在核心配置文件中通过使用 Routing.prefixes 设置前缀来开启。注意，前缀虽然和路
由器有关，却是在 <code class="docutils literal"><span class="pre">app/Config/core.php</span></code> 中配置的:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Routing.prefixes&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>在控制器中，任何以 <code class="docutils literal"><span class="pre">admin_</span></code> 前缀开始的动作就可以被调用了。在用户的例子中，访问
网址 <code class="docutils literal"><span class="pre">/admin/users/edit/5</span></code> 就会调用 <code class="docutils literal"><span class="pre">UsersController</span></code> 控制器的方法
<code class="docutils literal"><span class="pre">admin_edit</span></code>，传入 5 作为第一个参数。使用的视图文件为
<code class="docutils literal"><span class="pre">app/View/Users/admin_edit.ctp</span></code>。</p>
<p>可以用下面的路由映射网址 /admin 到 pages 控制器的 <code class="docutils literal"><span class="pre">admin_index</span></code> 动作:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/admin&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pages&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>也可以通过添加更多的值到 <code class="docutils literal"><span class="pre">Routing.prefixes</span></code> 来配置路由器使用多个前缀。如果设置:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Routing.prefixes&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;manager&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>CakePHP 会自动生成 admin 和 manager 两个前缀的路由。每个配置的前缀会有如下生成的
路由:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s2">&quot;/</span><span class="si">{</span><span class="nv">$prefix</span><span class="si">}</span><span class="s2">/:plugin/:controller&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="nv">$prefix</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">)</span>
<span class="p">);</span>
<span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s2">&quot;/</span><span class="si">{</span><span class="nv">$prefix</span><span class="si">}</span><span class="s2">/:plugin/:controller/:action/*&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="nv">$prefix</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">)</span>
<span class="p">);</span>
<span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s2">&quot;/</span><span class="si">{</span><span class="nv">$prefix</span><span class="si">}</span><span class="s2">/:controller&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="nv">$prefix</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">)</span>
<span class="p">);</span>
<span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s2">&quot;/</span><span class="si">{</span><span class="nv">$prefix</span><span class="si">}</span><span class="s2">/:controller/:action/*&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="nv">$prefix</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>和 admin 路由很类似，所有的前缀动作应当加上前缀名称。所以 <code class="docutils literal"><span class="pre">/manager/posts/add</span></code>
就会映射到 <code class="docutils literal"><span class="pre">PostsController::manager_add()</span></code>。</p>
<p>而且，当前前缀在控制器方法中可以通过 <code class="docutils literal"><span class="pre">$this-&gt;request-&gt;prefix</span></code> 得到。</p>
<p>当使用前缀路由时，重要的是要记住，使用 HTML 助件来构建链接会帮助维护前缀调用。下
面是如何使用 HTML 助件来构建链接:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// 进入前缀路由。</span>
<span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span>
    <span class="s1">&#39;Manage posts&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;manager&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// 离开前缀</span>
<span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span>
    <span class="s1">&#39;View Post&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;manager&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="index-3">
<span id="id9"></span><h3>插件路由<a class="headerlink" href="#index-3" title="永久链接至标题">¶</a></h3>
<p>插件路由使用 <strong>plugin</strong> 键。你可以创建指向插件的链接，但需在网址数组中添加
plugin 键:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span>
    <span class="s1">&#39;New todo&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;plugin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;todo_items&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;create&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>相反如果当前有效请求是对插件的请求，而你又要创建不带插件的链接，你可以这么做:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span>
    <span class="s1">&#39;New todo&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;plugin&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>通过设置 <code class="docutils literal"><span class="pre">plugin</span> <span class="pre">=&gt;</span> <span class="pre">null</span></code>，你告诉路由器你要创建的链接不是插件的一部分。</p>
</div>
<div class="section" id="file-extensions">
<span id="index-4"></span><span id="id10"></span><h3>文件扩展名<a class="headerlink" href="#file-extensions" title="永久链接至标题">¶</a></h3>
<p>要让你的路由处理不同的文件扩展名，你需要在路由配置文件中多加一行:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">parseExtensions</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;rss&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>这会告诉路由器去掉任何匹配的文件扩展名，解析剩余的部分。</p>
<p>如果你要创建象 /page/title-of-page.html 这样的网址，你可以创建如下所示的路由:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/page/:title&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pages&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;pass&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>然后，要创建映射回上述路由的链接，简单地使用:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span>
    <span class="s1">&#39;Link title&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pages&#39;</span><span class="p">,</span>
        <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;super-article&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ext&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;html&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>文件扩展名被 <a class="reference internal" href="../core-libraries/components/request-handling.html#RequestHandlerComponent" title="RequestHandlerComponent"><code class="xref php php-class docutils literal"><span class="pre">RequestHandlerComponent</span></code></a> 用来进行基于内容类型的自动视图
切换。欲知详情，请参看 RequestHandlerComponent。</p>
</div>
<div class="section" id="route-conditions">
<span id="id11"></span><h3>使用额外条件匹配路由<a class="headerlink" href="#route-conditions" title="永久链接至标题">¶</a></h3>
<p>当创建路由时，你也许要基于特定的请求/环境设置来限制某些网址。一个很好的例子是
<a class="reference internal" href="rest.html"><span class="doc">REST</span></a> 路由。你可以在 <a class="reference internal" href="#Router::connect" title="Router::connect"><code class="xref php php-meth docutils literal"><span class="pre">Router::connect()</span></code></a> 的 <code class="docutils literal"><span class="pre">$defaults</span></code> 参数指
定额外的条件。默认情况下 CakePHP 提供3个环境条件，但是你可以用
<a class="reference internal" href="#custom-route-classes"><span class="std std-ref">自定义路由类</span></a> 添加更多(的条件)。内置的选项为：</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">[type]</span></code> 只匹配特定内容类型的请求。</li>
<li><code class="docutils literal"><span class="pre">[method]</span></code> 只匹配有特定 HTTP 动词的请求。</li>
<li><code class="docutils literal"><span class="pre">[server]</span></code> 只有当 $_SERVER[&#8216;SERVER_NAME&#8217;] 匹配给定值时才会匹配。</li>
</ul>
<p>我们在这里提供一个简单的例子，说明如何使用 <code class="docutils literal"><span class="pre">[method]</span></code> 选项来创建自定义 RESTful
路由:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s2">&quot;/:controller/:id&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s2">&quot;action&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;edit&quot;</span><span class="p">,</span> <span class="s2">&quot;[method]&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;PUT&quot;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;[0-9]+&quot;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>以上路由只会匹配 <code class="docutils literal"><span class="pre">PUT</span></code> 请求。使用这些条件，你能够创建自定义 REST 路由，或者其
它依赖于请求数据的信息。</p>
</div>
</div>
<div class="section" id="passed-arguments">
<span id="index-5"></span><span id="id12"></span><h2>传入参数<a class="headerlink" href="#passed-arguments" title="永久链接至标题">¶</a></h2>
<p>传入参数(<em>passed argument</em>)是发起请求时使用的其它参数或路径片段。它们经常用来给
控制器方法传递参数。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">://</span><span class="nx">localhost</span><span class="o">/</span><span class="nx">calendars</span><span class="o">/</span><span class="nx">view</span><span class="o">/</span><span class="nx">recent</span><span class="o">/</span><span class="nx">mark</span>
</pre></div>
</div>
<p>在上面的例子中，<code class="docutils literal"><span class="pre">recent</span></code> 和 <code class="docutils literal"><span class="pre">mark</span></code> 都是 <code class="docutils literal"><span class="pre">CalendarsController::view()</span></code> 的参
数。传入参数以三种方式提供给控制器。首先可以作为被调用动作方法的参数，其次可以在
<code class="docutils literal"><span class="pre">$this-&gt;request-&gt;params['pass']</span></code> 中作为数字索引的数组访问。最后，可以在
<code class="docutils literal"><span class="pre">$this-&gt;passedArgs</span></code> 中通过和第二种同样的方式访问。在使用自定义路由时，你也可以
强制特定的参数作为传入参数。</p>
<p>如果你访问上面提到的网址，控制器动作如下:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">CalendarsController</span> <span class="k">extends</span> <span class="nx">AppController</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">view</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">debug</span><span class="p">(</span><span class="nb">func_get_args</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>你就会得到如下输出:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">recent</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">mark</span>
<span class="p">)</span>
</pre></div>
</div>
<p>同样的数据也可以在控制器、视图和助件中通过 <code class="docutils literal"><span class="pre">$this-&gt;request-&gt;params['pass']</span></code> 和
<code class="docutils literal"><span class="pre">$this-&gt;passedArgs</span></code> 得到。在 pass 数组中的值以它们在调用的网址中出现的顺序作为
数字索引:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">debug</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]);</span>
<span class="nx">debug</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">passedArgs</span><span class="p">);</span>
</pre></div>
</div>
<p>上面的任何一个都会输出:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">recent</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">mark</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">$this-&gt;passedArgs 也可能会包含命名参数(<em>named parameter</em>)，因为命名数组和传
入参数混杂在一起。</p>
</div>
<p>在生成网址时，使用 <a class="reference internal" href="../appendices/glossary.html#term-routing-array"><span class="xref std std-term">routing array</span></a>，你可以添加不带字符串索引的值作为传入参
数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>因为 <code class="docutils literal"><span class="pre">5</span></code> 有数字键，所以它会被当作传入参数。</p>
</div>
<div class="section" id="named-parameters">
<span id="index-6"></span><span id="id13"></span><h2>命名参数<a class="headerlink" href="#named-parameters" title="永久链接至标题">¶</a></h2>
<p>你可以给参数命名并用网址传递它们的值。对
<code class="docutils literal"><span class="pre">/posts/view/title:first/category:general</span></code> 的请求会导致对 PostsController 控制
器的 view() 动作的调用。在这个动作中，你可以在 <code class="docutils literal"><span class="pre">$this-&gt;params['named']</span></code> 中得到
title 和 category 参数的值。它们也可以在 <code class="docutils literal"><span class="pre">$this-&gt;passedArgs</span></code> 中得到。在这两种
情况中，都可以用它们的名称作为索引来访问。如果省略了命名参数，它们就不会(在这两
个数组中)被设置。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">什么会被解析为命名参数，是由 <a class="reference internal" href="#Router::connectNamed" title="Router::connectNamed"><code class="xref php php-meth docutils literal"><span class="pre">Router::connectNamed()</span></code></a> 方法控制的。
如果你的命名参数不支持反向路由，或不能正确解析，你就需要让
<a class="reference internal" href="#Router" title="Router"><code class="xref php php-class docutils literal"><span class="pre">Router</span></code></a> 知道它们(的存在)。</p>
</div>
<p>一些默认路由的总结性例子也许有用:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">使用默认路由从网址到控制器动作的映射：</span>

<span class="nx">网址：</span> <span class="nx">URL</span><span class="o">:</span> <span class="o">/</span><span class="nx">monkeys</span><span class="o">/</span><span class="nx">jump</span>
<span class="nx">映射：</span> <span class="nx">Mapping</span><span class="o">:</span> <span class="nx">MonkeysController</span><span class="o">-&gt;</span><span class="na">jump</span><span class="p">();</span>

<span class="nx">网址：</span> <span class="nx">URL</span><span class="o">:</span> <span class="o">/</span><span class="nx">products</span>
<span class="nx">映射：</span> <span class="nx">Mapping</span><span class="o">:</span> <span class="nx">ProductsController</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">();</span>

<span class="nx">网址：</span> <span class="nx">URL</span><span class="o">:</span> <span class="o">/</span><span class="nx">tasks</span><span class="o">/</span><span class="nx">view</span><span class="o">/</span><span class="mi">45</span>
<span class="nx">映射：</span> <span class="nx">Mapping</span><span class="o">:</span> <span class="nx">TasksController</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="mi">45</span><span class="p">);</span>

<span class="nx">网址：</span> <span class="nx">URL</span><span class="o">:</span> <span class="o">/</span><span class="nx">donations</span><span class="o">/</span><span class="nx">view</span><span class="o">/</span><span class="nx">recent</span><span class="o">/</span><span class="mi">2001</span>
<span class="nx">映射：</span> <span class="nx">Mapping</span><span class="o">:</span> <span class="nx">DonationsController</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s1">&#39;recent&#39;</span><span class="p">,</span> <span class="s1">&#39;2001&#39;</span><span class="p">);</span>

<span class="nx">网址：</span> <span class="nx">URL</span><span class="o">:</span> <span class="o">/</span><span class="nx">contents</span><span class="o">/</span><span class="nx">view</span><span class="o">/</span><span class="nx">chapter</span><span class="o">:</span><span class="nx">models</span><span class="o">/</span><span class="nx">section</span><span class="o">:</span><span class="nx">associations</span>
<span class="nx">映射：</span> <span class="nx">Mapping</span><span class="o">:</span> <span class="nx">ContentsController</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">();</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">passedArgs</span><span class="p">[</span><span class="s1">&#39;chapter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;models&#39;</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">passedArgs</span><span class="p">[</span><span class="s1">&#39;section&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;associations&#39;</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="s1">&#39;named&#39;</span><span class="p">][</span><span class="s1">&#39;chapter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;models&#39;</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="s1">&#39;named&#39;</span><span class="p">][</span><span class="s1">&#39;section&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;associations&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>当制定自定义路由时，一个常见错误是，使用命名参数会破坏你的自定义路由。为了解决这
个问题，你应当告诉路由器哪个参数要作为命名参数。不知道这个，路由器就无法决定命名
的参数实际上是要作为命名参数还是路由参数，而会默认认为你要它们作为路由参数。要在
路由器中使用命名参数，请使用 <a class="reference internal" href="#Router::connectNamed" title="Router::connectNamed"><code class="xref php php-meth docutils literal"><span class="pre">Router::connectNamed()</span></code></a> 方法:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connectNamed</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;chapter&#39;</span><span class="p">,</span> <span class="s1">&#39;section&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>这会确保反向路由正确地处理你的 chapter 和 section 参数。</p>
<p>当生成网址时，使用 <a class="reference internal" href="../appendices/glossary.html#term-routing-array"><span class="xref std std-term">routing array</span></a> 就可以把和名称匹配的字符串键及其值添加
为命名参数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;chapter&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;association&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>因为 &#8216;chapter&#8217; 不匹配任何定义的路由元素，它就会被认为是命名参数。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">命名参数和路由元素共享相同的键空间。最好避免对路由元素和命名参数重用同一个键。</p>
</div>
<p>命名参数也支持使用数组来生成和解析网址。语法和 GET 参数的数组语法非常类似。当生
成网址时可以使用以下语法:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$url</span> <span class="o">=</span> <span class="nx">Router</span><span class="o">::</span><span class="na">url</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span>
    <span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;frontpage&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>以上代码会生成网址 <code class="docutils literal"><span class="pre">/posts/index/filter[published]:1/filter[frontpage]:1</span></code>。然
后参数会被解析，并作为数组存储在控制器的 passedArgs 变量中，就象你把它们发送给
<a class="reference internal" href="#Router::url" title="Router::url"><code class="xref php php-meth docutils literal"><span class="pre">Router::url</span></code></a> 一样:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">passedArgs</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;frontpage&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
<span class="p">);</span>
</pre></div>
</div>
<p>数组也可以深度嵌套，让你在传递参数时有更多的灵活性:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$url</span> <span class="o">=</span> <span class="nx">Router</span><span class="o">::</span><span class="na">url</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span>
    <span class="s1">&#39;models&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;post&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;asc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="s1">&#39;comment&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;spam&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span>
            <span class="p">)</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>你就会得到象这样相当长的网址(折行是为了便于阅读):</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">posts</span><span class="o">/</span><span class="nx">search</span>
  <span class="o">/</span><span class="nx">models</span><span class="p">[</span><span class="nx">post</span><span class="p">][</span><span class="nx">order</span><span class="p">]</span><span class="o">:</span><span class="nx">asc</span><span class="o">/</span><span class="nx">models</span><span class="p">[</span><span class="nx">post</span><span class="p">][</span><span class="nx">filter</span><span class="p">][</span><span class="nx">published</span><span class="p">]</span><span class="o">:</span><span class="mi">1</span>
  <span class="o">/</span><span class="nx">models</span><span class="p">[</span><span class="nx">comment</span><span class="p">][</span><span class="nx">order</span><span class="p">]</span><span class="o">:</span><span class="nx">desc</span><span class="o">/</span><span class="nx">models</span><span class="p">[</span><span class="nx">comment</span><span class="p">][</span><span class="nx">filter</span><span class="p">][</span><span class="nx">spam</span><span class="p">]</span><span class="o">:</span><span class="mi">0</span>
  <span class="o">/</span><span class="nx">users</span><span class="p">[]</span><span class="o">:</span><span class="mi">1</span><span class="o">/</span><span class="nx">users</span><span class="p">[]</span><span class="o">:</span><span class="mi">2</span><span class="o">/</span><span class="nx">users</span><span class="p">[]</span><span class="o">:</span><span class="mi">3</span>
</pre></div>
</div>
<p>得到的要传递给控制器的数组，和传递给路由器的是一致的:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">passedArgs</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;post&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;asc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
        <span class="p">)</span>
    <span class="p">),</span>
    <span class="s1">&#39;comment&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;spam&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span>
        <span class="p">)</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="section" id="controlling-named-parameters">
<span id="id14"></span><h3>控制命名参数<a class="headerlink" href="#controlling-named-parameters" title="永久链接至标题">¶</a></h3>
<p>你可以在路由级别或者在全局级别控制命名参数的配置。全局控制通过
<code class="docutils literal"><span class="pre">Router::connectNamed()</span></code> 进行。下面是一些例子，说明如何使用 connectNamed() 方
法来控制命名参数的解析。</p>
<p>不解析任何命名参数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connectNamed</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>
</div>
<p>只解析 CakePHP 用于分页的默认参数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connectNamed</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">));</span>
</pre></div>
</div>
<p>只有当 page 参数是数字时才只解析它:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connectNamed</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[\d]+&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;greedy&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>只解析 page 参数，不论它是什么:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connectNamed</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;greedy&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>如果当前动作是 &#8216;index&#8217;，只解析 page 参数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connectNamed</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">)),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;greedy&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>如果当前动作是 &#8216;index&#8217; 而且控制器是 &#8216;pages&#8217;，只解析 page 参数:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connectNamed</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pages&#39;</span><span class="p">)),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;greedy&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>connectNamed() 方法支持一些选项：</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">greedy</span></code> 设置为 true 会使路由器解析所有命名参数。设置为 false 则只会解析连接
的命名参数。</li>
<li><code class="docutils literal"><span class="pre">default</span></code> 设置为 true 会合并入默认的一组命名参数。</li>
<li><code class="docutils literal"><span class="pre">reset</span></code> 设置为 true 来清除现有的规则，从头开始。</li>
<li><code class="docutils literal"><span class="pre">separator</span></code> 改变在命名参数中用来分隔键和值的字符串。默认为 <cite>:</cite>。</li>
</ul>
</div>
</div>
<div class="section" id="id15">
<h2>反向路由<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h2>
<p>反向路由是 CakePHP 中的特性，用来让你容易地改变网址结构，而不必改动所有代码。使
用 <a class="reference internal" href="../appendices/glossary.html#term-routing-array"><span class="xref std std-term">路由数组</span></a> 来定义网址，以后你就可以配置路由，而生成的网
址就会自动更新。</p>
<p>如果象下面这样用字符串创建网址:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="s1">&#39;/posts/view/&#39;</span> <span class="o">.</span> <span class="nv">$id</span><span class="p">);</span>
</pre></div>
</div>
<p>而后来决定 <code class="docutils literal"><span class="pre">/posts</span></code> 实际上应该叫做 &#8216;articles&#8217;，你就不得不查看整个应用程序的代
码，替换网址。然而，如果象下面这样定义链接:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span>
    <span class="s1">&#39;View&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>那么当你决定改变网址时，你可以只定义一个路由就达到目的。这不但会改变接收网址的映
射，也改变了生成的网址。</p>
<p>在使用数组网址时，你可以使用特殊的键来定义查询字符串(<em>query string</em>)参数和文档片
段(<em>document fragment</em>):</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">url</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span>
    <span class="s1">&#39;?&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;#&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;top&#39;</span>
<span class="p">));</span>

<span class="c1">// 会生成类似这样的网址</span>
<span class="o">/</span><span class="nx">posts</span><span class="o">/</span><span class="nx">index</span><span class="o">?</span><span class="nx">page</span><span class="o">=</span><span class="mi">1</span><span class="c1">#top</span>
</pre></div>
</div>
</div>
<div class="section" id="redirect-routing">
<span id="id16"></span><h2>重定向路由<a class="headerlink" href="#redirect-routing" title="永久链接至标题">¶</a></h2>
<p>重定向路由让你可以对收到的路由发送 HTTP 状态 30x 重定向，把它们指向不同的网址。
这可以用于当你想要通知客户端应用程序，一个资源被移动了，而你又不想为同一内容分配
两个网址。</p>
<p>重定向路由不同于普通路由，因为如果遇到匹配的网址，实际上会执行文件头重定向。重定
向可以指向应用程序内的目标，也可以指向外部的地址:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">redirect</span><span class="p">(</span>
    <span class="s1">&#39;/home/*&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span>
    <span class="c1">// 或者对视图动作等待 $id 作为参数的默认路由，使用</span>
    <span class="c1">// array(&#39;persist&#39;=&gt;array(&#39;id&#39;))</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;persist&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>重定向 <code class="docutils literal"><span class="pre">/home/*</span></code> 到 <code class="docutils literal"><span class="pre">/posts/view</span></code>，并传递参数到 <code class="docutils literal"><span class="pre">/posts/view</span></code>。使用数组作
为重定向目标让你可以使用其它路由来定义字符串网址应该重定向到哪里。你可以使用字符
串网址作为目标重定向到外部地址:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">redirect</span><span class="p">(</span><span class="s1">&#39;/posts/*&#39;</span><span class="p">,</span> <span class="s1">&#39;http://google.com&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="mi">302</span><span class="p">));</span>
</pre></div>
</div>
<p>这会以 HTTP 状态 302 重定向 <code class="docutils literal"><span class="pre">/posts/*</span></code> 到 <code class="docutils literal"><span class="pre">http://google.com</span></code>。</p>
</div>
<div class="section" id="disabling-default-routes">
<span id="id17"></span><h2>关闭默认路由<a class="headerlink" href="#disabling-default-routes" title="永久链接至标题">¶</a></h2>
<p>如果你完全自定义了全部路由，并想要避免任何可能来自搜索引擎的重复内容惩罚，你可以
从应用程序的 routes.php 文件删除 CakePHP 提供的默认路由来去掉它们。</p>
<p>当用户试图访问通常由 CakePHP 提供但没有显式连接的网址，就会引起 CakePHP 报错。</p>
</div>
<div class="section" id="custom-route-classes">
<span id="id18"></span><h2>自定义路由类<a class="headerlink" href="#custom-route-classes" title="永久链接至标题">¶</a></h2>
<p>自定义路由类让你可以扩展并改变单个路由如何解析请求和处理反向路由。自定义路由应当
在 <code class="docutils literal"><span class="pre">app/Routing/Route</span></code> 目录中创建，而且应当扩展 <a class="reference internal" href="#CakeRoute" title="CakeRoute"><code class="xref php php-class docutils literal"><span class="pre">CakeRoute</span></code></a> 并实现
<code class="docutils literal"><span class="pre">match()</span></code> 和 <code class="docutils literal"><span class="pre">parse()</span></code> 两个方法中的一个或全部。<code class="docutils literal"><span class="pre">parse()</span></code> 方法用于解析请求，
而 <code class="docutils literal"><span class="pre">match()</span></code> 方法用于处理反向路由。</p>
<p>要使用自定义路由，你可以在指定路由时使用 <code class="docutils literal"><span class="pre">routeClass</span></code> 选项，并且在使用它之前加
载包含路由(类)的文件:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;SlugRoute&#39;</span><span class="p">,</span> <span class="s1">&#39;Routing/Route&#39;</span><span class="p">);</span>

<span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
     <span class="s1">&#39;/:slug&#39;</span><span class="p">,</span>
     <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span>
     <span class="k">array</span><span class="p">(</span><span class="s1">&#39;routeClass&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;SlugRoute&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这个路由会创建一个 <code class="docutils literal"><span class="pre">SlugRoute</span></code> 类的实例，让你可以实现自定义参数处理。</p>
</div>
<div class="section" id="api">
<h2>路由 API<a class="headerlink" href="#api" title="永久链接至标题">¶</a></h2>
<dl class="class">
<dt id="Router">
<em class="property">class </em><code class="descname">Router</code><a class="headerlink" href="#Router" title="永久链接至目标">¶</a></dt>
<dd><p>路由器管理发出网址的生成、解析接收的请求网址为 CakePHP 可以调配的参数集。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::connect">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">connect</code><span class="sig-paren">(</span><em>$route</em>, <em>$defaults = array()</em>, <em>$options = array()</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::connect" title="永久链接至目标">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>$route</strong> (<em>string</em>) &#8211; 描述路由模板的字符串。</li>
<li><strong>$defaults</strong> (<em>array</em>) &#8211; 描述默认路由参数的数组。这些参数默认会被使用，可以被
提供非动态的路由参数。</li>
<li><strong>$options</strong> (<em>array</em>) &#8211; 路由中命名元素和对应的元素应当匹配的正则表达式构成的
数组。也包含额外的参数，比如哪个路由参数应当移入传入参数，提供路由参数的
模式，以及提供自定义路由类的名称。</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>路由是一种连接请求网址和应用程序中的对象的方法。在其核心，路由是用于匹配请求
到目的地的一组正则表达式。</p>
<p>例如:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span><span class="s1">&#39;/:controller/:action/*&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>第一个参数被当作控制器名称，而第二个参数被当作当作名称。&#8217;/*&#8217; 语法使该路由贪
婪，这样它就会匹配象 <cite>/posts/index</cite> 以及象 <code class="docutils literal"><span class="pre">/posts/edit/1/foo/bar</span></code> 这样的
请求。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/home-page&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pages&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;home&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>上面这个说明路由参数默认值的用法。而为静态路由提供路由参数。</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span>
    <span class="s1">&#39;/:lang/:controller/:action/:id&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="s1">&#39;lang&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[a-z]{3}&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>说明连接路由和自定义路由参数，以及为这些参数提供模式。路由参数的模式不需要捕
获分组(<em>capturing group</em>)，因为每个路由参数都会(自动)添加一个(捕获分组)。</p>
<p>$options 参数提供了三个&#8217;特殊的&#8217;键。<code class="docutils literal"><span class="pre">pass</span></code> 、 <code class="docutils literal"><span class="pre">persist</span></code> 和 <code class="docutils literal"><span class="pre">routeClass</span></code>
在 $options 数组中有特殊的含义。</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">pass</span></code> 用于定义那个路由参数应当移入 pass 数组。添加参数到 pass 数组会把
它从正常的路由数组中删除。例如 <code class="docutils literal"><span class="pre">'pass'</span> <span class="pre">=&gt;</span> <span class="pre">array('slug')</span></code>。</li>
<li><code class="docutils literal"><span class="pre">persist</span></code> 用于定义在生成新网址时哪个路由参数应当自动包括在内。你可以覆盖
持久参数，只需在网址中重新定义它们，或者通过设置该参数为 <code class="docutils literal"><span class="pre">false</span></code>。例如
<code class="docutils literal"><span class="pre">'persist'</span> <span class="pre">=&gt;</span> <span class="pre">array('lang')</span></code>。</li>
<li><code class="docutils literal"><span class="pre">routeClass</span></code> 用于通过自定义路由类来扩展和改变单个路由如何解析请求及处理
反向路由。例如 <code class="docutils literal"><span class="pre">'routeClass'</span> <span class="pre">=&gt;</span> <span class="pre">'SlugRoute'</span></code>。</li>
<li><code class="docutils literal"><span class="pre">named</span></code> 用于在路由级别配置命名参数。该键使用与
<a class="reference internal" href="#Router::connectNamed" title="Router::connectNamed"><code class="xref php php-meth docutils literal"><span class="pre">Router::connectNamed()</span></code></a> 相同的键。</li>
</ul>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::redirect">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">redirect</code><span class="sig-paren">(</span><em>$route</em>, <em>$url</em>, <em>$options = array()</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::redirect" title="永久链接至目标">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>$route</strong> (<em>string</em>) &#8211; 路由模板，决定哪些网址要重定向。</li>
<li><strong>$url</strong> (<em>mixed</em>) &#8211; 重定向目的地，或者是 <a class="reference internal" href="../appendices/glossary.html#term-routing-array"><span class="xref std std-term">routing array</span></a> 或者是字符串网
址。</li>
<li><strong>$options</strong> (<em>array</em>) &#8211; 重定向选项数组。</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>连接路由器中新的重定向路由。欲知详情，请参见 <a class="reference internal" href="#redirect-routing"><span class="std std-ref">重定向路由</span></a>。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::connectNamed">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">connectNamed</code><span class="sig-paren">(</span><em>$named</em>, <em>$options = array()</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::connectNamed" title="永久链接至目标">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>$named</strong> (<em>array</em>) &#8211; 命名参数列表。接受键值对，值为要匹配的正则表达式字符串、
或者数组。</li>
<li><strong>$options</strong> (<em>array</em>) &#8211; 可以控制所有设置：
separator、greedy、reset、default。</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>指定 CakePHP 应当从接收的网址中解析哪些命名参数。默认情况下，CakePHP 会从收
到的网址中解析所有命名参数。欲知详情，请参见
<a class="reference internal" href="#controlling-named-parameters"><span class="std std-ref">控制命名参数</span></a>。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::promote">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">promote</code><span class="sig-paren">(</span><em>$which = null</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::promote" title="永久链接至目标">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>$which</strong> (<em>integer</em>) &#8211; 从零开始的数组索引，代表要移动的路由。例如，如果添加
了 3 个路由，最后一个路由就是 2。</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>把一个路由(默认情况下，是最后一个添加的)提前到列表的最开始。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::url">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">url</code><span class="sig-paren">(</span><em>$url = null</em>, <em>$full = false</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::url" title="永久链接至目标">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>$url</strong> (<em>mixed</em>) &#8211; CakePHP 的相对网址，比如 &#8220;/products/edit/92&#8221; 或者
&#8220;/presidents/elect/4&#8221; 或者 <a class="reference internal" href="../appendices/glossary.html#term-routing-array"><span class="xref std std-term">routing array</span></a></li>
<li><strong>$full</strong> (<em>mixed</em>) &#8211; <p>如果是 (boolean) true，完整的基准目录网址会加在结果前面。
如果是数组，则接受如下的键</p>
<blockquote>
<div><ul>
<li>escape — 用于当生成嵌入 HTML 的网址时，转义查询字符串&#8217;&amp;&#8217;</li>
<li>full — 如果为 true，完整的基准目录网址会加在前面。</li>
</ul>
</div></blockquote>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>生成指定动作的网址。返回网址指向控制器和动作组合的网址。$url 可以是：</p>
<ul class="simple">
<li>Empty — 该方法会寻找真正的控制器/动作的地址。</li>
<li>&#8216;/&#8217; — 该方法会寻找应用程序的基准网址。</li>
<li>控制器/动作的组合 — 该方法会寻找其对应的网址。</li>
</ul>
<p>有一些&#8217;特殊&#8217;的参数会改变最终生成的网址字符串：</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">base</span></code> — 设置为 false 来去掉生成的网址中的基准路径。如果你的应用程序不在
根目录，这可以用来生成&#8217;CakePHP 的相对&#8217;网址。CakePHP 的相对网址在使用
requestAction 是必须的。</li>
<li><code class="docutils literal"><span class="pre">?</span></code> — 接受查询字符串参数数组</li>
<li><code class="docutils literal"><span class="pre">#</span></code> — 让你可以设置网址哈希片段(<em>hash fragment</em>)。</li>
<li><code class="docutils literal"><span class="pre">full_base</span></code> — 如果是 true，<a class="reference internal" href="#Router::fullBaseUrl" title="Router::fullBaseUrl"><code class="xref php php-meth docutils literal"><span class="pre">Router::fullBaseUrl()</span></code></a> 的值会附加
在生成的网址的前面。</li>
</ul>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::mapResources">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">mapResources</code><span class="sig-paren">(</span><em>$controller</em>, <em>$options = array()</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::mapResources" title="永久链接至目标">¶</a></dt>
<dd><p>创建给定控制器的 REST 资源路由。欲知详情，请参见 <a class="reference internal" href="rest.html"><span class="doc">REST</span></a> 一
节。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::parseExtensions">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">parseExtensions</code><span class="sig-paren">(</span><em>$types</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::parseExtensions" title="永久链接至目标">¶</a></dt>
<dd><p>用在 routes.php 文件中来声明应用程序支持哪个 <a class="reference internal" href="#file-extensions"><span class="std std-ref">文件扩展名</span></a>。不提供
参数，则支持所有的文件扩展名。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::setExtensions">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">setExtensions</code><span class="sig-paren">(</span><em>$extensions</em>, <em>$merge = true</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::setExtensions" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">2.2 新版功能.</span></p>
</div>
<p>设置或添加合法的扩展名。要解析扩展名，你仍然必须调用
<a class="reference internal" href="#Router::parseExtensions" title="Router::parseExtensions"><code class="xref php php-meth docutils literal"><span class="pre">Router::parseExtensions()</span></code></a> 方法。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::defaultRouteClass">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">defaultRouteClass</code><span class="sig-paren">(</span><em>$classname</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::defaultRouteClass" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">2.1 新版功能.</span></p>
</div>
<p>设置将来连接路由时使用的默认路由。</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Router::fullBaseUrl">
<em class="property">static </em><code class="descclassname">Router::</code><code class="descname">fullBaseUrl</code><span class="sig-paren">(</span><em>$url = null</em><span class="sig-paren">)</span><a class="headerlink" href="#Router::fullBaseUrl" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">2.4 新版功能.</span></p>
</div>
<p>获得或设置生成网址时使用的基准网址(<em>baseURL</em>)。设置该值时，应当确保引入包括
协议的完全合格域名(<em>fully qualified domain name</em>)。</p>
<p>用该方法设置值，也会更新 <a class="reference internal" href="configuration.html#Configure" title="Configure"><code class="xref php php-class docutils literal"><span class="pre">Configure</span></code></a> 中的 <code class="docutils literal"><span class="pre">App.fullBaseUrl</span></code>。</p>
</dd></dl>

<dl class="class">
<dt id="CakeRoute">
<em class="property">class </em><code class="descname">CakeRoute</code><a class="headerlink" href="#CakeRoute" title="永久链接至目标">¶</a></dt>
<dd><p>自定义路由基于的基类。</p>
</dd></dl>

<dl class="method">
<dt id="CakeRoute::parse">
<code class="descclassname">CakeRoute::</code><code class="descname">parse</code><span class="sig-paren">(</span><em>$url</em><span class="sig-paren">)</span><a class="headerlink" href="#CakeRoute::parse" title="永久链接至目标">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>$url</strong> (<em>string</em>) &#8211; 要解析的字符串网址。</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>解析收到的网址，并生成请求参数数组，供调度器(<em>dispatcher</em>)处理。扩展这个方法
让你可以定制如何把收到的网址转换成数组。从网址返回 <code class="docutils literal"><span class="pre">false</span></code> 来表示不匹配。</p>
</dd></dl>

<dl class="method">
<dt id="CakeRoute::match">
<code class="descclassname">CakeRoute::</code><code class="descname">match</code><span class="sig-paren">(</span><em>$url</em><span class="sig-paren">)</span><a class="headerlink" href="#CakeRoute::match" title="永久链接至目标">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>$url</strong> (<em>array</em>) &#8211; 要转换成字符串网址的路由数组。</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>试图匹配网址数组。如果网址匹配路由参数和设置，就返回生成的字符串网址。如果网
址不匹配路由参数，返回 false。该方法处理网址数组的反向路由或转换为字符串网址。</p>
</dd></dl>

<dl class="method">
<dt id="CakeRoute::compile">
<code class="descclassname">CakeRoute::</code><code class="descname">compile</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CakeRoute::compile" title="永久链接至目标">¶</a></dt>
<dd><p>强制路由编译它的正则表达式。</p>
</dd></dl>

</div>
</div>


			</div>
		</div>

		
		<div class="col-md-3 col-md-pull-9 pull-off hidden-xs hidden-sm" lang="zh">
			<aside class="sidebar">
				<div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">欢迎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cakephp-overview.html">CakePHP 概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">视图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries.html">核心库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">插件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Shells，任务与命令行工具</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../development.html">开发</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="configuration.html">配置</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">路由</a></li>
<li class="toctree-l2"><a class="reference internal" href="sessions.html">会话</a></li>
<li class="toctree-l2"><a class="reference internal" href="exceptions.html">异常</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">错误处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">调试</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest.html">REST</a></li>
<li class="toctree-l2"><a class="reference internal" href="dispatch-filters.html">调度器过滤器</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">教程 &amp; 实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

				</div>
			</aside>
			<aside class="sidebar">
				<div class="mb30 row">
				</div>
			</aside>
		</div>
	</div>
</div>

<section id="socials" class="back-3">
	<div class="container-fluid">
		<div class="row">
			<div class="col-xs-12 col-sm-12 col-md-4  social text-center">
				<div class="col-sm-3 col-xs-3">
					<div id="fb-root"></div>
						<script>(function(d, s, id) {
						  var js, fjs = d.getElementsByTagName(s)[0];
						  if (d.getElementById(id)) return;
						  js = d.createElement(s); js.id = id;
						  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
						  fjs.parentNode.insertBefore(js, fjs);
						}(document, 'script', 'facebook-jssdk'));
						</script>
						<div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
				</div>

				<div class="col-sm-3 col-xs-3">
					<iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
				</div>

				<div class="col-sm-3 col-xs-3">
					<iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
				</div>

				<div class="col-sm-3 col-xs-3">
					<a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
				</div>
			</div>

			<div class="col-xs-12 col-sm-12 col-md-8 social-footer text-center ">
				<a href="#">发现翻译错误? 请在下面留言</a>
				<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">我要加入翻译</a>
				<a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
				<a href="http://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
				<a href="http://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
				<a href="http://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
				<a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
				<a href="http://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
				<a href="http://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
				<a href="http://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
			</div>
		</div>
	</div>
</section>

<footer id="footer" class="footer-wrapper">
	<div class="container">

		<div class="row col-p30">
			<div class="col-sm-12 col-md-3">
				<div class="footer-widget t-footer">
					<div class="col-md-12">
						<a href="https://www.openhub.net/p/cakephp">
							<img src="../_static/open-hub.png">
						</a>
						<div class="mt10">
							<a href="https://www.rackspace.com/">
								<img src="../_static/rackspace.png">
							</a>
						</div>
					</div>
				</div>
			</div>

			<div class="col-sm-12 col-md-9">
				<div class="col-md-3 col-sm-6 business-solution">
					<ul class="footer-menu">
						<li class="menu-title">
	<a href="http://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
	<a href="http://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
					</ul>
				</div>

				<div class="col-md-3 col-sm-6">
					<ul class="footer-menu">
						
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="http://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>CookBook</a></li>
<li><a href="http://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="http://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="http://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="http://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
					</ul>
				</div>

				<div class="col-md-3 col-sm-6">
					<ul class="footer-menu">
						
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="http://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="http://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="http://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="http://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="http://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="http://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="http://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
					</ul>
				</div>

				<div class="col-md-3 col-sm-6">
					<ul class="footer-menu">
						
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="http://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="http://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="http://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="http://cakedc.com"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
					</ul>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 text-center mt30">
				<p class="copyright">
							&copy; 版权所有 2016, Cake Software Foundation, Inc.
						最后更新于 8月 09, 2016.
						Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
				</p>
			</div>
		</div>
	</div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-743287-3']);
	_gaq.push(['_trackPageview']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
  </body>
</html>