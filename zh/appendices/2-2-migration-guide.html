
<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2.2 Migration Guide &mdash; CakePHP Cookbook 2.x 文档</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/app.js"></script>
    <script type="text/javascript" src="../_static/modernizr.foundation.js"></script>
    <script type="text/javascript" src="../_static/foundation.js"></script>
    <link rel="top" title="CakePHP Cookbook 2.x 文档" href="../index.html" />
    <link rel="up" title="Appendices" href="../appendices.html" />
    <link rel="next" title="2.1 Migration Guide" href="2-1-migration-guide.html" />
    <link rel="prev" title="2.3 Migration Guide" href="2-3-migration-guide.html" />
<link href="../_static/favicon.ico" type="image/x-icon" rel="icon" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="alternate" hreflang="en" href="../../en/appendices/2-2-migration-guide.html" /><link rel="alternate" hreflang="pt" href="../../pt/appendices/2-2-migration-guide.html" /><link rel="alternate" hreflang="es" href="../../es/appendices/2-2-migration-guide.html" /><link rel="alternate" hreflang="ja" href="../../ja/appendices/2-2-migration-guide.html" /><link rel="alternate" hreflang="fr" href="../../fr/appendices/2-2-migration-guide.html" />

<link rel="search" type="application/opensearchdescription+xml" title="CakePHP Book 2.x Search" href="../_static/opensearchdescription-book-2-x.xml">
<script type="text/javascript">
window.lang = "zh_CN";
</script>

  </head>
  <body>

<div id="container">

<div id="cakephp-global-navigation">
	<ul>
		<li class="main"><a href="http://cakephp.org">CakePHP</a></li>
		<li class="primary"><a href="#" class="empty">Downloads</a>
			<ul class="second-level">
				<li><a href="https://github.com/cakephp/cakephp/tags">Releases</a></li>
				<li><a href="http://pear.cakephp.org">Pear channel</a></li>
			</ul>
		</li>
		<li class="primary"><a href="#" class="empty">Documentation</a>
			<ul class="second-level">
				<li><a href="http://api.cakephp.org">API</a></li>
				<li><a href="http://book.cakephp.org">Book</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://community.cakephp.org">Community</a>
			<ul class="second-level">
				<li><a href="http://webchat.freenode.net/?channels=cakephp&uio=MT1mYWxzZSY5PXRydWUmMTE9MjQ2b8">Help &amp; Support</a></li>
				<li><a href="https://github.com/cakephp/cakephp/issues">Issues</a></li>
				<li><a href="http://bakery.cakephp.org">The Bakery</a></li>
				<li><a href="http://stackoverflow.com/tags/cakephp">Stack Overflow</a></li>
				<li><a href="http://www.facebook.com/groups/cake.community">Facebook Group</a></li>
				<li><a href="http://goo.gl/mSC0s">Google+ Community</a></li>
				<li><a href="http://www.youtube.com/user/CakePHP">YouTube Channel</a></li>
				<li><a href="http://podcast.cakephp.org">CakePHP Podcast</a></li>
				<li><a href="http://twitter.com/CakePHP">Follow us on Twitter</a></li>
				<li><a href="http://groups.google.com/group/cake-php">Google Group</a></li>
				<li><a href="http://github.com/cakephp/cakephp/contributors">Contributors</a></li>
				<li><a href="http://plugins.cakephp.org">Plugins &amp; Packages</a></li>
				<li><a href="http://community.cakephp.org/get-involved">Get Involved</a></li>
				<li><a href="http://community.cakephp.org/guidelines">Guidelines</a></li>
				<li><a href="http://cakefest.org">CakeFest</a></li>
				<li><a href="http://cakephp.org/logos">Logo</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://cakephp.org/services">Services</a>
			<ul class="second-level">
				<li><a href="http://cakephp.org/services/certification">Certification</a></li>
				<li><a href="http://cakephp.org/services/consultation">Consultation</a></li>
				<li><a href="http://cakephp.org/services/support">Support</a></li>
				<li><a href="http://training.cakephp.org">Training</a></li>
			</ul>
		</li>
	</ul>
</div>

<div class="masthead">
	<div class="header-backing"></div>
	<div class="searchbar row">
		<div class="columns three phone-one">
			<a class="logo" href="../contents.html">
			<img src="../_static/cake-logo.png" alt="CakePHP" width="70" />
			</a>
		</div>
		
<div id="searchbox" class="columns nine phone-three">

	<form id="searchform" class="search" action="../search.html" method="get">
		<input class="search-input" autocomplete="off" type="search" name="q" size="18" />
		<input class="search-submit search-big button red" type="submit" value="搜索" />
		<input type="hidden" name="check_keywords" value="yes" />
		<input type="hidden" name="area" value="default" />

		<a href="#" id="tablet-nav" class="show-on-phones pale button small">Nav</a>
	</form>

</div>
	</div>
</div>
<div class="breadcrumb-header">
	<div class="related row">
		<div class="columns three root-link">
			<a href="../contents.html">Cookbook 2.x</a>
		</div>
		<div class="columns nine">
			<ul class="inline breadcrumb">
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../appendices.html" accesskey="U" itemprop="url"><span itemprop="title">Appendices</span></a>
			</li>
			</ul>
			<div class="versions dropdown">
				<a href="#">2.x Book</a>
				<ul>
					<li><a href="http://book.cakephp.org/3.0/en">3.0 Book</a></li>
					<li><a href="http://book.cakephp.org/1.3/zh_CN/">1.3 Book</a></li>
					<li><a href="http://book.cakephp.org/1.2/zh_CN/">1.2 Book</a></li>
					<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
				</ul>
			</div>

			<div class="languages dropdown">
				<a href="#">zh_CN</a>

				<ul>
				
					<li><a href="../../en/appendices/2-2-migration-guide.html">en</a></li>
				
					<li><a href="../../pt/appendices/2-2-migration-guide.html">pt</a></li>
				
					<li><a href="../../es/appendices/2-2-migration-guide.html">es</a></li>
				
					<li><a href="../../ja/appendices/2-2-migration-guide.html">ja</a></li>
				
					<li><a href="../../fr/appendices/2-2-migration-guide.html">fr</a></li>
				
					<li></li>
				
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="content row">
	<div class="document columns nine push-three">
		<div class="body"><a class="button pale improve" href="https://github.com/cakephp/docs/edit/master/zh/appendices/2-2-migration-guide.rst" target="_blank">Improve this Doc</a>
  <div class="section" id="migration-guide">
<h1>2.2 Migration Guide<a class="headerlink" href="#migration-guide" title="永久链接至标题">¶</a></h1>
<p>CakePHP 2.2 is a fully API compatible upgrade from 2.0/2.1.  This page outlines the
changes and improvements made for 2.2.</p>
<div class="section" id="required-steps-to-upgrade">
<span id="required-steps-to-upgrade-2-2"></span><h2>Required steps to upgrade<a class="headerlink" href="#required-steps-to-upgrade" title="永久链接至标题">¶</a></h2>
<p>When upgrading to CakePHP 2.2 its important to add a few new configuration
values to <tt class="docutils literal"><span class="pre">app/Config/bootstrap.php</span></tt>.  Adding these will ensure consistent
behavior with 2.1.x:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// Enable the Dispatcher filters for plugin assets, and</span>
<span class="c1">// CacheHelper.</span>
<span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Dispatcher.filters&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;AssetDispatcher&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CacheDispatcher&#39;</span>
<span class="p">));</span>

<span class="c1">// Add logging configuration.</span>
<span class="nx">CakeLog</span><span class="o">::</span><span class="na">config</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;engine&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;FileLog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;types&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;notice&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">),</span>
    <span class="s1">&#39;file&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nx">CakeLog</span><span class="o">::</span><span class="na">config</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;engine&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;FileLog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;types&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span> <span class="s1">&#39;alert&#39;</span><span class="p">,</span> <span class="s1">&#39;emergency&#39;</span><span class="p">),</span>
    <span class="s1">&#39;file&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<p>You will also need to modify <tt class="docutils literal"><span class="pre">app/Config/core.php</span></tt>. Change the value of
<a class="reference internal" href="../development/configuration.html#LOG_ERROR" title="LOG_ERROR"><tt class="xref php php-const docutils literal"><span class="pre">LOG_ERROR</span></tt></a> to <tt class="xref php php-const docutils literal"><span class="pre">LOG_ERR</span></tt>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;LOG_ERROR&#39;</span><span class="p">,</span> <span class="nx">LOG_ERR</span><span class="p">);</span>
</pre></div>
</div>
<p>When using <tt class="docutils literal"><span class="pre">Model::validateAssociated()</span></tt> or <tt class="docutils literal"><span class="pre">Model::saveAssociated()</span></tt> and
primary model validation fails, the validation errors of associated models are no longer wiped out.
<tt class="docutils literal"><span class="pre">Model::$validationErrors</span></tt> will now always show all the errors.
You might need to update your test cases to reflect this change.</p>
</div>
<div class="section" id="console">
<h2>Console<a class="headerlink" href="#console" title="永久链接至标题">¶</a></h2>
<div class="section" id="i18n-extract-shell">
<h3>I18N extract shell<a class="headerlink" href="#i18n-extract-shell" title="永久链接至标题">¶</a></h3>
<ul>
<li><p class="first">An option was added to overwrite existing POT files by default:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="o">./</span><span class="nx">Console</span><span class="o">/</span><span class="nx">cake</span> <span class="nx">i18n</span> <span class="nb">extract</span> <span class="o">--</span><span class="nx">overwrite</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="models">
<h2>Models<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Model::find('count')</span></tt> will now call the custom find methods with
<tt class="docutils literal"><span class="pre">$state</span> <span class="pre">=</span> <span class="pre">'before'</span></tt> and <tt class="docutils literal"><span class="pre">$queryData['operation']</span> <span class="pre">=</span> <span class="pre">'count'</span></tt>.
In many cases custom finds already return correct counts for pagination,
but <tt class="docutils literal"><span class="pre">'operation'</span></tt> key allows more flexibility to build other queries,
or drop joins which are required for the custom finder itself.
As the pagination of custom find methods never worked quite well it required
workarounds for this in the model level, which are now no longer needed.</li>
<li><tt class="docutils literal"><span class="pre">Model::find('first')</span></tt> will now return an empty array when no records are found.</li>
</ul>
</div>
<div class="section" id="datasources">
<h2>Datasources<a class="headerlink" href="#datasources" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>Dbo datasources now supports real nested transactions. If you need to use this
feature in your application, enable it using
<tt class="docutils literal"><span class="pre">ConnectionManager::getDataSource('default')-&gt;useNestedTransactions</span> <span class="pre">=</span> <span class="pre">true;</span></tt></li>
</ul>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>The webrunner now includes links to re-run a test with debug output.</li>
<li>Generated test cases for Controller now subclass
<tt class="xref php php-class docutils literal"><span class="pre">ControllerTestCase</span></tt>.</li>
</ul>
</div>
<div class="section" id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>When repeat exceptions, or exception are raised when rendering error pages,
the new <tt class="docutils literal"><span class="pre">error</span></tt> layout will be used.  It&#8217;s recommended to not use additional
helpers in this layout as its intended for development level errors only. This
fixes issues with fatal errors in rendering error pages due to helper usage in
the <tt class="docutils literal"><span class="pre">default</span></tt> layout.</li>
<li>It is important to copy the <tt class="docutils literal"><span class="pre">app/View/Layouts/error.ctp</span></tt> into your app
directory.  Failing to do so will make error page rendering fail.</li>
<li>You can now configure application specific console error handling.  By setting
<tt class="docutils literal"><span class="pre">Error.consoleHandler</span></tt>, and <tt class="docutils literal"><span class="pre">Exception.consoleHandler</span></tt> you can define the
callback that will handle errors/exceptions raised in console applications.</li>
<li>The handler configured in <tt class="docutils literal"><span class="pre">Error.handler</span></tt> and <tt class="docutils literal"><span class="pre">Error.consoleHandler</span></tt> will
receive fatal error codes (ie. <tt class="docutils literal"><span class="pre">E_ERROR</span></tt>, <tt class="docutils literal"><span class="pre">E_PARSE</span></tt>, <tt class="docutils literal"><span class="pre">E_USER_ERROR</span></tt>).</li>
</ul>
<div class="section" id="exceptions">
<h3>Exceptions<a class="headerlink" href="#exceptions" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>The <a class="reference internal" href="../development/exceptions.html#NotImplementedException" title="NotImplementedException"><tt class="xref php php-class docutils literal"><span class="pre">NotImplementedException</span></tt></a> was added.</li>
</ul>
</div>
</div>
<div class="section" id="core">
<h2>Core<a class="headerlink" href="#core" title="永久链接至标题">¶</a></h2>
<div class="section" id="configure">
<h3>Configure<a class="headerlink" href="#configure" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../development/configuration.html#Configure::dump" title="Configure::dump"><tt class="xref php php-meth docutils literal"><span class="pre">Configure::dump()</span></tt></a> was added.  It is used to persist configuration
data in durable storage like files.  Both <a class="reference internal" href="../development/configuration.html#PhpReader" title="PhpReader"><tt class="xref php php-class docutils literal"><span class="pre">PhpReader</span></tt></a> and
<a class="reference internal" href="../development/configuration.html#IniReader" title="IniReader"><tt class="xref php php-class docutils literal"><span class="pre">IniReader</span></tt></a> work with it.</li>
<li>A new config parameter &#8216;Config.timezone&#8217; is available which you can set to
user&#8217;s timezone string.  eg. You can do <tt class="docutils literal"><span class="pre">Configure::write('Config.timezone',</span>
<span class="pre">'Europe/Paris')</span></tt>.  If a method of <tt class="docutils literal"><span class="pre">CakeTime</span></tt> class is called with
<tt class="docutils literal"><span class="pre">$timezone</span></tt> parameter as null and &#8216;Config.timezone&#8217; is set, then the value
of &#8216;Config.timezone&#8217; will be used. This feature allows you to set user&#8217;s
timezone just once instead of passing it each time in function calls.</li>
</ul>
</div>
</div>
<div class="section" id="controller">
<h2>Controller<a class="headerlink" href="#controller" title="永久链接至标题">¶</a></h2>
<div class="section" id="authcomponent">
<h3>AuthComponent<a class="headerlink" href="#authcomponent" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>The options for adapters defined in <a class="reference internal" href="../core-libraries/components/authentication.html#AuthComponent::$authenticate" title="AuthComponent::$authenticate"><tt class="xref php php-attr docutils literal"><span class="pre">AuthComponent::$authenticate</span></tt></a>
now accepts a <tt class="docutils literal"><span class="pre">contain</span></tt> option. This is used to set containable options for
when user records are loaded.</li>
</ul>
</div>
<div class="section" id="cookiecomponent">
<h3>CookieComponent<a class="headerlink" href="#cookiecomponent" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>You can now encrypt cookie values with the rijndael cipher.  This requires
the <a class="reference external" href="http://php.net/mcrypt">mcrypt</a> extension to be installed.  Using
rijndael gives cookie values actual encryption, and is recommended in place of
the XOR cipher available in previous releases. The XOR cipher is still the
default cipher scheme to maintain compatibility with previous releases. You
can read more in the <a class="reference internal" href="../core-utility-libraries/security.html#Security::rijndael" title="Security::rijndael"><tt class="xref php php-meth docutils literal"><span class="pre">Security::rijndael()</span></tt></a> documentation.</li>
</ul>
</div>
</div>
<div class="section" id="pagination">
<h2>Pagination<a class="headerlink" href="#pagination" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>Paginating custom finders will now return correct counts, see Model changes
for more info.</li>
</ul>
</div>
<div class="section" id="network">
<h2>Network<a class="headerlink" href="#network" title="永久链接至标题">¶</a></h2>
<div class="section" id="cakeemail">
<h3>CakeEmail<a class="headerlink" href="#cakeemail" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeEmail::charset()</span></tt> and <tt class="xref php php-meth docutils literal"><span class="pre">CakeEmail::headerCharset()</span></tt>
were added.</li>
<li>Legacy Japanese encodings are now handled correctly. <tt class="docutils literal"><span class="pre">ISO-2202-JP</span></tt> is used
when the encoding is <tt class="docutils literal"><span class="pre">ISO-2202-JP-MS</span></tt> which works around a number of issues
in mail clients when dealing with the CP932 and Shift_JIS encodings.</li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeEmail::theme()</span></tt> was added.</li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeEmail::domain()</span></tt> was added. You can use this method to set the
domain name used when sending email from a CLI script or if you want to
control the hostname used to send email.</li>
<li>You can now define <tt class="docutils literal"><span class="pre">theme</span></tt> and <tt class="docutils literal"><span class="pre">helpers</span></tt> in your EmailConfig class.</li>
</ul>
</div>
<div class="section" id="cakerequest">
<h3>CakeRequest<a class="headerlink" href="#cakerequest" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>CakeRequest will now automatically decode
<tt class="docutils literal"><span class="pre">application/x-www-form-urlencoded</span></tt> request bodies on <tt class="docutils literal"><span class="pre">PUT</span></tt> and <tt class="docutils literal"><span class="pre">DELETE</span></tt>
requests.  This data will be available as <tt class="docutils literal"><span class="pre">$this-&gt;data</span></tt> just like POST data
is.</li>
</ul>
</div>
</div>
<div class="section" id="utility">
<h2>Utility<a class="headerlink" href="#utility" title="永久链接至标题">¶</a></h2>
<div class="section" id="set">
<h3>Set<a class="headerlink" href="#set" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>The <a class="reference internal" href="../core-utility-libraries/set.html#Set" title="Set"><tt class="xref php php-class docutils literal"><span class="pre">Set</span></tt></a> class is now deprecated, and replaced by the <a class="reference internal" href="../core-utility-libraries/hash.html#Hash" title="Hash"><tt class="xref php php-class docutils literal"><span class="pre">Hash</span></tt></a> class.
Set will not be removed until 3.0.</li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">Set::expand()</span></tt> was added.</li>
</ul>
</div>
<div class="section" id="hash">
<h3>Hash<a class="headerlink" href="#hash" title="永久链接至标题">¶</a></h3>
<p>The <a class="reference internal" href="../core-utility-libraries/hash.html#Hash" title="Hash"><tt class="xref php php-class docutils literal"><span class="pre">Hash</span></tt></a> class was added in 2.2.  It replaced Set providing a more
consistent, reliable and performant API to doing many of the same tasks Set
does. See the <a class="reference internal" href="../core-utility-libraries/hash.html"><em>Hash</em></a> page for more detail.</p>
</div>
<div class="section" id="caketime">
<h3>CakeTime<a class="headerlink" href="#caketime" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">$userOffset</span></tt> parameter has been replaced with <tt class="docutils literal"><span class="pre">$timezone</span></tt> parameter
in all relevant functions.  So instead of numeric offset you can now pass in a
timezone string or DateTimeZone object.  Passing numeric offsets for
<tt class="docutils literal"><span class="pre">$timezone</span></tt> parameter is still possible for backwards compatibility.</li>
<li><a class="reference internal" href="../core-utility-libraries/time.html#CakeTime::timeAgoInWords" title="CakeTime::timeAgoInWords"><tt class="xref php php-meth docutils literal"><span class="pre">CakeTime::timeAgoInWords()</span></tt></a> had the <tt class="docutils literal"><span class="pre">accuracy</span></tt> option added.
This option allows you to specify how accurate formatted times should be.</li>
<li>New methods added:<ul>
<li><a class="reference internal" href="../core-utility-libraries/time.html#CakeTime::toServer" title="CakeTime::toServer"><tt class="xref php php-meth docutils literal"><span class="pre">CakeTime::toServer()</span></tt></a></li>
<li><a class="reference internal" href="../core-utility-libraries/time.html#CakeTime::timezone" title="CakeTime::timezone"><tt class="xref php php-meth docutils literal"><span class="pre">CakeTime::timezone()</span></tt></a></li>
<li><a class="reference internal" href="../core-utility-libraries/time.html#CakeTime::listTimezones" title="CakeTime::listTimezones"><tt class="xref php php-meth docutils literal"><span class="pre">CakeTime::listTimezones()</span></tt></a></li>
</ul>
</li>
<li>The <tt class="docutils literal"><span class="pre">$dateString</span></tt> parameter in all methods now accepts a DateTime object.</li>
</ul>
</div>
</div>
<div class="section" id="helpers">
<h2>Helpers<a class="headerlink" href="#helpers" title="永久链接至标题">¶</a></h2>
<div class="section" id="formhelper">
<h3>FormHelper<a class="headerlink" href="#formhelper" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>FormHelper now better handles adding required classes to inputs.  It now
honors the <tt class="docutils literal"><span class="pre">on</span></tt> key.</li>
<li><a class="reference internal" href="../core-libraries/helpers/form.html#FormHelper::radio" title="FormHelper::radio"><tt class="xref php php-meth docutils literal"><span class="pre">FormHelper::radio()</span></tt></a> now supports an <tt class="docutils literal"><span class="pre">empty</span></tt> which works similar
to the empty option on <tt class="docutils literal"><span class="pre">select()</span></tt>.</li>
<li>Added <tt class="xref php php-meth docutils literal"><span class="pre">FormHelper::inputDefaults()</span></tt> to set common properties for
each of the inputs generated by the helper</li>
</ul>
</div>
<div class="section" id="timehelper">
<h3>TimeHelper<a class="headerlink" href="#timehelper" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>Since 2.1, TimeHelper uses the CakeTime class for all its relevant methods.
The <tt class="docutils literal"><span class="pre">$userOffset</span></tt> parameter has been replaced with <tt class="docutils literal"><span class="pre">$timezone</span></tt> parameter.</li>
<li><a class="reference internal" href="../core-libraries/helpers/time.html#TimeHelper::timeAgoInWords" title="TimeHelper::timeAgoInWords"><tt class="xref php php-meth docutils literal"><span class="pre">TimeHelper::timeAgoInWords()</span></tt></a> has the <tt class="docutils literal"><span class="pre">element</span></tt> option added.
This allows you to specify an HTML element to wrap the formatted time.</li>
</ul>
</div>
<div class="section" id="htmlhelper">
<h3>HtmlHelper<a class="headerlink" href="#htmlhelper" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../core-libraries/helpers/html.html#HtmlHelper::tableHeaders" title="HtmlHelper::tableHeaders"><tt class="xref php php-meth docutils literal"><span class="pre">HtmlHelper::tableHeaders()</span></tt></a> now supports setting attributes per
table cell.</li>
</ul>
</div>
</div>
<div class="section" id="routing">
<h2>Routing<a class="headerlink" href="#routing" title="永久链接至标题">¶</a></h2>
<div class="section" id="dispatcher">
<h3>Dispatcher<a class="headerlink" href="#dispatcher" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>Event listeners can now be attached to the dispatcher calls, those will have
the ability to change the request information or the response before it is
sent to the client. Check the full documentation for this new features in
<a class="reference internal" href="../development/dispatch-filters.html"><em>调度器过滤器</em></a></li>
<li>With the addition of <a class="reference internal" href="../development/dispatch-filters.html"><em>调度器过滤器</em></a> you&#8217;ll need to
update <tt class="docutils literal"><span class="pre">app/Config/bootstrap.php</span></tt>.  See
<a class="reference internal" href="#required-steps-to-upgrade-2-2"><em>Required steps to upgrade</em></a>.</li>
</ul>
</div>
<div class="section" id="router">
<h3>Router<a class="headerlink" href="#router" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../development/routing.html#Router::setExtensions" title="Router::setExtensions"><tt class="xref php php-meth docutils literal"><span class="pre">Router::setExtensions()</span></tt></a> has been added. With the new method you can
now add more extensions to be parsed, for example within a plugin routes file.</li>
</ul>
</div>
</div>
<div class="section" id="cache">
<h2>Cache<a class="headerlink" href="#cache" title="永久链接至标题">¶</a></h2>
<div class="section" id="redis-engine">
<h3>Redis Engine<a class="headerlink" href="#redis-engine" title="永久链接至标题">¶</a></h3>
<p>A new caching engine was added using the <a class="reference external" href="https://github.com/nicolasff/phpredis">phpredis extension</a> it is configured similarly to the
Memcache engine.</p>
</div>
<div class="section" id="cache-groups">
<h3>Cache groups<a class="headerlink" href="#cache-groups" title="永久链接至标题">¶</a></h3>
<p>It is now possible to tag or label cache keys under groups. This makes it
simpler to mass-delete cache entries associated to the same label. Groups are
declared at configuration time when creating the cache engine:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nx">Cache</span><span class="o">::</span><span class="na">config</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;engine&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Redis&#39;</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="s1">&#39;groups&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>You can have as many groups as you like, but keep in mind they cannot be
dynamically modified.</p>
<p>The <a class="reference internal" href="../core-libraries/caching.html#Cache::clearGroup" title="Cache::clearGroup"><tt class="xref php php-meth docutils literal"><span class="pre">Cache::clearGroup()</span></tt></a> class method was added. It takes the group
name and deletes all entries labeled with the same string.</p>
</div>
</div>
<div class="section" id="log">
<h2>Log<a class="headerlink" href="#log" title="永久链接至标题">¶</a></h2>
<p>Changes in <a class="reference internal" href="../core-libraries/logging.html#CakeLog" title="CakeLog"><tt class="xref php php-class docutils literal"><span class="pre">CakeLog</span></tt></a> now require, some additional configuration in
your <tt class="docutils literal"><span class="pre">app/Config/bootstrap.php</span></tt>.  See <a class="reference internal" href="#required-steps-to-upgrade-2-2"><em>Required steps to upgrade</em></a>,
and <a class="reference internal" href="../core-libraries/logging.html"><em>日志记录</em></a>.</p>
<ul class="simple">
<li>The <a class="reference internal" href="../core-libraries/logging.html#CakeLog" title="CakeLog"><tt class="xref php php-class docutils literal"><span class="pre">CakeLog</span></tt></a> class now accepts the same log levels as defined in
<a class="reference external" href="http://tools.ietf.org/html/rfc5424">RFC 5424</a>.  Several convenience
methods have also been added:<ul>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeLog::emergency($message,</span> <span class="pre">$scope</span> <span class="pre">=</span> <span class="pre">array())</span></tt></li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeLog::alert($message,</span> <span class="pre">$scope</span> <span class="pre">=</span> <span class="pre">array())</span></tt></li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeLog::critical($message,</span> <span class="pre">$scope</span> <span class="pre">=</span> <span class="pre">array())</span></tt></li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeLog::error($message,</span> <span class="pre">$scope</span> <span class="pre">=</span> <span class="pre">array())</span></tt></li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeLog::warning($message,</span> <span class="pre">$scope</span> <span class="pre">=</span> <span class="pre">array())</span></tt></li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeLog::notice($message,</span> <span class="pre">$scope</span> <span class="pre">=</span> <span class="pre">array())</span></tt></li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeLog::info($message,</span> <span class="pre">$scope</span> <span class="pre">=</span> <span class="pre">array())</span></tt></li>
<li><tt class="xref php php-meth docutils literal"><span class="pre">CakeLog::debug($message,</span> <span class="pre">$scope</span> <span class="pre">=</span> <span class="pre">array())</span></tt></li>
</ul>
</li>
<li>A third argument <tt class="docutils literal"><span class="pre">$scope</span></tt> has been added to <a class="reference internal" href="../core-libraries/logging.html#CakeLog::write" title="CakeLog::write"><tt class="xref php php-meth docutils literal"><span class="pre">CakeLog::write</span></tt></a>.
See <a class="reference internal" href="../core-libraries/logging.html#logging-scopes"><em>Logging Scopes</em></a>.</li>
<li>A new log engine: <tt class="xref php php-class docutils literal"><span class="pre">ConsoleLog</span></tt> has been added.</li>
</ul>
</div>
<div class="section" id="model-validation">
<h2>Model Validation<a class="headerlink" href="#model-validation" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>A new object <tt class="docutils literal"><span class="pre">ModelValidator</span></tt> was added to delegate the work of validating
model data, it should be transparent to the application and fully backwards
compatible. It also exposes a rich API to add, modify and remove validation
rules. Check docs for this object in <a class="reference internal" href="../models/data-validation.html"><em>数据验证</em></a>.</li>
<li>Custom validation functions in your models need to have &#8220;public&#8221; visibility
so that they are accessible by <tt class="docutils literal"><span class="pre">ModelValidator</span></tt>.</li>
<li>New validation rules added:<ul>
<li><a class="reference internal" href="../models/data-validation.html#Validation::naturalNumber" title="Validation::naturalNumber"><tt class="xref php php-meth docutils literal"><span class="pre">Validation::naturalNumber()</span></tt></a></li>
<li><a class="reference internal" href="../models/data-validation.html#Validation::mimeType" title="Validation::mimeType"><tt class="xref php php-meth docutils literal"><span class="pre">Validation::mimeType()</span></tt></a></li>
<li><a class="reference internal" href="../models/data-validation.html#Validation::uploadError" title="Validation::uploadError"><tt class="xref php php-meth docutils literal"><span class="pre">Validation::uploadError()</span></tt></a></li>
</ul>
</li>
</ul>
</div>
</div>


		</div>
	</div>

	<div class="sidebar columns three pull-nine">
<div id="sidebar-navigation" class="hide-on-phones">
	<h2 class="hide-on-desktops">Table of Contents</h2>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">欢迎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cakephp-overview.html">CakePHP 概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">视图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries.html">核心库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">插件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">命令行与Shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">教程 &amp; 实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">贡献</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../appendices.html">Appendices</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2-7-migration-guide.html">2.7 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-6-migration-guide.html">2.6 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-5-migration-guide.html">2.5 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-4-migration-guide.html">2.4 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-3-migration-guide.html">2.3 Migration Guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">2.2 Migration Guide</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2-1-migration-guide.html">2.1 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="new-features-in-cakephp-2-1.html">New Features in CakePHP 2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-0-migration-guide.html">2.0 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="new-features-in-cakephp-2-0.html">New Features in CakePHP 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="phpunit-migration-hints.html">PHPUnit Migration Hints</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-cakephp-1-2-to-1-3.html">Migrating from CakePHP 1.2 to 1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="new-features-in-cakephp-1-3.html">New features in CakePHP 1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
</li>
</ul>

</div>

<div class="page-contents">
	<h3>Page contents</h3>
	<ul>
<li><a class="reference internal" href="#">2.2 Migration Guide</a><ul>
<li><a class="reference internal" href="#required-steps-to-upgrade">Required steps to upgrade</a></li>
<li><a class="reference internal" href="#console">Console</a><ul>
<li><a class="reference internal" href="#i18n-extract-shell">I18N extract shell</a></li>
</ul>
</li>
<li><a class="reference internal" href="#models">Models</a></li>
<li><a class="reference internal" href="#datasources">Datasources</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#error-handling">Error Handling</a><ul>
<li><a class="reference internal" href="#exceptions">Exceptions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#core">Core</a><ul>
<li><a class="reference internal" href="#configure">Configure</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller">Controller</a><ul>
<li><a class="reference internal" href="#authcomponent">AuthComponent</a></li>
<li><a class="reference internal" href="#cookiecomponent">CookieComponent</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pagination">Pagination</a></li>
<li><a class="reference internal" href="#network">Network</a><ul>
<li><a class="reference internal" href="#cakeemail">CakeEmail</a></li>
<li><a class="reference internal" href="#cakerequest">CakeRequest</a></li>
</ul>
</li>
<li><a class="reference internal" href="#utility">Utility</a><ul>
<li><a class="reference internal" href="#set">Set</a></li>
<li><a class="reference internal" href="#hash">Hash</a></li>
<li><a class="reference internal" href="#caketime">CakeTime</a></li>
</ul>
</li>
<li><a class="reference internal" href="#helpers">Helpers</a><ul>
<li><a class="reference internal" href="#formhelper">FormHelper</a></li>
<li><a class="reference internal" href="#timehelper">TimeHelper</a></li>
<li><a class="reference internal" href="#htmlhelper">HtmlHelper</a></li>
</ul>
</li>
<li><a class="reference internal" href="#routing">Routing</a><ul>
<li><a class="reference internal" href="#dispatcher">Dispatcher</a></li>
<li><a class="reference internal" href="#router">Router</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cache">Cache</a><ul>
<li><a class="reference internal" href="#redis-engine">Redis Engine</a></li>
<li><a class="reference internal" href="#cache-groups">Cache groups</a></li>
</ul>
</li>
<li><a class="reference internal" href="#log">Log</a></li>
<li><a class="reference internal" href="#model-validation">Model Validation</a></li>
</ul>
</li>
</ul>

</div>
	</div>

</div>

<div class="content row">
	<ul class="related-pages inline">
	<li>
		<a href="../genindex.html" title="总目录" accesskey="I">索引</a>
	</li>
	<li>
		<a href="2-1-migration-guide.html" title="2.1 Migration Guide" accesskey="N">下一页</a>
	</li>
	<li>
		<a href="2-3-migration-guide.html" title="2.3 Migration Guide" accesskey="P">上一页</a>
	</li>
	</ul>
</div>

	<div class="footer-push"> </div>
</div>






<div class="footer">
	<div class="row">
		<div class="columns six offset-by-three contribute">
			<strong>发现翻译错误?</strong>
			请在下方留言<br />
			<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">[ 我要加入翻译 ]</a>
		</div>
	</div>
	
	<div class="row">
		<div class="columns nine offset-by-three copyright">
					&copy; 版权所有 2014, Cake Software Foundation, Inc.
				最后更新于 Aug 31, 2015.
				Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
			Sponsored by <a href="http://www.shinetechzhengzhou.com/" target="_blank">盛安德郑州</a>
		</div>
	</div>
</div>

<div id="nav-modal" class="reveal-modal"> </div>
<div id="inline-search-results"></div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
  </body>
</html>