
<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>New Features in CakePHP 2.1 &mdash; CakePHP Cookbook 2.x 文档</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/app.js"></script>
    <script type="text/javascript" src="../_static/modernizr.foundation.js"></script>
    <script type="text/javascript" src="../_static/foundation.js"></script>
    <link rel="top" title="CakePHP Cookbook 2.x 文档" href="../index.html" />
    <link rel="up" title="Appendices" href="../appendices.html" />
    <link rel="next" title="2.0 Migration Guide" href="2-0-migration-guide.html" />
    <link rel="prev" title="2.1 Migration Guide" href="2-1-migration-guide.html" />
<link href="../_static/favicon.ico" type="image/x-icon" rel="icon" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="alternate" hreflang="en" href="../../en/appendices/new-features-in-cakephp-2-1.html" /><link rel="alternate" hreflang="pt" href="../../pt/appendices/new-features-in-cakephp-2-1.html" /><link rel="alternate" hreflang="es" href="../../es/appendices/new-features-in-cakephp-2-1.html" /><link rel="alternate" hreflang="ja" href="../../ja/appendices/new-features-in-cakephp-2-1.html" /><link rel="alternate" hreflang="fr" href="../../fr/appendices/new-features-in-cakephp-2-1.html" />

<link rel="search" type="application/opensearchdescription+xml" title="CakePHP Book 2.x Search" href="../_static/opensearchdescription-book-2-x.xml">
<script type="text/javascript">
window.lang = "zh_CN";
</script>

  </head>
  <body>

<div id="container">

<div id="cakephp-global-navigation">
	<ul>
		<li class="main"><a href="http://cakephp.org">CakePHP</a></li>
		<li class="primary"><a href="#" class="empty">Downloads</a>
			<ul class="second-level">
				<li><a href="https://github.com/cakephp/cakephp/tags">Releases</a></li>
				<li><a href="http://pear.cakephp.org">Pear channel</a></li>
			</ul>
		</li>
		<li class="primary"><a href="#" class="empty">Documentation</a>
			<ul class="second-level">
				<li><a href="http://api.cakephp.org">API</a></li>
				<li><a href="http://book.cakephp.org">Book</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://community.cakephp.org">Community</a>
			<ul class="second-level">
				<li><a href="http://webchat.freenode.net/?channels=cakephp&uio=MT1mYWxzZSY5PXRydWUmMTE9MjQ2b8">Help &amp; Support</a></li>
				<li><a href="https://github.com/cakephp/cakephp/issues">Issues</a></li>
				<li><a href="http://bakery.cakephp.org">The Bakery</a></li>
				<li><a href="http://stackoverflow.com/tags/cakephp">Stack Overflow</a></li>
				<li><a href="http://www.facebook.com/groups/cake.community">Facebook Group</a></li>
				<li><a href="http://goo.gl/mSC0s">Google+ Community</a></li>
				<li><a href="http://www.youtube.com/user/CakePHP">YouTube Channel</a></li>
				<li><a href="http://podcast.cakephp.org">CakePHP Podcast</a></li>
				<li><a href="http://twitter.com/CakePHP">Follow us on Twitter</a></li>
				<li><a href="http://groups.google.com/group/cake-php">Google Group</a></li>
				<li><a href="http://github.com/cakephp/cakephp/contributors">Contributors</a></li>
				<li><a href="http://plugins.cakephp.org">Plugins &amp; Packages</a></li>
				<li><a href="http://community.cakephp.org/get-involved">Get Involved</a></li>
				<li><a href="http://community.cakephp.org/guidelines">Guidelines</a></li>
				<li><a href="http://cakefest.org">CakeFest</a></li>
				<li><a href="http://cakephp.org/logos">Logo</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://cakephp.org/services">Services</a>
			<ul class="second-level">
				<li><a href="http://certification.cakephp.org">Certification</a></li>
				<li><a href="http://cakephp.org/services/consultation">Consultation</a></li>
				<li><a href="http://cakephp.org/services/support">Support</a></li>
				<li><a href="http://training.cakephp.org">Training</a></li>
			</ul>
		</li>
	</ul>
</div>

<div class="masthead">
	<div class="header-backing"></div>
	<div class="searchbar row">
		<div class="columns three phone-one">
			<a class="logo" href="../contents.html">
			<img src="../_static/cake-logo.png" alt="CakePHP" width="70" />
			</a>
		</div>
		
<div id="searchbox" class="columns nine phone-three">

	<form id="searchform" class="search" action="../search.html" method="get">
		<input class="search-input" autocomplete="off" type="search" name="q" size="18" />
		<input class="search-submit search-big button red" type="submit" value="搜索" />
		<input type="hidden" name="check_keywords" value="yes" />
		<input type="hidden" name="area" value="default" />

		<a href="#" id="tablet-nav" class="show-on-phones pale button small">Nav</a>
	</form>

</div>
	</div>
</div>
<div class="breadcrumb-header">
	<div class="related row">
		<div class="columns three root-link">
			<a href="../contents.html">Cookbook 2.x</a>
		</div>
		<div class="columns nine">
			<ul class="inline breadcrumb">
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../appendices.html" accesskey="U" itemprop="url"><span itemprop="title">Appendices</span></a>
			</li>
			</ul>
			<div class="versions dropdown">
				<a href="#">2.x Book</a>
				<ul>
					<li><a href="http://book.cakephp.org/3.0/en">3.0 Book</a></li>
					<li><a href="http://book.cakephp.org/1.3/zh_CN/">1.3 Book</a></li>
					<li><a href="http://book.cakephp.org/1.2/zh_CN/">1.2 Book</a></li>
					<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
				</ul>
			</div>

			<div class="languages dropdown">
				<a href="#">zh_CN</a>

				<ul>
				
					<li><a href="../../en/appendices/new-features-in-cakephp-2-1.html">en</a></li>
				
					<li><a href="../../pt/appendices/new-features-in-cakephp-2-1.html">pt</a></li>
				
					<li><a href="../../es/appendices/new-features-in-cakephp-2-1.html">es</a></li>
				
					<li><a href="../../ja/appendices/new-features-in-cakephp-2-1.html">ja</a></li>
				
					<li><a href="../../fr/appendices/new-features-in-cakephp-2-1.html">fr</a></li>
				
					<li></li>
				
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="content row">
	<div class="document columns nine push-three">
		<div class="body"><a class="button pale improve" href="https://github.com/cakephp/docs/edit/master/zh/appendices/new-features-in-cakephp-2-1.rst" target="_blank">Improve this Doc</a>
  <div class="section" id="new-features-in-cakephp-2-1">
<h1>New Features in CakePHP 2.1<a class="headerlink" href="#new-features-in-cakephp-2-1" title="永久链接至标题">¶</a></h1>
<div class="section" id="models">
<h2>Models<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h2>
<div class="section" id="model-saveall-model-saveassociated-model-validateassociated">
<h3>Model::saveAll(), Model::saveAssociated(), Model::validateAssociated()<a class="headerlink" href="#model-saveall-model-saveassociated-model-validateassociated" title="永久链接至标题">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">Model::saveAll()</span></tt> and friends now support passing the <cite>fieldList</cite> for multiple models. Example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">SomeModel</span><span class="o">-&gt;</span><span class="na">saveAll</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;fieldList&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;SomeModel&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;field_1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;AssociatedModel&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;field_2&#39;</span><span class="p">,</span> <span class="s1">&#39;field_3&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">Model::saveAll()</span></tt> and friends now can save unlimited levels deep. Example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;Article&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;My first article&#39;</span><span class="p">),</span>
    <span class="s1">&#39;Comment&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Comment 1&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">),</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Save a new user as well&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mad&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;coder&#39;</span><span class="p">))</span>
    <span class="p">),</span>
<span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">SomeModel</span><span class="o">-&gt;</span><span class="na">saveAll</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;deep&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="view">
<h2>View<a class="headerlink" href="#view" title="永久链接至标题">¶</a></h2>
<div class="section" id="view-blocks">
<h3>View Blocks<a class="headerlink" href="#view-blocks" title="永久链接至标题">¶</a></h3>
<p>View Blocks are a mechanism to allow the inclusion of slots of content, whilst allowing child view classes or elements to provide custom content for that block.</p>
<p>Blocks are output by calling the <tt class="docutils literal"><span class="pre">fetch</span></tt> method on the <a class="reference internal" href="../views.html#View" title="View"><tt class="xref php php-class docutils literal"><span class="pre">View</span></tt></a>. For example, the following can be placed in your <tt class="docutils literal"><span class="pre">View/Layouts/default.ctp</span></tt> file:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="s1">&#39;my_block&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This will echo the content of the block if available, or an empty string if it is undefined.</p>
<p>Setting the content of a block can be done in a number of ways. A simple assignment of data can be done using <cite>assign</cite>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assign</span><span class="p">(</span><span class="s1">&#39;my_block&#39;</span><span class="p">,</span> <span class="s1">&#39;Hello Block&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Or you can use it to capture a section of more complex content:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">(</span><span class="s1">&#39;my_block&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;h1&gt;Hello Block!&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;This is a block of content&lt;/p&gt;</span>
<span class="x">    &lt;p&gt;Page title: </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$title_for_layout</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Block capturing also supports nesting:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">(</span><span class="s1">&#39;my_block&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;h1&gt;Hello Block!&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;This is a block of content&lt;/p&gt;</span>
<span class="x">    </span><span class="cp">&lt;?php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">(</span><span class="s1">&#39;second_block&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">        &lt;p&gt;Page title: </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$title_for_layout</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="x">    </span><span class="cp">&lt;?php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="cp">&lt;?php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="themeview">
<h3>ThemeView<a class="headerlink" href="#themeview" title="永久链接至标题">¶</a></h3>
<p>In 2.1, the use of <tt class="docutils literal"><span class="pre">ThemeView</span></tt> is deprecated in favor of using the <tt class="docutils literal"><span class="pre">View</span></tt> class itself. <tt class="docutils literal"><span class="pre">ThemeView</span></tt> is now a stub class.</p>
<p>All custom pathing code has been moved into the <tt class="docutils literal"><span class="pre">View</span></tt> class, meaning that it is now possible for classes extending the <tt class="docutils literal"><span class="pre">View</span></tt> class to automatically support themes. Whereas before we might set the <tt class="docutils literal"><span class="pre">$viewClass</span></tt> Controller property to <tt class="docutils literal"><span class="pre">Theme</span></tt>, it is now possible to enable themes by simply setting the <tt class="docutils literal"><span class="pre">$theme</span></tt> property. Example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;Controller&#39;</span><span class="p">,</span> <span class="s1">&#39;Controller&#39;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">AppController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$theme</span> <span class="o">=</span> <span class="s1">&#39;Example&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>All View classes which extended <tt class="docutils literal"><span class="pre">ThemeView</span></tt> in 2.0 should now simply extend <tt class="docutils literal"><span class="pre">View</span></tt>.</p>
</div>
<div class="section" id="jsonview">
<h3>JsonView<a class="headerlink" href="#jsonview" title="永久链接至标题">¶</a></h3>
<p>A new view class that eases the output of JSON content.</p>
<p>Previously, it was necessary to create a JSON layout (<tt class="docutils literal"><span class="pre">APP/View/Layouts/json/default.ctp</span></tt>) and a corresponding view for each action that would output JSON. This is no longer required with <a class="reference internal" href="../views/json-and-xml-views.html#JsonView" title="JsonView"><tt class="xref php php-class docutils literal"><span class="pre">JsonView</span></tt></a>.</p>
<p>The <a class="reference internal" href="../views/json-and-xml-views.html#JsonView" title="JsonView"><tt class="xref php php-class docutils literal"><span class="pre">JsonView</span></tt></a> is used like any other view class, by defining it on the controller. Example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;Controller&#39;</span><span class="p">,</span> <span class="s1">&#39;Controller&#39;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">AppController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$viewClass</span> <span class="o">=</span> <span class="s1">&#39;Json&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once you have setup the controller, you need to identify what content should be serialized as JSON, by setting the view variable <tt class="docutils literal"><span class="pre">_serialize</span></tt>. Example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">));</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;_serialize&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;posts&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>The above example would result in only the <tt class="docutils literal"><span class="pre">users</span></tt> and <tt class="docutils literal"><span class="pre">posts</span></tt> variables being serialized for the JSON output, like so:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="p">{</span><span class="s2">&quot;users&quot;</span><span class="o">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="s2">&quot;posts&quot;</span><span class="o">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]}</span>
</pre></div>
</div>
<p>There is no longer any need to create view <tt class="docutils literal"><span class="pre">ctp</span></tt> files in order to display Json content.</p>
<p>Further customization of the output can be achieved by extending the <a class="reference internal" href="../views/json-and-xml-views.html#JsonView" title="JsonView"><tt class="xref php php-class docutils literal"><span class="pre">JsonView</span></tt></a> class with your own custom view class if required.</p>
<p>The following example wraps the result with <tt class="docutils literal"><span class="pre">{results:</span> <span class="pre">...</span> <span class="pre">}</span></tt>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;JsonView&#39;</span><span class="p">,</span> <span class="s1">&#39;View&#39;</span><span class="p">);</span>
<span class="k">class</span> <span class="nc">ResultsJsonView</span> <span class="k">extends</span> <span class="nx">JsonView</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nv">$view</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$layout</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="k">parent</span><span class="o">::</span><span class="na">render</span><span class="p">(</span><span class="nv">$view</span><span class="p">,</span> <span class="nv">$layout</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">viewVars</span><span class="p">[</span><span class="s1">&#39;_serialize&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;results&#39;</span> <span class="o">=&gt;</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$result</span><span class="p">)));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="xmlview">
<h3>XmlView<a class="headerlink" href="#xmlview" title="永久链接至标题">¶</a></h3>
<p>Much like the <a class="reference internal" href="../views/json-and-xml-views.html#JsonView" title="JsonView"><tt class="xref php php-class docutils literal"><span class="pre">JsonView</span></tt></a>, the <a class="reference internal" href="../views/json-and-xml-views.html#XmlView" title="XmlView"><tt class="xref php php-class docutils literal"><span class="pre">XmlView</span></tt></a> requires you to
set the <tt class="docutils literal"><span class="pre">_serialize</span></tt> view variable in order to indicate what information
should be serialized into XML for output:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">));</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;_serialize&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;posts&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>The above example would result in only the <tt class="docutils literal"><span class="pre">users</span></tt> and <tt class="docutils literal"><span class="pre">posts</span></tt> variables
being serialized for the XML output, like so:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">response</span><span class="o">&gt;&lt;</span><span class="nx">users</span><span class="o">&gt;...&lt;/</span><span class="nx">users</span><span class="o">&gt;&lt;</span><span class="nx">posts</span><span class="o">&gt;...&lt;/</span><span class="nx">posts</span><span class="o">&gt;&lt;/</span><span class="nx">response</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note that the XmlView adds a <tt class="docutils literal"><span class="pre">response</span></tt> node to wrap all serialized content.</p>
</div>
<div class="section" id="conditional-view-rendering">
<h3>Conditional View Rendering<a class="headerlink" href="#conditional-view-rendering" title="永久链接至标题">¶</a></h3>
<p>Several new methods were added to <a class="reference internal" href="../controllers/request-response.html#CakeRequest" title="CakeRequest"><tt class="xref php php-class docutils literal"><span class="pre">CakeRequest</span></tt></a> to ease the task of
setting correct HTTP headers to foster HTTP caching. You can now define our
caching strategy using the expiration or validation HTTP cache model, or combine
both. Now there are specific methods in <a class="reference internal" href="../controllers/request-response.html#CakeRequest" title="CakeRequest"><tt class="xref php php-class docutils literal"><span class="pre">CakeRequest</span></tt></a> to fine-tune
Cache-Control directives, set the entity tag (Etag), set the Last-Modified time
and much more.</p>
<p>When those methods are combined with having the <a class="reference internal" href="../core-libraries/components/request-handling.html#RequestHandlerComponent" title="RequestHandlerComponent"><tt class="xref php php-class docutils literal"><span class="pre">RequestHandlerComponent</span></tt></a>
enabled in your controller, the component will automatically decide if the
response is already cached in the client and will send a <cite>304 Not Modified</cite>
status code before rendering the view. Skipping the view rendering process saves
CPU cycles and memory.:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="k">extends</span> <span class="nx">AppController</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$components</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;RequestHandler&#39;</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">view</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$article</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Article</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">modified</span><span class="p">(</span><span class="nv">$article</span><span class="p">[</span><span class="s1">&#39;Article&#39;</span><span class="p">][</span><span class="s1">&#39;modified&#39;</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;article&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the above example the view will not be rendered if the client sent the
header <cite>If-Modified-Since</cite>, and the response will have a 304 status.</p>
</div>
</div>
<div class="section" id="helpers">
<h2>Helpers<a class="headerlink" href="#helpers" title="永久链接至标题">¶</a></h2>
<p>To allow easier use outside of the <tt class="docutils literal"><span class="pre">View</span></tt> layer, methods from
<a class="reference internal" href="../core-libraries/helpers/time.html#TimeHelper" title="TimeHelper"><tt class="xref php php-class docutils literal"><span class="pre">TimeHelper</span></tt></a>, <a class="reference internal" href="../core-libraries/helpers/text.html#TextHelper" title="TextHelper"><tt class="xref php php-class docutils literal"><span class="pre">TextHelper</span></tt></a>, and <a class="reference internal" href="../core-libraries/helpers/number.html#NumberHelper" title="NumberHelper"><tt class="xref php php-class docutils literal"><span class="pre">NumberHelper</span></tt></a>
helpers have been extracted to <a class="reference internal" href="../core-utility-libraries/time.html#CakeTime" title="CakeTime"><tt class="xref php php-class docutils literal"><span class="pre">CakeTime</span></tt></a>, <a class="reference internal" href="../core-utility-libraries/string.html#String" title="String"><tt class="xref php php-class docutils literal"><span class="pre">String</span></tt></a>,
and <a class="reference internal" href="../core-utility-libraries/number.html#CakeNumber" title="CakeNumber"><tt class="xref php php-class docutils literal"><span class="pre">CakeNumber</span></tt></a> classes respectively.</p>
<p>To use the new utility classes:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AppController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nv">$msg</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$msg</span> <span class="o">.=</span> <span class="nx">String</span><span class="o">::</span><span class="na">truncate</span><span class="p">(</span><span class="nv">$msg</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="nv">$msg</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can override the default class to use by creating a new class in your
<tt class="docutils literal"><span class="pre">APP/Utility</span></tt> folder, e.g.: <tt class="docutils literal"><span class="pre">Utility/MyAwesomeStringClass.php</span></tt>, and specify
it in <tt class="docutils literal"><span class="pre">engine</span></tt> key:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// Utility/MyAwesomeStringClass.php</span>
<span class="k">class</span> <span class="nc">MyAwesomeStringClass</span> <span class="k">extends</span> <span class="nx">String</span> <span class="p">{</span>
    <span class="c1">// my truncate is better than yours</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">static</span> <span class="nx">truncate</span><span class="p">(</span><span class="nv">$text</span><span class="p">,</span> <span class="nv">$length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Controller/AppController.php</span>
<span class="k">class</span> <span class="nc">AppController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$helpers</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;Text&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;engine&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MyAwesomeStringClass&#39;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="htmlhelper">
<h3>HtmlHelper<a class="headerlink" href="#htmlhelper" title="永久链接至标题">¶</a></h3>
<p>A new function <a class="reference internal" href="../core-libraries/helpers/html.html#HtmlHelper::media" title="HtmlHelper::media"><tt class="xref php php-meth docutils literal"><span class="pre">HtmlHelper::media()</span></tt></a> has been added for HTML5&#8217;s audio/video element generation.</p>
</div>
</div>
</div>


		</div>
	</div>

	<div class="sidebar columns three pull-nine">
<div id="sidebar-navigation" class="hide-on-phones">
	<h2 class="hide-on-desktops">Table of Contents</h2>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">欢迎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cakephp-overview.html">CakePHP 概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">视图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries.html">核心库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">插件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">命令行与Shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">教程 &amp; 实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">贡献</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../appendices.html">Appendices</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2-7-migration-guide.html">2.7 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-6-migration-guide.html">2.6 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-5-migration-guide.html">2.5 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-4-migration-guide.html">2.4 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-3-migration-guide.html">2.3 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-2-migration-guide.html">2.2 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-1-migration-guide.html">2.1 Migration Guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">New Features in CakePHP 2.1</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2-0-migration-guide.html">2.0 Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="new-features-in-cakephp-2-0.html">New Features in CakePHP 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="phpunit-migration-hints.html">PHPUnit Migration Hints</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-cakephp-1-2-to-1-3.html">Migrating from CakePHP 1.2 to 1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="new-features-in-cakephp-1-3.html">New features in CakePHP 1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
</li>
</ul>

</div>

<div class="page-contents">
	<h3>Page contents</h3>
	<ul>
<li><a class="reference internal" href="#">New Features in CakePHP 2.1</a><ul>
<li><a class="reference internal" href="#models">Models</a><ul>
<li><a class="reference internal" href="#model-saveall-model-saveassociated-model-validateassociated">Model::saveAll(), Model::saveAssociated(), Model::validateAssociated()</a></li>
</ul>
</li>
<li><a class="reference internal" href="#view">View</a><ul>
<li><a class="reference internal" href="#view-blocks">View Blocks</a></li>
<li><a class="reference internal" href="#themeview">ThemeView</a></li>
<li><a class="reference internal" href="#jsonview">JsonView</a></li>
<li><a class="reference internal" href="#xmlview">XmlView</a></li>
<li><a class="reference internal" href="#conditional-view-rendering">Conditional View Rendering</a></li>
</ul>
</li>
<li><a class="reference internal" href="#helpers">Helpers</a><ul>
<li><a class="reference internal" href="#htmlhelper">HtmlHelper</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
	</div>

</div>

<div class="content row">
	<ul class="related-pages inline">
	<li>
		<a href="../genindex.html" title="总目录" accesskey="I">索引</a>
	</li>
	<li>
		<a href="2-0-migration-guide.html" title="2.0 Migration Guide" accesskey="N">下一页</a>
	</li>
	<li>
		<a href="2-1-migration-guide.html" title="2.1 Migration Guide" accesskey="P">上一页</a>
	</li>
	</ul>
</div>

	<div class="footer-push"> </div>
</div>






<div class="footer">
	<div class="row">
		<div class="columns six offset-by-three contribute">
			<strong>发现翻译错误?</strong>
			请在下面留言<br />
			<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">[ 我要加入翻译 ]</a>
		</div>
	</div>
	
	<div class="row">
		<div class="columns nine offset-by-three copyright">
					&copy; 版权所有 2014, Cake Software Foundation, Inc.
				最后更新于 Nov 19, 2015.
				Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
		</div>
	</div>
</div>

<div id="nav-modal" class="reveal-modal"> </div>
<div id="inline-search-results"></div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->

<!-- Grunt Live Reload -->
<script src="http://192.168.56.113:35729/livereload.js"></script>
  </body>
</html>