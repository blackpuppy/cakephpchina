
<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Validating Data from the Controller" lang="en" name="title" />
<meta content="password rules,validations,subset,array,logs,logic,email,first name last name,models,options,data model" lang="en" name="keywords" />

    <title>Validating Data from the Controller &mdash; CakePHP Cookbook 2.x documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/app.js"></script>
    <script type="text/javascript" src="../../_static/modernizr.foundation.js"></script>
    <script type="text/javascript" src="../../_static/foundation.js"></script>
    <link rel="top" title="CakePHP Cookbook 2.x documentation" href="../../index.html" />
    <link rel="up" title="Data Validation" href="../data-validation.html" />
    <link rel="next" title="Callback Methods" href="../callback-methods.html" />
    <link rel="prev" title="Data Validation" href="../data-validation.html" />
<link href="../../_static/favicon.ico" type="image/x-icon" rel="icon" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="alternate" hreflang="pt" href="../../../pt/models/data-validation/validating-data-from-the-controller.html" /><link rel="alternate" hreflang="es" href="../../../es/models/data-validation/validating-data-from-the-controller.html" /><link rel="alternate" hreflang="ja" href="../../../ja/models/data-validation/validating-data-from-the-controller.html" /><link rel="alternate" hreflang="fr" href="../../../fr/models/data-validation/validating-data-from-the-controller.html" /><link rel="alternate" hreflang="zh_CN" href="../../../zh/models/data-validation/validating-data-from-the-controller.html" />

<link rel="search" type="application/opensearchdescription+xml" title="CakePHP Book 2.x Search" href="../../_static/opensearchdescription-book-2-x.xml">
<script type="text/javascript">
window.lang = "en";
</script>

  </head>
  <body>

<div id="container">

<div id="cakephp-global-navigation">
	<ul>
		<li class="main"><a href="http://cakephp.org">CakePHP</a></li>
		<li class="primary"><a href="#" class="empty">Downloads</a>
			<ul class="second-level">
				<li><a href="https://github.com/cakephp/cakephp/tags">Releases</a></li>
				<li><a href="http://pear.cakephp.org">Pear channel</a></li>
			</ul>
		</li>
		<li class="primary"><a href="#" class="empty">Documentation</a>
			<ul class="second-level">
				<li><a href="http://api.cakephp.org">API</a></li>
				<li><a href="http://book.cakephp.org">Book</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://community.cakephp.org">Community</a>
			<ul class="second-level">
				<li><a href="http://webchat.freenode.net/?channels=cakephp&uio=MT1mYWxzZSY5PXRydWUmMTE9MjQ2b8">Help &amp; Support</a></li>
				<li><a href="https://github.com/cakephp/cakephp/issues">Issues</a></li>
				<li><a href="http://bakery.cakephp.org">The Bakery</a></li>
				<li><a href="http://stackoverflow.com/tags/cakephp">Stack Overflow</a></li>
				<li><a href="http://www.facebook.com/groups/cake.community">Facebook Group</a></li>
				<li><a href="http://goo.gl/mSC0s">Google+ Community</a></li>
				<li><a href="http://www.youtube.com/user/CakePHP">YouTube Channel</a></li>
				<li><a href="http://podcast.cakephp.org">CakePHP Podcast</a></li>
				<li><a href="http://twitter.com/CakePHP">Follow us on Twitter</a></li>
				<li><a href="http://groups.google.com/group/cake-php">Google Group</a></li>
				<li><a href="http://github.com/cakephp/cakephp/contributors">Contributors</a></li>
				<li><a href="http://plugins.cakephp.org">Plugins &amp; Packages</a></li>
				<li><a href="http://community.cakephp.org/get-involved">Get Involved</a></li>
				<li><a href="http://community.cakephp.org/guidelines">Guidelines</a></li>
				<li><a href="http://cakefest.org">CakeFest</a></li>
				<li><a href="http://cakephp.org/logos">Logo</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://cakephp.org/services">Services</a>
			<ul class="second-level">
				<li><a href="http://cakephp.org/services/certification">Certification</a></li>
				<li><a href="http://cakephp.org/services/consultation">Consultation</a></li>
				<li><a href="http://cakephp.org/services/support">Support</a></li>
				<li><a href="http://training.cakephp.org">Training</a></li>
			</ul>
		</li>
	</ul>
</div>

<div class="masthead">
	<div class="header-backing"></div>
	<div class="searchbar row">
		<div class="columns three phone-one">
			<a class="logo" href="../../contents.html">
			<img src="../../_static/cake-logo.png" alt="CakePHP" width="70" />
			</a>
		</div>
		
<div id="searchbox" class="columns nine phone-three">

	<form id="searchform" class="search" action="../../search.html" method="get">
		<input class="search-input" autocomplete="off" type="search" name="q" size="18" />
		<input class="search-submit search-big button red" type="submit" value="Search" />
		<input type="hidden" name="check_keywords" value="yes" />
		<input type="hidden" name="area" value="default" />

		<a href="#" id="tablet-nav" class="show-on-phones pale button small">Nav</a>
	</form>

</div>
	</div>
</div>
<div class="breadcrumb-header">
	<div class="related row">
		<div class="columns three root-link">
			<a href="../../contents.html">Cookbook 2.x</a>
		</div>
		<div class="columns nine">
			<ul class="inline breadcrumb">
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../../models.html"  itemprop="url"><span itemprop="title">Models</span></a>
			</li>
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../data-validation.html" accesskey="U" itemprop="url"><span itemprop="title">Data Validation</span></a>
			</li>
			</ul>
			<div class="versions dropdown">
				<a href="#">2.x Book</a>
				<ul>
					<li><a href="http://book.cakephp.org/3.0/en">3.0 Book</a></li>
					<li><a href="http://book.cakephp.org/1.3/en/">1.3 Book</a></li>
					<li><a href="http://book.cakephp.org/1.2/en/">1.2 Book</a></li>
					<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
				</ul>
			</div>

			<div class="languages dropdown">
				<a href="#">en</a>

				<ul>
				
					<li></li>
				
					<li><a href="../../../pt/models/data-validation/validating-data-from-the-controller.html">pt</a></li>
				
					<li><a href="../../../es/models/data-validation/validating-data-from-the-controller.html">es</a></li>
				
					<li><a href="../../../ja/models/data-validation/validating-data-from-the-controller.html">ja</a></li>
				
					<li><a href="../../../fr/models/data-validation/validating-data-from-the-controller.html">fr</a></li>
				
					<li><a href="../../../zh/models/data-validation/validating-data-from-the-controller.html">zh_CN</a></li>
				
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="content row">
	<div class="document columns nine push-three">
		<div class="body"><a class="button pale improve" href="https://github.com/cakephp/docs/edit/master/en/models/data-validation/validating-data-from-the-controller.rst" target="_blank">Improve this Doc</a>
  <div class="section" id="validating-data-from-the-controller">
<h1>Validating Data from the Controller<a class="headerlink" href="#validating-data-from-the-controller" title="Permalink to this headline">¶</a></h1>
<p>While normally you would just use the save method of the model,
there may be times where you wish to validate the data without
saving it. For example, you may wish to display some additional
information to the user before actually saving the data to the
database. Validating data requires a slightly different process
than just saving the data.</p>
<p>First, set the data to the model:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ModelName</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">);</span>
</pre></div>
</div>
<p>Then, to check if the data validates, use the validates method of
the model, which will return true if it validates and false if it
doesn&#8217;t:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ModelName</span><span class="o">-&gt;</span><span class="na">validates</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// it validated logic</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// didn&#39;t validate logic</span>
    <span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ModelName</span><span class="o">-&gt;</span><span class="na">validationErrors</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It may be desirable to validate your model only using a subset of
the validations specified in your model. For example say you had a
User model with fields for first_name, last_name, email and
password. In this instance when creating or editing a user you
would want to validate all 4 field rules. Yet when a user logs in
you would validate just email and password rules. To do this you
can pass an options array specifying the fields to validate:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">User</span><span class="o">-&gt;</span><span class="na">validates</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;fieldList&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">))))</span> <span class="p">{</span>
    <span class="c1">// valid</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// invalid</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The validates method invokes the invalidFields method which
populates the validationErrors property of the model. The
invalidFields method also returns that data as the result:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ModelName</span><span class="o">-&gt;</span><span class="na">invalidFields</span><span class="p">();</span> <span class="c1">// contains validationErrors array</span>
</pre></div>
</div>
<p>The validation errors list is not cleared between successive calls to <tt class="docutils literal"><span class="pre">invalidFields()</span></tt>
So if you are validating in a loop and want each set of errors separately
don&#8217;t use <tt class="docutils literal"><span class="pre">invalidFields()</span></tt>. Instead use <tt class="docutils literal"><span class="pre">validates()</span></tt>
and access the <tt class="docutils literal"><span class="pre">validationErrors</span></tt> model property.</p>
<p>It is important to note that the data must be set to the model
before the data can be validated. This is different from the save
method which allows the data to be passed in as a parameter. Also,
keep in mind that it is not required to call validates prior to
calling save as save will automatically validate the data before
actually saving.</p>
<p>To validate multiple models, the following approach should be
used:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ModelName</span><span class="o">-&gt;</span><span class="na">saveAll</span><span class="p">(</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;only&#39;</span><span class="p">)</span>
<span class="p">))</span> <span class="p">{</span>
  <span class="c1">// validates</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// does not validate</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you have validated data before save, you can turn off validation
to avoid second check:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ModelName</span><span class="o">-&gt;</span><span class="na">saveAll</span><span class="p">(</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">)</span>
<span class="p">))</span> <span class="p">{</span>
    <span class="c1">// saving without validation</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


		</div>
	</div>

	<div class="sidebar columns three pull-nine">
<div id="sidebar-navigation" class="hide-on-phones">
	<h2 class="hide-on-desktops">Table of Contents</h2>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cakephp-overview.html">CakePHP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../views.html">Views</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../models.html">Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../associations-linking-models-together.html">Associations: Linking Models Together</a></li>
<li class="toctree-l2"><a class="reference internal" href="../retrieving-your-data.html">Retrieving Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../saving-your-data.html">Saving Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deleting-data.html">Deleting Data</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../data-validation.html">Data Validation</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="">Validating Data from the Controller</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../callback-methods.html">Callback Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../behaviors.html">Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datasources.html">DataSources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model-attributes.html">Model Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../additional-methods-and-properties.html">Additional Methods and Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../virtual-fields.html">Virtual fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transactions.html">Transactions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../core-libraries.html">Core Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../console-and-shells.html">Console and Shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices.html">Appendices</a></li>
</ul>

</div>

<div class="page-contents">
	<h3>Page contents</h3>
	<ul>
<li><a class="reference internal" href="#">Validating Data from the Controller</a></li>
</ul>

</div>
	</div>

</div>

<div class="content row">
	<ul class="related-pages inline">
	<li>
		<a href="../../genindex.html" title="General Index" accesskey="I">index</a>
	</li>
	<li>
		<a href="../callback-methods.html" title="Callback Methods" accesskey="N">next</a>
	</li>
	<li>
		<a href="../data-validation.html" title="Data Validation" accesskey="P">previous</a>
	</li>
	</ul>
</div>

	<div class="footer-push"> </div>
</div>






<div class="footer">
	<div class="row">
		<div class="columns six offset-by-three contribute">
			<strong>发现翻译错误?</strong>
			请在下面留言<br />
			<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">[ 我要加入翻译 ]</a>
		</div>
	</div>
	
	<div class="row">
		<div class="columns nine offset-by-three copyright">
					&copy; Copyright 2014, Cake Software Foundation, Inc.
				Last updated on Sep 05, 2015.
				Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
		</div>
	</div>
</div>

<div id="nav-modal" class="reveal-modal"> </div>
<div id="inline-search-results"></div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->

<!-- Grunt Live Reload -->
<script src="http://192.168.56.113:35729/livereload.js"></script>
<script src="http://192.168.56.113:35730/livereload.js"></script>
  </body>
</html>