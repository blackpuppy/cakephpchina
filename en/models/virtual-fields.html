

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Virtual fields" lang="en" name="title" />
<meta content="sql expressions,array name,model fields,sql errors,virtual field,concatenation,model name,first name last name" lang="en" name="keywords" />

    <title>Virtual fields</title>
    <link href="../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/app.js"></script>

    <link rel="alternate" hreflang="pt" href="../../pt/models/virtual-fields.html" /><link rel="alternate" hreflang="es" href="../../es/models/virtual-fields.html" /><link rel="alternate" hreflang="ja" href="../../ja/models/virtual-fields.html" /><link rel="alternate" hreflang="fr" href="../../fr/models/virtual-fields.html" /><link rel="alternate" hreflang="zh" href="../../zh/models/virtual-fields.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within CakePHP Cookbook 2.x documentation" href="../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="CakePHP Cookbook 2.x documentation" href="../index.html" />
    <link rel="up" title="Models" href="../models.html" />
    <link rel="next" title="Transactions" href="transactions.html" />
    <link rel="prev" title="Additional Methods and Properties" href="additional-methods-and-properties.html" />

    <script type="text/javascript">
    window.lang = "en";
    </script>
  </head>
  <body>

<div id="container">
	
	<header class="nav-down">
		<div class="container-fluid hidden-xs hidden-sm">
			<div class="row">
				<div class="col-sm-3 col-md-3">
					<a class="logo-cake" href="http://cakephp.org">
						<img src="../_static/logo-cake.png" alt="CakePHP" />
					</a>
				</div>

				<div class="col-sm-9 col-md-9">
					<nav class="navbar-right">
						<ul class="menu">
							<li class="first">
								<a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
								<ul class="submenu">
									
<li><a href="http://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>CookBook</a></li>
<li><a href="http://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="http://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="http://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="http://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
								</ul>
							</li>

							<li><a href="http://cakephp.org/business-solutions">Business Solutions</a></li>
							<li><a href="http://cakephp.org/showcase">Showcase</a></li>

							<li>
								<a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
								<div class="megamenu full">
									<div class="row">
										<div class="col-6 pl30">
											<ul class="megamenu-list">
												
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="http://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="http://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="http://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="http://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="http://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="http://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="http://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
											</ul>
										</div>
										<div class="col-6 pl30">
											<ul class="megamenu-list">
												
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="http://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="http://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="http://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="http://cakedc.com"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
											</ul>
										</div>
									</div>
								</div>
							</li>
						</ul>
					</nav>
				</div>
			</div>
		</div>

		
		<div class="container-fluid hidden-md hidden-lg">
			<div class="row">
				<div class="col-sm-6 col-xs-6">
					<a class="logo-cake" href="http://cakephp.org">
						<img src="../_static/logo-cake.png" alt="CakePHP" />
					</a>
				</div>

				<div class="col-sm-6 col-xs-6">
					<div class="navbar-right">
						<button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
							<i class="fa fa-bars toggle-modal"></i>
						</button>
					</div>
					<div id="wrap">
						<form class="search" action="../search.html" method="get">
							<input name="q" type="search" placeholder="What are you looking for?">
							<input id="search_submit" value="Search" type="submit">
						</form>
					</div>
				</div>
			</div>
		</div>

		
		<section id="nav-cook" class="hidden-xs hidden-sm">
			<div class="container-fluid ">
				<div class="row ">
					<div class="col-md-12 back-book">
						<div class="col-md-4 col-md-offset-1 text-center t-cook-nav p0 hidden-sm hidden-xs">
							<h2>
								<a href="../contents.html">
									<span class="glyph_range icon-submenu icon-submenu-cook">B</span>
									CakePHP 2.x <strong>Cookbook</strong>
								</a>
							</h2>
						</div>

						<div class="col-md-4 hidden-sm">
							<form class="search" action="../search.html" method="get">
								<input type="hidden" name="check_keywords" value="yes" />
								<input type="hidden" name="area" value="default" />

								<div class="col-md-10 p0">
									<input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
								</div>
								<div class="col-md-2 p0 search-cook">
									<button type="submit">
										<span class="glyph_range icon-submenu icon-submenu-cook">A</span>
									</button>
								</div>
							</form>
						</div>

						
						<div class="col-md-3">
							<div class="col-md-6 p0">
								<div class="col-md-7 t-language p0">
									<h6>Language:</h6>
								</div>
								<div class="col-md-5 p0">
									<ul class="nav navbar-nav">
										<li class="dropdown">
											<a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
													role="button" aria-haspopup="true" aria-expanded="false" href="#">
														en
														<i class="fa fa-menu-en fa-chevron-down"></i>
													</a>
											<ul class="dropdown-menu">
											
												<li></li>
											
												<li><a href="../../pt/models/virtual-fields.html">pt</a></li>
											
												<li><a href="../../es/models/virtual-fields.html">es</a></li>
											
												<li><a href="../../ja/models/virtual-fields.html">ja</a></li>
											
												<li><a href="../../fr/models/virtual-fields.html">fr</a></li>
											
												<li><a href="../../zh/models/virtual-fields.html">zh</a></li>
											
											</ul>
										</li>
									</ul>
								</div>
							</div>

							<div class="col-md-6 p0">
								<div class="col-md-7 t-language p0">
									<h6>Version:</h6>
								</div>
								<div class="col-md-5 p0">
									<ul class="nav navbar-nav">
										<li class="dropdown">
											<a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">2.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
											<ul class="dropdown-menu">
												<li><a href="http://book.cakephp.org/3.0/en">3.x Book</a></li>
												<li><a href="http://book.cakephp.org/2.0/en">2.x Book</a></li>
												<li><a href="http://book.cakephp.org/1.3/en/">1.3 Book</a></li>
												<li><a href="http://book.cakephp.org/1.2/en/">1.2 Book</a></li>
												<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
											</ul>
										</li>
									</ul>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</section>
	</header>

	
	<section class="nav-btn visible-sm visible-xs">
		<div class="container">
			<div class="row">
				<div class="col-sm-6 col-xs-6 text-center">
					<button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
				</div>

				<div class="col-sm-6 col-xs-6 text-center">
					<button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
				</div>
			</div>
		</div>
	</section>

	
	<div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title-cookbook" id="modal-header"></h4>
				</div>
				<div class="modal-body"></div>
			</div>
		</div>
	</div>

<div class="container page-container"><div id="improve-slideout">
		<i class="fa fa-pencil icon-improve"></i>
		<a href="https://github.com/cakephp/docs/edit/master/en/models/virtual-fields.rst" target="_blank">
			<div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
		</a>
	</div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

	
	<div class="row">
		<div class="col-sm-12 col-md-9 col-md-push-3 space-left push-off"><div class="page-contents col-sm-5">
				<h3>Page Contents</h3>
				<ul>
<li><a class="reference internal" href="#">Virtual fields</a><ul>
<li><a class="reference internal" href="#creating-virtual-fields">Creating virtual fields</a></li>
<li><a class="reference internal" href="#using-virtual-fields">Using virtual fields</a><ul>
<li><a class="reference internal" href="#model-hasfield">Model::hasField()</a></li>
<li><a class="reference internal" href="#model-isvirtualfield">Model::isVirtualField()</a></li>
<li><a class="reference internal" href="#model-getvirtualfield">Model::getVirtualField()</a></li>
<li><a class="reference internal" href="#model-find-and-virtual-fields">Model::find() and virtual fields</a></li>
<li><a class="reference internal" href="#pagination-and-virtual-fields">Pagination and virtual fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#virtual-fields-and-model-aliases">Virtual fields and model aliases</a></li>
<li><a class="reference internal" href="#virtual-fields-in-sql-queries">Virtual fields in SQL queries</a></li>
<li><a class="reference internal" href="#limitations-of-virtualfields">Limitations of virtualFields</a></li>
</ul>
</li>
</ul>

			</div><div class="document-body">
			
  <div class="section" id="virtual-fields">
<h1>Virtual fields<a class="headerlink" href="#virtual-fields" title="Permalink to this headline">¶</a></h1>
<p>Virtual fields allow you to create arbitrary SQL expressions and
assign them as fields in a Model. These fields cannot be saved, but
will be treated like other model fields for read operations. They
will be indexed under the model&#8217;s key alongside other model
fields.</p>
<div class="section" id="creating-virtual-fields">
<h2>Creating virtual fields<a class="headerlink" href="#creating-virtual-fields" title="Permalink to this headline">¶</a></h2>
<p>Creating virtual fields is easy. In each model you can define a
<code class="docutils literal"><span class="pre">$virtualFields</span></code> property that contains an array of field =&gt;
expressions. An example of a virtual field definition using MySQL
would be:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nv">$virtualFields</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CONCAT(User.first_name, &quot; &quot;, User.last_name)&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>And with PostgreSQL:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nv">$virtualFields</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;User.first_name || \&#39; \&#39; || User.last_name&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>In subsequent find operations, your User results would contain a
<code class="docutils literal"><span class="pre">name</span></code> key with the result of the concatenation. It is not
advisable to create virtual fields with the same names as columns
on the database, this can cause SQL errors.</p>
<p>It is not always useful to have <strong>User.first_name</strong> fully
qualified. If you do not follow the convention (i.e. you have
multiple relations to other tables) this would result in an error.
In this case it may be better to just use
<code class="docutils literal"><span class="pre">first_name</span> <span class="pre">||</span> <span class="pre">\'</span> <span class="pre">\'</span> <span class="pre">||</span> <span class="pre">last_name</span></code> without the Model
Name.</p>
</div>
<div class="section" id="using-virtual-fields">
<h2>Using virtual fields<a class="headerlink" href="#using-virtual-fields" title="Permalink to this headline">¶</a></h2>
<p>Creating virtual fields is straightforward and easy, interacting
with virtual fields can be done through a few different methods.</p>
<div class="section" id="model-hasfield">
<h3>Model::hasField()<a class="headerlink" href="#model-hasfield" title="Permalink to this headline">¶</a></h3>
<p>Model::hasField() will return true if the model has a concrete field passed by
the first parameter. By setting the second parameter of <cite>hasField()</cite> to true,
virtualFields will also be checked when checking if a model has a field.
Using the example field above:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Will return false, as there is no concrete field called name</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">User</span><span class="o">-&gt;</span><span class="na">hasField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
<span class="c1">// Will return true as there is a virtual field called name</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">User</span><span class="o">-&gt;</span><span class="na">hasField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="model-isvirtualfield">
<h3>Model::isVirtualField()<a class="headerlink" href="#model-isvirtualfield" title="Permalink to this headline">¶</a></h3>
<p>This method can be used to check if a field/column is a virtual
field or a concrete field. Will return true if the column is
virtual:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">User</span><span class="o">-&gt;</span><span class="na">isVirtualField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">//true</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">User</span><span class="o">-&gt;</span><span class="na">isVirtualField</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span> <span class="c1">//false</span>
</pre></div>
</div>
</div>
<div class="section" id="model-getvirtualfield">
<h3>Model::getVirtualField()<a class="headerlink" href="#model-getvirtualfield" title="Permalink to this headline">¶</a></h3>
<p>This method can be used to access the SQL expression that comprises
a virtual field. If no argument is supplied it will return all
virtual fields in a Model:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">//returns &#39;CONCAT(User.first_name, &#39; &#39;, User.last_name)&#39;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">User</span><span class="o">-&gt;</span><span class="na">getVirtualField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="model-find-and-virtual-fields">
<h3>Model::find() and virtual fields<a class="headerlink" href="#model-find-and-virtual-fields" title="Permalink to this headline">¶</a></h3>
<p>As stated earlier <code class="docutils literal"><span class="pre">Model::find()</span></code> will treat virtual fields much
like any other field in a model. The value of a virtual field will
be placed under the model&#8217;s key in the resultset:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$results</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">User</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">);</span>

<span class="c1">// results contains the following</span>
<span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;User&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;first_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span>
        <span class="s1">&#39;last_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Story&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mark Story&#39;</span><span class="p">,</span>
        <span class="c1">//more fields.</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="pagination-and-virtual-fields">
<h3>Pagination and virtual fields<a class="headerlink" href="#pagination-and-virtual-fields" title="Permalink to this headline">¶</a></h3>
<p>Since virtual fields behave much like regular fields when doing
find&#8217;s, <code class="docutils literal"><span class="pre">Controller::paginate()</span></code> will be able to sort by virtual fields too.</p>
</div>
</div>
<div class="section" id="virtual-fields-and-model-aliases">
<h2>Virtual fields and model aliases<a class="headerlink" href="#virtual-fields-and-model-aliases" title="Permalink to this headline">¶</a></h2>
<p>When you are using virtualFields and models with aliases that are
not the same as their name, you can run into problems as
virtualFields do not update to reflect the bound alias. If you are
using virtualFields in models that have more than one alias it is
best to define the virtualFields in your model&#8217;s constructor:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$id</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$table</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$ds</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$table</span><span class="p">,</span> <span class="nv">$ds</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">virtualFields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span>
        <span class="s1">&#39;CONCAT(%s.first_name, &quot; &quot;, %s.last_name)&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">alias</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">alias</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will allow your virtualFields to work for any alias you give a
model.</p>
</div>
<div class="section" id="virtual-fields-in-sql-queries">
<h2>Virtual fields in SQL queries<a class="headerlink" href="#virtual-fields-in-sql-queries" title="Permalink to this headline">¶</a></h2>
<p>Using functions in direct SQL queries will prevent data from being returned in the same array as your model&#8217;s data.
For example this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Timelog</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span>
    <span class="s2">&quot;SELECT</span>
<span class="s2">        project_id, SUM(id) as TotalHours</span>
<span class="s2">    FROM</span>
<span class="s2">        timelogs</span>
<span class="s2">    AS</span>
<span class="s2">        Timelog</span>
<span class="s2">    GROUP BY</span>
<span class="s2">        project_id;&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>would return something like this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="nx">Timelog</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
                <span class="p">(</span>
                    <span class="p">[</span><span class="nx">project_id</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1234</span>
                <span class="p">)</span>
             <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
                 <span class="p">(</span>
                     <span class="p">[</span><span class="nx">TotalHours</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mf">25.5</span>
                 <span class="p">)</span>
        <span class="p">)</span>
 <span class="p">)</span>
</pre></div>
</div>
<p>If we want to group TotalHours into our Timelog array we should specify a
virtual field for our aggregate column. We can add this new virtual field on
the fly rather than permanently declaring it in the model. We will provide a
default value of <code class="docutils literal"><span class="pre">0</span></code> in case another query attempts to use this virtual field.
If that were to occur, <code class="docutils literal"><span class="pre">0</span></code> would be returned in the TotalHours column:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Timelog</span><span class="o">-&gt;</span><span class="na">virtualFields</span><span class="p">[</span><span class="s1">&#39;TotalHours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>In addition to adding the virtual field we also need to alias our column using
the form of <code class="docutils literal"><span class="pre">MyModel__MyField</span></code> like this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Timelog</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span>
    <span class="s2">&quot;SELECT</span>
<span class="s2">        project_id, SUM(id) as Timelog__TotalHours</span>
<span class="s2">    FROM</span>
<span class="s2">        timelogs</span>
<span class="s2">    AS</span>
<span class="s2">        Timelog</span>
<span class="s2">    GROUP BY</span>
<span class="s2">        project_id;&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Running the query again after specifying the virtual field should result in a
cleaner grouping of values:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="nx">Timelog</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
                <span class="p">(</span>
                    <span class="p">[</span><span class="nx">project_id</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1234</span>
                    <span class="p">[</span><span class="nx">TotalHours</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mf">25.5</span>
                <span class="p">)</span>
        <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="limitations-of-virtualfields">
<h2>Limitations of virtualFields<a class="headerlink" href="#limitations-of-virtualfields" title="Permalink to this headline">¶</a></h2>
<p>The implementation of <code class="docutils literal"><span class="pre">virtualFields</span></code> has a few
limitations. First you cannot use <code class="docutils literal"><span class="pre">virtualFields</span></code> on associated
models for conditions, order, or fields arrays. Doing so will
generally result in an SQL error as the fields are not replaced by
the ORM. This is because it difficult to estimate the depth at
which an associated model might be found.</p>
<p>A common workaround for this implementation issue is to copy
<code class="docutils literal"><span class="pre">virtualFields</span></code> from one model to another at runtime when you
need to access them:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">virtualFields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Author</span><span class="o">-&gt;</span><span class="na">virtualFields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">virtualFields</span> <span class="o">+=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Author</span><span class="o">-&gt;</span><span class="na">virtualFields</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>


			</div>
		</div>

		
		<div class="col-md-3 col-md-pull-9 pull-off hidden-xs hidden-sm" lang="en">
			<aside class="sidebar">
				<div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cakephp-overview.html">CakePHP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../models.html">Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="associations-linking-models-together.html">Associations: Linking Models Together</a></li>
<li class="toctree-l2"><a class="reference internal" href="retrieving-your-data.html">Retrieving Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="saving-your-data.html">Saving Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="deleting-data.html">Deleting Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-validation.html">Data Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="callback-methods.html">Callback Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors.html">Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasources.html">DataSources</a></li>
<li class="toctree-l2"><a class="reference internal" href="model-attributes.html">Model Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="additional-methods-and-properties.html">Additional Methods and Properties</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Virtual fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="transactions.html">Transactions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries.html">Core Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Shells, Tasks &amp; Console Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

				</div>
			</aside>
			<aside class="sidebar">
				<div class="mb30 row">
				</div>
			</aside>
		</div>
	</div>
</div>

<section id="socials" class="back-3">
	<div class="container-fluid">
		<div class="row">
			<div class="col-xs-12 col-sm-12 col-md-4  social text-center">
				<div class="col-sm-3 col-xs-3">
					<div id="fb-root"></div>
						<script>(function(d, s, id) {
						  var js, fjs = d.getElementsByTagName(s)[0];
						  if (d.getElementById(id)) return;
						  js = d.createElement(s); js.id = id;
						  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
						  fjs.parentNode.insertBefore(js, fjs);
						}(document, 'script', 'facebook-jssdk'));
						</script>
						<div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
				</div>

				<div class="col-sm-3 col-xs-3">
					<iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
				</div>

				<div class="col-sm-3 col-xs-3">
					<iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
				</div>

				<div class="col-sm-3 col-xs-3">
					<a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
				</div>
			</div>

			<div class="col-xs-12 col-sm-12 col-md-8 social-footer text-center ">
				<a href="#">发现翻译错误? 请在下面留言</a>
				<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">我要加入翻译</a>
				<a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
				<a href="http://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
				<a href="http://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
				<a href="http://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
				<a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
				<a href="http://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
				<a href="http://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
				<a href="http://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
			</div>
		</div>
	</div>
</section>

<footer id="footer" class="footer-wrapper">
	<div class="container">

		<div class="row col-p30">
			<div class="col-sm-12 col-md-3">
				<div class="footer-widget t-footer">
					<div class="col-md-12">
						<a href="https://www.openhub.net/p/cakephp">
							<img src="../_static/open-hub.png">
						</a>
						<div class="mt10">
							<a href="https://www.rackspace.com/">
								<img src="../_static/rackspace.png">
							</a>
						</div>
					</div>
				</div>
			</div>

			<div class="col-sm-12 col-md-9">
				<div class="col-md-3 col-sm-6 business-solution">
					<ul class="footer-menu">
						<li class="menu-title">
	<a href="http://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
	<a href="http://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
					</ul>
				</div>

				<div class="col-md-3 col-sm-6">
					<ul class="footer-menu">
						
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="http://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>CookBook</a></li>
<li><a href="http://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="http://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="http://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="http://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
					</ul>
				</div>

				<div class="col-md-3 col-sm-6">
					<ul class="footer-menu">
						
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="http://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="http://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="http://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="http://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="http://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="http://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="http://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
					</ul>
				</div>

				<div class="col-md-3 col-sm-6">
					<ul class="footer-menu">
						
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="http://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="http://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="http://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="http://cakedc.com"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
					</ul>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 text-center mt30">
				<p class="copyright">
							&copy; Copyright 2016, Cake Software Foundation, Inc.
						Last updated on Aug 04, 2016.
						Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
				</p>
			</div>
		</div>
	</div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-743287-3']);
	_gaq.push(['_trackPageview']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
  </body>
</html>