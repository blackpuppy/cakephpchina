
<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="DataSources" lang="en" name="title" />
<meta content="array values,model fields,connection configuration,implementation details,relational databases,best bet,mysql postgresql,sqlite,external sources,ldap server,database connection,rdbms,sqlserver,postgres,relational database,microsoft sql server,aggregates,apis,repository,signatures" lang="en" name="keywords" />

    <title>DataSources &mdash; CakePHP Cookbook 2.x documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/app.js"></script>
    <script type="text/javascript" src="../_static/modernizr.foundation.js"></script>
    <script type="text/javascript" src="../_static/foundation.js"></script>
    <link rel="top" title="CakePHP Cookbook 2.x documentation" href="../index.html" />
    <link rel="up" title="Models" href="../models.html" />
    <link rel="next" title="Model Attributes" href="model-attributes.html" />
    <link rel="prev" title="Tree" href="../core-libraries/behaviors/tree.html" />
<link href="../_static/favicon.ico" type="image/x-icon" rel="icon" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="alternate" hreflang="pt" href="../../pt/models/datasources.html" /><link rel="alternate" hreflang="es" href="../../es/models/datasources.html" /><link rel="alternate" hreflang="ja" href="../../ja/models/datasources.html" /><link rel="alternate" hreflang="fr" href="../../fr/models/datasources.html" /><link rel="alternate" hreflang="zh_CN" href="../../zh/models/datasources.html" />

<link rel="search" type="application/opensearchdescription+xml" title="CakePHP Book 2.x Search" href="../_static/opensearchdescription-book-2-x.xml">
<script type="text/javascript">
window.lang = "en";
</script>

  </head>
  <body>

<div id="container">

<div id="cakephp-global-navigation">
	<ul>
		<li class="main"><a href="http://cakephp.org">CakePHP</a></li>
		<li class="primary"><a href="#" class="empty">Downloads</a>
			<ul class="second-level">
				<li><a href="https://github.com/cakephp/cakephp/tags">Releases</a></li>
				<li><a href="http://pear.cakephp.org">Pear channel</a></li>
			</ul>
		</li>
		<li class="primary"><a href="#" class="empty">Documentation</a>
			<ul class="second-level">
				<li><a href="http://api.cakephp.org">API</a></li>
				<li><a href="http://book.cakephp.org">Book</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://community.cakephp.org">Community</a>
			<ul class="second-level">
				<li><a href="http://webchat.freenode.net/?channels=cakephp&uio=MT1mYWxzZSY5PXRydWUmMTE9MjQ2b8">Help &amp; Support</a></li>
				<li><a href="https://github.com/cakephp/cakephp/issues">Issues</a></li>
				<li><a href="http://bakery.cakephp.org">The Bakery</a></li>
				<li><a href="http://stackoverflow.com/tags/cakephp">Stack Overflow</a></li>
				<li><a href="http://www.facebook.com/groups/cake.community">Facebook Group</a></li>
				<li><a href="http://goo.gl/mSC0s">Google+ Community</a></li>
				<li><a href="http://www.youtube.com/user/CakePHP">YouTube Channel</a></li>
				<li><a href="http://podcast.cakephp.org">CakePHP Podcast</a></li>
				<li><a href="http://twitter.com/CakePHP">Follow us on Twitter</a></li>
				<li><a href="http://groups.google.com/group/cake-php">Google Group</a></li>
				<li><a href="http://github.com/cakephp/cakephp/contributors">Contributors</a></li>
				<li><a href="http://plugins.cakephp.org">Plugins &amp; Packages</a></li>
				<li><a href="http://community.cakephp.org/get-involved">Get Involved</a></li>
				<li><a href="http://community.cakephp.org/guidelines">Guidelines</a></li>
				<li><a href="http://cakefest.org">CakeFest</a></li>
				<li><a href="http://cakephp.org/logos">Logo</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://cakephp.org/services">Services</a>
			<ul class="second-level">
				<li><a href="http://cakephp.org/services/certification">Certification</a></li>
				<li><a href="http://cakephp.org/services/consultation">Consultation</a></li>
				<li><a href="http://cakephp.org/services/support">Support</a></li>
				<li><a href="http://training.cakephp.org">Training</a></li>
			</ul>
		</li>
	</ul>
</div>

<div class="masthead">
	<div class="header-backing"></div>
	<div class="searchbar row">
		<div class="columns three phone-one">
			<a class="logo" href="../contents.html">
			<img src="../_static/cake-logo.png" alt="CakePHP" width="70" />
			</a>
		</div>
		
<div id="searchbox" class="columns nine phone-three">

	<form id="searchform" class="search" action="../search.html" method="get">
		<input class="search-input" autocomplete="off" type="search" name="q" size="18" />
		<input class="search-submit search-big button red" type="submit" value="Search" />
		<input type="hidden" name="check_keywords" value="yes" />
		<input type="hidden" name="area" value="default" />

		<a href="#" id="tablet-nav" class="show-on-phones pale button small">Nav</a>
	</form>

</div>
	</div>
</div>
<div class="breadcrumb-header">
	<div class="related row">
		<div class="columns three root-link">
			<a href="../contents.html">Cookbook 2.x</a>
		</div>
		<div class="columns nine">
			<ul class="inline breadcrumb">
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../models.html" accesskey="U" itemprop="url"><span itemprop="title">Models</span></a>
			</li>
			</ul>
			<div class="versions dropdown">
				<a href="#">2.x Book</a>
				<ul>
					<li><a href="http://book.cakephp.org/3.0/en">3.0 Book</a></li>
					<li><a href="http://book.cakephp.org/1.3/en/">1.3 Book</a></li>
					<li><a href="http://book.cakephp.org/1.2/en/">1.2 Book</a></li>
					<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
				</ul>
			</div>

			<div class="languages dropdown">
				<a href="#">en</a>

				<ul>
				
					<li></li>
				
					<li><a href="../../pt/models/datasources.html">pt</a></li>
				
					<li><a href="../../es/models/datasources.html">es</a></li>
				
					<li><a href="../../ja/models/datasources.html">ja</a></li>
				
					<li><a href="../../fr/models/datasources.html">fr</a></li>
				
					<li><a href="../../zh/models/datasources.html">zh_CN</a></li>
				
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="content row">
	<div class="document columns nine push-three">
		<div class="body"><a class="button pale improve" href="https://github.com/cakephp/docs/edit/master/en/models/datasources.rst" target="_blank">Improve this Doc</a>
  <div class="section" id="datasources">
<h1>DataSources<a class="headerlink" href="#datasources" title="Permalink to this headline">¶</a></h1>
<p>DataSources are the link between models and the source of data that
models represent. In many cases, the data is retrieved from a
relational database such as MySQL, PostgreSQL or Microsoft SQL Server. CakePHP is
distributed with several database-specific datasources (see the
class files in <tt class="docutils literal"><span class="pre">lib/Cake/Model/Datasource/Database</span></tt>), a summary
of which is listed here for your convenience:</p>
<ul class="simple">
<li>Mysql</li>
<li>Postgres</li>
<li>Sqlite</li>
<li>Sqlserver</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can find additional community contributed datasources in the
<a class="reference external" href="https://github.com/cakephp/datasources/tree/2.0">CakePHP DataSources repository on GitHub</a>.</p>
</div>
<p>When specifying a database connection configuration in
<tt class="docutils literal"><span class="pre">app/Config/database.php</span></tt>, CakePHP transparently uses the corresponding
database datasource for all model operations. So, even though you might not have
known about datasources, you&#8217;ve been using them all along.</p>
<p>All of the above sources derive from a base <tt class="docutils literal"><span class="pre">DboSource</span></tt> class, which
aggregates some logic that is common to most relational databases. If you decide
to write a RDBMS datasource, working from one of these (e.g. MySQL, or SQLite)
is your best bet.</p>
<p>Most people, however, are interested in writing datasources for external sources
of data, such as remote REST APIs or even an LDAP server. So that&#8217;s what we&#8217;re
going to look at now.</p>
<div class="section" id="basic-api-for-datasources">
<h2>Basic API For DataSources<a class="headerlink" href="#basic-api-for-datasources" title="Permalink to this headline">¶</a></h2>
<p>A datasource can, and <em>should</em> implement at least one of the
following methods: <tt class="docutils literal"><span class="pre">create</span></tt>, <tt class="docutils literal"><span class="pre">read</span></tt>, <tt class="docutils literal"><span class="pre">update</span></tt> and/or
<tt class="docutils literal"><span class="pre">delete</span></tt> (the actual method signatures &amp; implementation details
are not important for the moment, and will be described later). You
need not implement more of the methods listed above than necessary
- if you need a read-only datasource, there&#8217;s no reason to
implement <tt class="docutils literal"><span class="pre">create</span></tt>, <tt class="docutils literal"><span class="pre">update</span></tt>, and <tt class="docutils literal"><span class="pre">delete</span></tt>.</p>
<p>Methods that must be implemented for all CRUD methods:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">describe($model)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">listSources($data</span> <span class="pre">=</span> <span class="pre">null)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">calculate($model,</span> <span class="pre">$func,</span> <span class="pre">$params)</span></tt></li>
<li>At least one of:<ul>
<li><tt class="docutils literal"><span class="pre">create(Model</span> <span class="pre">$model,</span> <span class="pre">$fields</span> <span class="pre">=</span> <span class="pre">null,</span> <span class="pre">$values</span> <span class="pre">=</span> <span class="pre">null)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">read(Model</span> <span class="pre">$model,</span> <span class="pre">$queryData</span> <span class="pre">=</span> <span class="pre">array(),</span> <span class="pre">$recursive</span> <span class="pre">=</span> <span class="pre">null)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">update(Model</span> <span class="pre">$model,</span> <span class="pre">$fields</span> <span class="pre">=</span> <span class="pre">null,</span> <span class="pre">$values</span> <span class="pre">=</span> <span class="pre">null,</span> <span class="pre">$conditions</span> <span class="pre">=</span> <span class="pre">null)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">delete(Model</span> <span class="pre">$model,</span> <span class="pre">$id</span> <span class="pre">=</span> <span class="pre">null)</span></tt></li>
</ul>
</li>
</ul>
<p>It is also possible (and sometimes quite useful) to define the
<tt class="docutils literal"><span class="pre">$_schema</span></tt> class attribute inside the datasource itself, instead
of in the model.</p>
<p>And that&#8217;s pretty much all there is to it. By coupling this
datasource to a model, you are then able to use
<tt class="docutils literal"><span class="pre">Model::find()/save()/delete()</span></tt> as you would normally, and the appropriate
data and/or parameters used to call those methods will be passed on
to the datasource itself, where you can decide to implement
whichever features you need (e.g. Model::find options such as
<tt class="docutils literal"><span class="pre">'conditions'</span></tt> parsing, <tt class="docutils literal"><span class="pre">'limit'</span></tt> or even your own custom
parameters).</p>
</div>
<div class="section" id="an-example">
<h2>An Example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h2>
<p>A common reason you would want to write your own datasource is when you would
like to access a 3rd party API using the usual <tt class="docutils literal"><span class="pre">Model::find()/save()/delete()</span></tt>
methods. Let&#8217;s write a datasource that will access a fictitious remote JSON
based API. We&#8217;ll call it <tt class="docutils literal"><span class="pre">FarAwaySource</span></tt> and we&#8217;ll put it in
<tt class="docutils literal"><span class="pre">app/Model/Datasource/FarAwaySource.php</span></tt>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;HttpSocket&#39;</span><span class="p">,</span> <span class="s1">&#39;Network/Http&#39;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">FarAwaySource</span> <span class="k">extends</span> <span class="nx">DataSource</span> <span class="p">{</span>

<span class="sd">/**</span>
<span class="sd"> * An optional description of your datasource</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">&#39;A far away datasource&#39;</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Our default config options. These options will be customized in our</span>
<span class="sd"> * ``app/Config/database.php`` and will be merged in the ``__construct()``.</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="nv">$config</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;apiKey&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="p">);</span>

<span class="sd">/**</span>
<span class="sd"> * If we want to create() or update() we need to specify the fields</span>
<span class="sd"> * available. We use the same array keys as we do with CakeSchema, eg.</span>
<span class="sd"> * fixtures and schema migrations.</span>
<span class="sd"> */</span>
    <span class="k">protected</span> <span class="nv">$_schema</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
            <span class="s1">&#39;key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
            <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
            <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">);</span>

<span class="sd">/**</span>
<span class="sd"> * Create our HttpSocket and handle any config tweaks.</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpSocket</span><span class="p">();</span>
    <span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * Since datasources normally connect to a database there are a few things</span>
<span class="sd"> * we must change to get them to work without a database.</span>
<span class="sd"> */</span>

<span class="sd">/**</span>
<span class="sd"> * listSources() is for caching. You&#39;ll likely want to implement caching in</span>
<span class="sd"> * your own way with a custom datasource. So just ``return null``.</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">listSources</span><span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * describe() tells the model your schema for ``Model::save()``.</span>
<span class="sd"> *</span>
<span class="sd"> * You may want a different schema for each model but still use a single</span>
<span class="sd"> * datasource. If this is your case then set a ``schema`` property on your</span>
<span class="sd"> * models and simply return ``$model-&gt;schema`` here instead.</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">describe</span><span class="p">(</span><span class="nv">$model</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_schema</span><span class="p">;</span>
    <span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * calculate() is for determining how we will count the records and is</span>
<span class="sd"> * required to get ``update()`` and ``delete()`` to work.</span>
<span class="sd"> *</span>
<span class="sd"> * We don&#39;t count the records here but return a string to be passed to</span>
<span class="sd"> * ``read()`` which will do the actual counting. The easiest way is to just</span>
<span class="sd"> * return the string &#39;COUNT&#39; and check for it in ``read()`` where</span>
<span class="sd"> * ``$data[&#39;fields&#39;] === &#39;COUNT&#39;``.</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">calculate</span><span class="p">(</span><span class="nx">Model</span> <span class="nv">$model</span><span class="p">,</span> <span class="nv">$func</span><span class="p">,</span> <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;COUNT&#39;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * Implement the R in CRUD. Calls to ``Model::find()`` arrive here.</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">read</span><span class="p">(</span><span class="nx">Model</span> <span class="nv">$model</span><span class="p">,</span> <span class="nv">$queryData</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
        <span class="nv">$recursive</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="sd">/**</span>
<span class="sd">         * Here we do the actual count as instructed by our calculate()</span>
<span class="sd">         * method above. We could either check the remote source or some</span>
<span class="sd">         * other way to get the record count. Here we&#39;ll simply return 1 so</span>
<span class="sd">         * ``update()`` and ``delete()`` will assume the record exists.</span>
<span class="sd">         */</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$queryData</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;COUNT&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;count&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">)));</span>
        <span class="p">}</span>
        <span class="sd">/**</span>
<span class="sd">         * Now we get, decode and return the remote data.</span>
<span class="sd">         */</span>
        <span class="nv">$queryData</span><span class="p">[</span><span class="s1">&#39;conditions&#39;</span><span class="p">][</span><span class="s1">&#39;apiKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">[</span><span class="s1">&#39;apiKey&#39;</span><span class="p">];</span>
        <span class="nv">$json</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Http</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span>
            <span class="s1">&#39;http://example.com/api/list.json&#39;</span><span class="p">,</span>
            <span class="nv">$queryData</span><span class="p">[</span><span class="s1">&#39;conditions&#39;</span><span class="p">]</span>
        <span class="p">);</span>
        <span class="nv">$res</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$json</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$res</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$error</span> <span class="o">=</span> <span class="nb">json_last_error</span><span class="p">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">CakeException</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">alias</span> <span class="o">=&gt;</span> <span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * Implement the C in CRUD. Calls to ``Model::save()`` without $model-&gt;id</span>
<span class="sd"> * set arrive here.</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span><span class="nx">Model</span> <span class="nv">$model</span><span class="p">,</span> <span class="nv">$fields</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$values</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="nv">$fields</span><span class="p">,</span> <span class="nv">$values</span><span class="p">);</span>
        <span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;apiKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">[</span><span class="s1">&#39;apiKey&#39;</span><span class="p">];</span>
        <span class="nv">$json</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Http</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://example.com/api/set.json&#39;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
        <span class="nv">$res</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$json</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$res</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$error</span> <span class="o">=</span> <span class="nb">json_last_error</span><span class="p">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">CakeException</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * Implement the U in CRUD. Calls to ``Model::save()`` with $Model-&gt;id</span>
<span class="sd"> * set arrive here. Depending on the remote source you can just call</span>
<span class="sd"> * ``$this-&gt;create()``.</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Model</span> <span class="nv">$model</span><span class="p">,</span> <span class="nv">$fields</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$values</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="nv">$conditions</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="nv">$fields</span><span class="p">,</span> <span class="nv">$values</span><span class="p">);</span>
    <span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * Implement the D in CRUD. Calls to ``Model::delete()`` arrive here.</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nx">Model</span> <span class="nv">$model</span><span class="p">,</span> <span class="nv">$id</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$json</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Http</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;http://example.com/api/remove.json&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">[</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">alias</span> <span class="o">.</span> <span class="s1">&#39;.id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;apiKey&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">[</span><span class="s1">&#39;apiKey&#39;</span><span class="p">],</span>
        <span class="p">));</span>
        <span class="nv">$res</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$json</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$res</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$error</span> <span class="o">=</span> <span class="nb">json_last_error</span><span class="p">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">CakeException</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>We can then configure the datasource in our <tt class="docutils literal"><span class="pre">app/Config/database.php</span></tt> file
by adding something like this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$faraway</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;datasource&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;FarAwaySource&#39;</span><span class="p">,</span>
    <span class="s1">&#39;apiKey&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;1234abcd&#39;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Then use the database config in our models like this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyModel</span> <span class="k">extends</span> <span class="nx">AppModel</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$useDbConfig</span> <span class="o">=</span> <span class="s1">&#39;faraway&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can retrieve data from our remote source using the familiar model methods:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// Get all messages from &#39;Some Person&#39;</span>
<span class="nv">$messages</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">MyModel</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Some Person&#39;</span><span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Using find types other than <tt class="docutils literal"><span class="pre">'all'</span></tt> can have unexpected results if the
result of your <tt class="docutils literal"><span class="pre">read</span></tt> method is not a numerically indexed array.</p>
</div>
<p>Similarly we can save a new message:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">MyModel</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Some Person&#39;</span><span class="p">,</span>
    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;New Message&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<p>Update the previous message:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">MyModel</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">MyModel</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Updated message&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<p>And delete the message:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">MyModel</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="plugin-datasources">
<h2>Plugin DataSources<a class="headerlink" href="#plugin-datasources" title="Permalink to this headline">¶</a></h2>
<p>You can also package Datasources into plugins.</p>
<p>Simply place your datasource file into
<tt class="docutils literal"><span class="pre">Plugin/[YourPlugin]/Model/Datasource/[YourSource].php</span></tt>
and refer to it using the plugin notation:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$faraway</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;datasource&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MyPlugin.FarAwaySource&#39;</span><span class="p">,</span>
    <span class="s1">&#39;apiKey&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;abcd1234&#39;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="connecting-to-sql-server">
<h2>Connecting to SQL Server<a class="headerlink" href="#connecting-to-sql-server" title="Permalink to this headline">¶</a></h2>
<p>The Sqlserver datasource depends on Microsoft&#8217;s PHP extension called pdo_sqlsrv.
This PHP Extension is not included in the base installation of PHP and must be
installed separately.</p>
<p>Also the SQL Server Native Client must be installed for the extension to work.
As the Native Client is available only for Windows you will not be able to
install it on Linux, Mac OS X or FreeBSD.</p>
<p>So if the Sqlserver Datasource errors out with:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nx">Error</span><span class="o">:</span> <span class="nx">Database</span> <span class="nx">connection</span> <span class="s2">&quot;Sqlserver&quot;</span> <span class="nx">is</span> <span class="nx">missing</span><span class="p">,</span> <span class="k">or</span> <span class="nx">could</span> <span class="k">not</span> <span class="nx">be</span> <span class="nx">created</span><span class="o">.</span>
</pre></div>
</div>
<p>First check if the SQL Server PHP extension pdo_sqlsrv and the SQL Server Native
Client are installed properly.</p>
</div>
</div>


		</div>
	</div>

	<div class="sidebar columns three pull-nine">
<div id="sidebar-navigation" class="hide-on-phones">
	<h2 class="hide-on-desktops">Table of Contents</h2>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cakephp-overview.html">CakePHP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../models.html">Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="associations-linking-models-together.html">Associations: Linking Models Together</a></li>
<li class="toctree-l2"><a class="reference internal" href="retrieving-your-data.html">Retrieving Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="saving-your-data.html">Saving Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="deleting-data.html">Deleting Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-validation.html">Data Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="callback-methods.html">Callback Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors.html">Behaviors</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">DataSources</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="model-attributes.html">Model Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="additional-methods-and-properties.html">Additional Methods and Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtual-fields.html">Virtual fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="transactions.html">Transactions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries.html">Core Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Console and Shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

<div class="page-contents">
	<h3>Page contents</h3>
	<ul>
<li><a class="reference internal" href="#">DataSources</a><ul>
<li><a class="reference internal" href="#basic-api-for-datasources">Basic API For DataSources</a></li>
<li><a class="reference internal" href="#an-example">An Example</a></li>
<li><a class="reference internal" href="#plugin-datasources">Plugin DataSources</a></li>
<li><a class="reference internal" href="#connecting-to-sql-server">Connecting to SQL Server</a></li>
</ul>
</li>
</ul>

</div>
	</div>

</div>

<div class="content row">
	<ul class="related-pages inline">
	<li>
		<a href="../genindex.html" title="General Index" accesskey="I">index</a>
	</li>
	<li>
		<a href="model-attributes.html" title="Model Attributes" accesskey="N">next</a>
	</li>
	<li>
		<a href="../core-libraries/behaviors/tree.html" title="Tree" accesskey="P">previous</a>
	</li>
	</ul>
</div>

	<div class="footer-push"> </div>
</div>






<div class="footer">
	<div class="row">
		<div class="columns six offset-by-three contribute">
			<strong>发现翻译错误?</strong>
			请在下面留言<br />
			<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">[ 我要加入翻译 ]</a>
		</div>
	</div>
	
	<div class="row">
		<div class="columns nine offset-by-three copyright">
					&copy; Copyright 2014, Cake Software Foundation, Inc.
				Last updated on Aug 31, 2015.
				Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
		</div>
	</div>
</div>

<div id="nav-modal" class="reveal-modal"> </div>
<div id="inline-search-results"></div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
  </body>
</html>