
<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Sessions" lang="en" name="title" />
<meta content="session defaults,session classes,utility features,session timeout,session ids,persistent data,session key,session cookie,session data,last session,core database,security level,useragent,security reasons,session id,attr,countdown,regeneration,sessions,config" lang="en" name="keywords" />

    <title>Sessions &mdash; CakePHP Cookbook 2.x documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/app.js"></script>
    <script type="text/javascript" src="../_static/modernizr.foundation.js"></script>
    <script type="text/javascript" src="../_static/foundation.js"></script>
    <link rel="top" title="CakePHP Cookbook 2.x documentation" href="../index.html" />
    <link rel="up" title="Development" href="../development.html" />
    <link rel="next" title="Exceptions" href="exceptions.html" />
    <link rel="prev" title="Routing" href="routing.html" />
<link href="../_static/favicon.ico" type="image/x-icon" rel="icon" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="alternate" hreflang="pt" href="../../pt/development/sessions.html" /><link rel="alternate" hreflang="es" href="../../es/development/sessions.html" /><link rel="alternate" hreflang="ja" href="../../ja/development/sessions.html" /><link rel="alternate" hreflang="fr" href="../../fr/development/sessions.html" /><link rel="alternate" hreflang="zh_CN" href="../../zh/development/sessions.html" />

<link rel="search" type="application/opensearchdescription+xml" title="CakePHP Book 2.x Search" href="../_static/opensearchdescription-book-2-x.xml">
<script type="text/javascript">
window.lang = "en";
</script>

  </head>
  <body>

<div id="container">

<div id="cakephp-global-navigation">
	<ul>
		<li class="main"><a href="http://cakephp.org">CakePHP</a></li>
		<li class="primary"><a href="#" class="empty">Downloads</a>
			<ul class="second-level">
				<li><a href="https://github.com/cakephp/cakephp/tags">Releases</a></li>
				<li><a href="http://pear.cakephp.org">Pear channel</a></li>
			</ul>
		</li>
		<li class="primary"><a href="#" class="empty">Documentation</a>
			<ul class="second-level">
				<li><a href="http://api.cakephp.org">API</a></li>
				<li><a href="http://book.cakephp.org">Book</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://community.cakephp.org">Community</a>
			<ul class="second-level">
				<li><a href="http://webchat.freenode.net/?channels=cakephp&uio=MT1mYWxzZSY5PXRydWUmMTE9MjQ2b8">Help &amp; Support</a></li>
				<li><a href="https://github.com/cakephp/cakephp/issues">Issues</a></li>
				<li><a href="http://bakery.cakephp.org">The Bakery</a></li>
				<li><a href="http://stackoverflow.com/tags/cakephp">Stack Overflow</a></li>
				<li><a href="http://www.facebook.com/groups/cake.community">Facebook Group</a></li>
				<li><a href="http://goo.gl/mSC0s">Google+ Community</a></li>
				<li><a href="http://www.youtube.com/user/CakePHP">YouTube Channel</a></li>
				<li><a href="http://podcast.cakephp.org">CakePHP Podcast</a></li>
				<li><a href="http://twitter.com/CakePHP">Follow us on Twitter</a></li>
				<li><a href="http://groups.google.com/group/cake-php">Google Group</a></li>
				<li><a href="http://github.com/cakephp/cakephp/contributors">Contributors</a></li>
				<li><a href="http://plugins.cakephp.org">Plugins &amp; Packages</a></li>
				<li><a href="http://community.cakephp.org/get-involved">Get Involved</a></li>
				<li><a href="http://community.cakephp.org/guidelines">Guidelines</a></li>
				<li><a href="http://cakefest.org">CakeFest</a></li>
				<li><a href="http://cakephp.org/logos">Logo</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://cakephp.org/services">Services</a>
			<ul class="second-level">
				<li><a href="http://certification.cakephp.org">Certification</a></li>
				<li><a href="http://cakephp.org/services/consultation">Consultation</a></li>
				<li><a href="http://cakephp.org/services/support">Support</a></li>
				<li><a href="http://training.cakephp.org">Training</a></li>
			</ul>
		</li>
	</ul>
</div>

<div class="masthead">
	<div class="header-backing"></div>
	<div class="searchbar row">
		<div class="columns three phone-one">
			<a class="logo" href="../contents.html">
			<img src="../_static/cake-logo.png" alt="CakePHP" width="70" />
			</a>
		</div>
		
<div id="searchbox" class="columns nine phone-three">

	<form id="searchform" class="search" action="../search.html" method="get">
		<input class="search-input" autocomplete="off" type="search" name="q" size="18" />
		<input class="search-submit search-big button red" type="submit" value="Search" />
		<input type="hidden" name="check_keywords" value="yes" />
		<input type="hidden" name="area" value="default" />

		<a href="#" id="tablet-nav" class="show-on-phones pale button small">Nav</a>
	</form>

</div>
	</div>
</div>
<div class="breadcrumb-header">
	<div class="related row">
		<div class="columns three root-link">
			<a href="../contents.html">Cookbook 2.x</a>
		</div>
		<div class="columns nine">
			<ul class="inline breadcrumb">
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../development.html" accesskey="U" itemprop="url"><span itemprop="title">Development</span></a>
			</li>
			</ul>
			<div class="versions dropdown">
				<a href="#">2.x Book</a>
				<ul>
					<li><a href="http://book.cakephp.org/3.0/en">3.0 Book</a></li>
					<li><a href="http://book.cakephp.org/1.3/en/">1.3 Book</a></li>
					<li><a href="http://book.cakephp.org/1.2/en/">1.2 Book</a></li>
					<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
				</ul>
			</div>

			<div class="languages dropdown">
				<a href="#">en</a>

				<ul>
				
					<li></li>
				
					<li><a href="../../pt/development/sessions.html">pt</a></li>
				
					<li><a href="../../es/development/sessions.html">es</a></li>
				
					<li><a href="../../ja/development/sessions.html">ja</a></li>
				
					<li><a href="../../fr/development/sessions.html">fr</a></li>
				
					<li><a href="../../zh/development/sessions.html">zh_CN</a></li>
				
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="content row">
	<div class="document columns nine push-three">
		<div class="body"><a class="button pale improve" href="https://github.com/cakephp/docs/edit/master/en/development/sessions.rst" target="_blank">Improve this Doc</a>
  <div class="section" id="sessions">
<h1>Sessions<a class="headerlink" href="#sessions" title="Permalink to this headline">¶</a></h1>
<p>CakePHP provides a wrapper and suite of utility features on top of PHP&#8217;s native
<tt class="docutils literal"><span class="pre">session</span></tt> extension. Sessions allow you to identify unique users across the
requests and store persistent data for specific users. Unlike Cookies, session
data is not available on the client side. Usage of <tt class="docutils literal"><span class="pre">$_SESSION</span></tt> is generally
avoided in CakePHP, and instead usage of the Session classes is preferred.</p>
<div class="section" id="session-configuration">
<h2>Session Configuration<a class="headerlink" href="#session-configuration" title="Permalink to this headline">¶</a></h2>
<p>Session configuration is stored in <tt class="docutils literal"><span class="pre">Configure</span></tt> under the top
level <tt class="docutils literal"><span class="pre">Session</span></tt> key, and a number of options are available:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Session.cookie</span></tt> - Change the name of the session cookie.</li>
<li><tt class="docutils literal"><span class="pre">Session.timeout</span></tt> - The number of <em>minutes</em> before CakePHP&#8217;s session handler expires the session.
This affects <tt class="docutils literal"><span class="pre">Session.autoRegenerate</span></tt> (below), and is handled by CakeSession.</li>
<li><tt class="docutils literal"><span class="pre">Session.cookieTimeout</span></tt> - The number of <em>minutes</em> before the session cookie expires.
If this is undefined, it will use the same value as <tt class="docutils literal"><span class="pre">Session.timeout</span></tt>.
This affects the session cookie, and is handled by PHP itself.</li>
<li><tt class="docutils literal"><span class="pre">Session.checkAgent</span></tt> - Should the user agent be checked, on each request. If
the user agent does not match the session will be destroyed.</li>
<li><tt class="docutils literal"><span class="pre">Session.autoRegenerate</span></tt> - Enabling this setting, turns on automatic
renewal of sessions, and session ids that change frequently. Enabling this
value will use the session&#8217;s <tt class="docutils literal"><span class="pre">Config.countdown</span></tt> value to keep track of requests.
Once the countdown reaches 0, the session id will be regenerated. This is a
good option to use for applications that need frequently
changing session ids for security reasons. You can control the number of requests
needed to regenerate the session by modifying <tt class="xref php php-attr docutils literal"><span class="pre">CakeSession::$requestCountdown</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">Session.defaults</span></tt> - Allows you to use one the built-in default session
configurations as a base for your session configuration.</li>
<li><tt class="docutils literal"><span class="pre">Session.handler</span></tt> - Allows you to define a custom session handler. The core
database and cache session handlers use this. This option replaces
<tt class="docutils literal"><span class="pre">Session.save</span></tt> in previous versions. See below for additional information on
Session handlers.</li>
<li><tt class="docutils literal"><span class="pre">Session.ini</span></tt> - Allows you to set additional session ini settings for your
config. This combined with <tt class="docutils literal"><span class="pre">Session.handler</span></tt> replace the custom session
handling features of previous versions</li>
</ul>
<p>CakePHP&#8217;s defaults to setting <tt class="docutils literal"><span class="pre">session.cookie_secure</span></tt> to true, when your
application is on an SSL protocol. If your application serves from both SSL and
non-SSL protocols, then you might have problems with sessions being lost. If
you need access to the session on both SSL and non-SSL domains you will want to
disable this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ini&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;session.cookie_secure&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>Session cookie paths default to <tt class="docutils literal"><span class="pre">/</span></tt> in 2.0, to change this you can use the
<tt class="docutils literal"><span class="pre">session.cookie_path</span></tt> ini flag to the directory path of your application:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ini&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;session.cookie_path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/app/dir&#39;</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>If you are using php&#8217;s default session settings, take note that
session.gc_maxlifetime can override your setting for timeout. The default is
24 minutes. Change this in your ini settings to get it to match longer
sessions:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span>
    <span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">2160</span><span class="p">,</span> <span class="c1">// 36 hours</span>
    <span class="s1">&#39;ini&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;session.gc_maxlifetime&#39;</span> <span class="o">=&gt;</span> <span class="mi">129600</span> <span class="c1">// 36 hours</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="built-in-session-handlers-configuration">
<h2>Built-in Session handlers &amp; configuration<a class="headerlink" href="#built-in-session-handlers-configuration" title="Permalink to this headline">¶</a></h2>
<p>CakePHP comes with several built-in session configurations. You can either use
these as the basis for your session configuration, or you can create a fully
custom solution. To use defaults, simply set the &#8216;defaults&#8217; key to the name of
the default you want to use. You can then override any sub setting by declaring
it in your Session config:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;php&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
<p>The above will use the built-in &#8216;php&#8217; session configuration. You could augment
part or all of it by doing the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cookie&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my_app&#39;</span><span class="p">,</span>
    <span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">4320</span> <span class="c1">//3 days</span>
<span class="p">));</span>
</pre></div>
</div>
<p>The above overrides the timeout and cookie name for the &#8216;php&#8217; session
configuration. The built-in configurations are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">php</span></tt> - Saves sessions with the standard settings in your php.ini file.</li>
<li><tt class="docutils literal"><span class="pre">cake</span></tt> - Saves sessions as files inside <tt class="docutils literal"><span class="pre">app/tmp/sessions</span></tt>. This is a
good option when on hosts that don&#8217;t allow you to write outside your own home
dir.</li>
<li><tt class="docutils literal"><span class="pre">database</span></tt> - Use the built-in database sessions. See below for more information.</li>
<li><tt class="docutils literal"><span class="pre">cache</span></tt> - Use the built-in cache sessions. See below for more information.</li>
</ul>
<div class="section" id="session-handlers">
<h3>Session Handlers<a class="headerlink" href="#session-handlers" title="Permalink to this headline">¶</a></h3>
<p>Session handlers can also be defined in the session config array. When defined
they allow you to map the various <tt class="docutils literal"><span class="pre">session_save_handler</span></tt> values to a class or
object you want to use for session saving. There are two ways to use the
&#8216;handler&#8217;. The first is to provide an array with 5 callables. These callables
are then applied to <tt class="docutils literal"><span class="pre">session_set_save_handler</span></tt>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;userAgent&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
    <span class="s1">&#39;cookie&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my_cookie&#39;</span><span class="p">,</span>
    <span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">600</span><span class="p">,</span>
    <span class="s1">&#39;handler&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">),</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">),</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">),</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">),</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">),</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="s1">&#39;gc&#39;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">&#39;ini&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;cookie_secure&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;use_trans_sid&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>The second mode is to define an &#8216;engine&#8217; key. This key should be a class name
that implements <tt class="docutils literal"><span class="pre">CakeSessionHandlerInterface</span></tt>. Implementing this interface
will allow CakeSession to automatically map the methods for the handler. Both
the core Cache and Database session handlers use this method for saving
sessions. Additional settings for the handler should be placed inside the
handler array. You can then read those values out from inside your handler.</p>
<p>You can also use session handlers from inside plugins. By setting the engine to
something like <tt class="docutils literal"><span class="pre">MyPlugin.PluginSessionHandler</span></tt>. This will load and use the
<tt class="docutils literal"><span class="pre">PluginSessionHandler</span></tt> class from inside the MyPlugin of your application.</p>
</div>
<div class="section" id="cakesessionhandlerinterface">
<h3>CakeSessionHandlerInterface<a class="headerlink" href="#cakesessionhandlerinterface" title="Permalink to this headline">¶</a></h3>
<p>This interface is used for all custom session handlers inside CakePHP, and can
be used to create custom user land session handlers. Simply implement the
interface in your class and set <tt class="docutils literal"><span class="pre">Session.handler.engine</span></tt>  to the class name
you&#8217;ve created. CakePHP will attempt to load the handler from inside
<tt class="docutils literal"><span class="pre">app/Model/Datasource/Session/$classname.php</span></tt>. So if your class name is
<tt class="docutils literal"><span class="pre">AppSessionHandler</span></tt> the file should be
<tt class="docutils literal"><span class="pre">app/Model/Datasource/Session/AppSessionHandler.php</span></tt>.</p>
</div>
<div class="section" id="database-sessions">
<h3>Database sessions<a class="headerlink" href="#database-sessions" title="Permalink to this headline">¶</a></h3>
<p>The changes in session configuration change how you define database sessions.
Most of the time you will only need to set <tt class="docutils literal"><span class="pre">Session.handler.model</span></tt> in your
configuration as well as choose the database defaults:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span>
    <span class="s1">&#39;handler&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CustomSession&#39;</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>The above will tell CakeSession to use the built-in &#8216;database&#8217; defaults, and
specify that a model called <tt class="docutils literal"><span class="pre">CustomSession</span></tt> will be the delegate for saving
session information to the database.</p>
<p>If you do not need a fully custom session handler, but still require
database-backed session storage, you can simplify the above code to:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;database&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
<p>This configuration will require a database table to be added with
at least these fields:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="sb">`cake_sessions`</span> <span class="p">(</span>
  <span class="sb">`id`</span> <span class="nx">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="sb">`data`</span> <span class="nx">text</span><span class="p">,</span>
  <span class="sb">`expires`</span> <span class="nx">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nx">PRIMARY</span> <span class="nx">KEY</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>You can also use the schema shell to create this table using the schema file
provided in the default app skeleton:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="err">$</span> <span class="nx">Console</span><span class="o">/</span><span class="nx">cake</span> <span class="nx">schema</span> <span class="nx">create</span> <span class="nx">sessions</span>
</pre></div>
</div>
</div>
<div class="section" id="cache-sessions">
<h3>Cache Sessions<a class="headerlink" href="#cache-sessions" title="Permalink to this headline">¶</a></h3>
<p>The Cache class can be used to store sessions as well. This allows you to store
sessions in a cache like APC, memcache, or Xcache. There are some caveats to
using cache sessions, in that if you exhaust the cache space, sessions will
start to expire as records are evicted.</p>
<p>To use Cache based sessions you can configure you Session config like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cache&#39;</span><span class="p">,</span>
    <span class="s1">&#39;handler&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;config&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;session&#39;</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
<p>This will configure CakeSession to use the <tt class="docutils literal"><span class="pre">CacheSession</span></tt> class as the
delegate for saving the sessions. You can use the &#8216;config&#8217; key which cache
configuration to use. The default cache configuration is <tt class="docutils literal"><span class="pre">'default'</span></tt>.</p>
</div>
</div>
<div class="section" id="setting-ini-directives">
<h2>Setting ini directives<a class="headerlink" href="#setting-ini-directives" title="Permalink to this headline">¶</a></h2>
<p>The built-in defaults attempt to provide a common base for session
configuration. You may need to tweak specific ini flags as well. CakePHP
exposes the ability to customize the ini settings for both default
configurations, as well as custom ones. The <tt class="docutils literal"><span class="pre">ini</span></tt> key in the session settings,
allows you to specify individual configuration values. For example you can use
it to control settings like <tt class="docutils literal"><span class="pre">session.gc_divisor</span></tt>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ini&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;session.gc_divisor&#39;</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s1">&#39;session.cookie_httponly&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-custom-session-handler">
<h2>Creating a custom session handler<a class="headerlink" href="#creating-a-custom-session-handler" title="Permalink to this headline">¶</a></h2>
<p>Creating a custom session handler is straightforward in CakePHP. In this
example we&#8217;ll create a session handler that stores sessions both in the Cache
(apc) and the database. This gives us the best of fast IO of apc,
without having to worry about sessions evaporating when the cache fills up.</p>
<p>First we&#8217;ll need to create our custom class and put it in
<tt class="docutils literal"><span class="pre">app/Model/Datasource/Session/ComboSession.php</span></tt>. The class should look
something like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;DatabaseSession&#39;</span><span class="p">,</span> <span class="s1">&#39;Model/Datasource/Session&#39;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">ComboSession</span> <span class="k">extends</span> <span class="nx">DatabaseSession</span> <span class="k">implements</span> <span class="nx">CakeSessionHandlerInterface</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$cacheKey</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cacheKey</span> <span class="o">=</span> <span class="nx">Configure</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">&#39;Session.handler.cache&#39;</span><span class="p">);</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// read data from the session.</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cacheKey</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// write data into the session.</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Cache</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cacheKey</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// destroy a session.</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Cache</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cacheKey</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">destroy</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// removes expired sessions.</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">gc</span><span class="p">(</span><span class="nv">$expires</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Cache</span><span class="o">::</span><span class="na">gc</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cacheKey</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">gc</span><span class="p">(</span><span class="nv">$expires</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Our class extends the built-in <tt class="docutils literal"><span class="pre">DatabaseSession</span></tt> so we don&#8217;t have to duplicate
all of its logic and behavior. We wrap each operation with a <a class="reference internal" href="../core-libraries/caching.html#Cache" title="Cache"><tt class="xref php php-class docutils literal"><span class="pre">Cache</span></tt></a>
operation. This lets us fetch sessions from the fast cache, and not have to
worry about what happens when we fill the cache. Using this session handler is
also easy. In your <tt class="docutils literal"><span class="pre">core.php</span></tt> make the session block look like the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span>
    <span class="s1">&#39;handler&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;engine&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ComboSession&#39;</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Session&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cache&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;apc&#39;</span>
    <span class="p">)</span>
<span class="p">));</span>

<span class="c1">// Make sure to add a apc cache config</span>
<span class="nx">Cache</span><span class="o">::</span><span class="na">config</span><span class="p">(</span><span class="s1">&#39;apc&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;engine&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Apc&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Now our application will start using our custom session handler for reading &amp;
writing session data.</p>
<dl class="class">
<dt id="CakeSession">
<em class="property">class </em><tt class="descname">CakeSession</tt><a class="headerlink" href="#CakeSession" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="reading-writing-session-data">
<h2>Reading &amp; writing session data<a class="headerlink" href="#reading-writing-session-data" title="Permalink to this headline">¶</a></h2>
<p>Depending on the context you are in, your application has different classes
that provide access to the session. In controllers you can use
<a class="reference internal" href="../core-libraries/components/sessions.html#SessionComponent" title="SessionComponent"><tt class="xref php php-class docutils literal"><span class="pre">SessionComponent</span></tt></a>. In the view, you can use
<a class="reference internal" href="../core-libraries/helpers/session.html#SessionHelper" title="SessionHelper"><tt class="xref php php-class docutils literal"><span class="pre">SessionHelper</span></tt></a>. In any part of your application you can use
<tt class="docutils literal"><span class="pre">CakeSession</span></tt> to access the session as well. Like the other interfaces to the
session, <tt class="docutils literal"><span class="pre">CakeSession</span></tt> provides a simple CRUD interface.</p>
<dl class="staticmethod">
<dt id="CakeSession::read">
<em class="property">static </em><tt class="descclassname">CakeSession::</tt><tt class="descname">read</tt><big>(</big><em>$key</em><big>)</big><a class="headerlink" href="#CakeSession::read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>You can read values from the session using <a class="reference internal" href="../core-utility-libraries/set.html#Set::classicExtract" title="Set::classicExtract"><tt class="xref php php-meth docutils literal"><span class="pre">Set::classicExtract()</span></tt></a>
compatible syntax:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">CakeSession</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">&#39;Config.language&#39;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="staticmethod">
<dt id="CakeSession::write">
<em class="property">static </em><tt class="descclassname">CakeSession::</tt><tt class="descname">write</tt><big>(</big><em>$key</em>, <em>$value</em><big>)</big><a class="headerlink" href="#CakeSession::write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><tt class="docutils literal"><span class="pre">$key</span></tt> should be the dot separated path you wish to write <tt class="docutils literal"><span class="pre">$value</span></tt> to:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">CakeSession</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Config.language&#39;</span><span class="p">,</span> <span class="s1">&#39;eng&#39;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="staticmethod">
<dt id="CakeSession::delete">
<em class="property">static </em><tt class="descclassname">CakeSession::</tt><tt class="descname">delete</tt><big>(</big><em>$key</em><big>)</big><a class="headerlink" href="#CakeSession::delete" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>When you need to delete data from the session, you can use delete:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">CakeSession</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;Config.language&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>You should also see the documentation on
<a class="reference internal" href="../core-libraries/components/sessions.html"><em>Sessions</em></a> and
<a class="reference internal" href="../core-libraries/helpers/session.html"><em>SessionHelper</em></a> for how to access Session data
in the controller and view.</p>
</div>
</div>


		</div>
	</div>

	<div class="sidebar columns three pull-nine">
<div id="sidebar-navigation" class="hide-on-phones">
	<h2 class="hide-on-desktops">Table of Contents</h2>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cakephp-overview.html">CakePHP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries.html">Core Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Console and Shells</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../development.html">Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="routing.html">Routing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Sessions</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest.html">REST</a></li>
<li class="toctree-l2"><a class="reference internal" href="dispatch-filters.html">Dispatcher Filters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

<div class="page-contents">
	<h3>Page contents</h3>
	<ul>
<li><a class="reference internal" href="#">Sessions</a><ul>
<li><a class="reference internal" href="#session-configuration">Session Configuration</a></li>
<li><a class="reference internal" href="#built-in-session-handlers-configuration">Built-in Session handlers &amp; configuration</a><ul>
<li><a class="reference internal" href="#session-handlers">Session Handlers</a></li>
<li><a class="reference internal" href="#cakesessionhandlerinterface">CakeSessionHandlerInterface</a></li>
<li><a class="reference internal" href="#database-sessions">Database sessions</a></li>
<li><a class="reference internal" href="#cache-sessions">Cache Sessions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-ini-directives">Setting ini directives</a></li>
<li><a class="reference internal" href="#creating-a-custom-session-handler">Creating a custom session handler</a></li>
<li><a class="reference internal" href="#reading-writing-session-data">Reading &amp; writing session data</a></li>
</ul>
</li>
</ul>

</div>
	</div>

</div>

<div class="content row">
	<ul class="related-pages inline">
	<li>
		<a href="../genindex.html" title="General Index" accesskey="I">index</a>
	</li>
	<li>
		<a href="exceptions.html" title="Exceptions" accesskey="N">next</a>
	</li>
	<li>
		<a href="routing.html" title="Routing" accesskey="P">previous</a>
	</li>
	</ul>
</div>

	<div class="footer-push"> </div>
</div>






<div class="footer">
	<div class="row">
		<div class="columns six offset-by-three contribute">
			<strong>发现翻译错误?</strong>
			请在下面留言<br />
			<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">[ 我要加入翻译 ]</a>
		</div>
	</div>
	
	<div class="row">
		<div class="columns nine offset-by-three copyright">
					&copy; Copyright 2014, Cake Software Foundation, Inc.
				Last updated on Jul 10, 2016.
				Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
		</div>
	</div>
</div>

<div id="nav-modal" class="reveal-modal"> </div>
<div id="inline-search-results"></div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->

<!-- Grunt Live Reload -->
<script src="http://192.168.56.113:35729/livereload.js"></script>
  </body>
</html>