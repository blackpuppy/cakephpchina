
<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Error Handling" lang="en" name="title" />
<meta content="stack traces,error constants,error array,default displays,anonymous functions,error handlers,default error,error level,exception handler,php error,error handler,write error,core classes,exception handling,configuration error,application code,callback,custom error,exceptions,bitmasks,fatal error" lang="en" name="keywords" />

    <title>Error Handling &mdash; CakePHP Cookbook 2.x documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/app.js"></script>
    <script type="text/javascript" src="../_static/modernizr.foundation.js"></script>
    <script type="text/javascript" src="../_static/foundation.js"></script>
    <link rel="top" title="CakePHP Cookbook 2.x documentation" href="../index.html" />
    <link rel="up" title="Development" href="../development.html" />
    <link rel="next" title="Debugging" href="debugging.html" />
    <link rel="prev" title="Exceptions" href="exceptions.html" />
<link href="../_static/favicon.ico" type="image/x-icon" rel="icon" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="alternate" hreflang="pt" href="../../pt/development/errors.html" /><link rel="alternate" hreflang="es" href="../../es/development/errors.html" /><link rel="alternate" hreflang="ja" href="../../ja/development/errors.html" /><link rel="alternate" hreflang="fr" href="../../fr/development/errors.html" /><link rel="alternate" hreflang="zh_CN" href="../../zh/development/errors.html" />

<link rel="search" type="application/opensearchdescription+xml" title="CakePHP Book 2.x Search" href="../_static/opensearchdescription-book-2-x.xml">
<script type="text/javascript">
window.lang = "en";
</script>

  </head>
  <body>

<div id="container">

<div id="cakephp-global-navigation">
	<ul>
		<li class="main"><a href="http://cakephp.org">CakePHP</a></li>
		<li class="primary"><a href="#" class="empty">Downloads</a>
			<ul class="second-level">
				<li><a href="https://github.com/cakephp/cakephp/tags">Releases</a></li>
				<li><a href="http://pear.cakephp.org">Pear channel</a></li>
			</ul>
		</li>
		<li class="primary"><a href="#" class="empty">Documentation</a>
			<ul class="second-level">
				<li><a href="http://api.cakephp.org">API</a></li>
				<li><a href="http://book.cakephp.org">Book</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://community.cakephp.org">Community</a>
			<ul class="second-level">
				<li><a href="http://webchat.freenode.net/?channels=cakephp&uio=MT1mYWxzZSY5PXRydWUmMTE9MjQ2b8">Help &amp; Support</a></li>
				<li><a href="https://github.com/cakephp/cakephp/issues">Issues</a></li>
				<li><a href="http://bakery.cakephp.org">The Bakery</a></li>
				<li><a href="http://stackoverflow.com/tags/cakephp">Stack Overflow</a></li>
				<li><a href="http://www.facebook.com/groups/cake.community">Facebook Group</a></li>
				<li><a href="http://goo.gl/mSC0s">Google+ Community</a></li>
				<li><a href="http://www.youtube.com/user/CakePHP">YouTube Channel</a></li>
				<li><a href="http://podcast.cakephp.org">CakePHP Podcast</a></li>
				<li><a href="http://twitter.com/CakePHP">Follow us on Twitter</a></li>
				<li><a href="http://groups.google.com/group/cake-php">Google Group</a></li>
				<li><a href="http://github.com/cakephp/cakephp/contributors">Contributors</a></li>
				<li><a href="http://plugins.cakephp.org">Plugins &amp; Packages</a></li>
				<li><a href="http://community.cakephp.org/get-involved">Get Involved</a></li>
				<li><a href="http://community.cakephp.org/guidelines">Guidelines</a></li>
				<li><a href="http://cakefest.org">CakeFest</a></li>
				<li><a href="http://cakephp.org/logos">Logo</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://cakephp.org/services">Services</a>
			<ul class="second-level">
				<li><a href="http://cakephp.org/services/certification">Certification</a></li>
				<li><a href="http://cakephp.org/services/consultation">Consultation</a></li>
				<li><a href="http://cakephp.org/services/support">Support</a></li>
				<li><a href="http://training.cakephp.org">Training</a></li>
			</ul>
		</li>
	</ul>
</div>

<div class="masthead">
	<div class="header-backing"></div>
	<div class="searchbar row">
		<div class="columns three phone-one">
			<a class="logo" href="../contents.html">
			<img src="../_static/cake-logo.png" alt="CakePHP" width="70" />
			</a>
		</div>
		
<div id="searchbox" class="columns nine phone-three">

	<form id="searchform" class="search" action="../search.html" method="get">
		<input class="search-input" autocomplete="off" type="search" name="q" size="18" />
		<input class="search-submit search-big button red" type="submit" value="Search" />
		<input type="hidden" name="check_keywords" value="yes" />
		<input type="hidden" name="area" value="default" />

		<a href="#" id="tablet-nav" class="show-on-phones pale button small">Nav</a>
	</form>

</div>
	</div>
</div>
<div class="breadcrumb-header">
	<div class="related row">
		<div class="columns three root-link">
			<a href="../contents.html">Cookbook 2.x</a>
		</div>
		<div class="columns nine">
			<ul class="inline breadcrumb">
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../development.html" accesskey="U" itemprop="url"><span itemprop="title">Development</span></a>
			</li>
			</ul>
			<div class="versions dropdown">
				<a href="#">2.x Book</a>
				<ul>
					<li><a href="http://book.cakephp.org/3.0/en">3.0 Book</a></li>
					<li><a href="http://book.cakephp.org/1.3/en/">1.3 Book</a></li>
					<li><a href="http://book.cakephp.org/1.2/en/">1.2 Book</a></li>
					<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
				</ul>
			</div>

			<div class="languages dropdown">
				<a href="#">en</a>

				<ul>
				
					<li></li>
				
					<li><a href="../../pt/development/errors.html">pt</a></li>
				
					<li><a href="../../es/development/errors.html">es</a></li>
				
					<li><a href="../../ja/development/errors.html">ja</a></li>
				
					<li><a href="../../fr/development/errors.html">fr</a></li>
				
					<li><a href="../../zh/development/errors.html">zh_CN</a></li>
				
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="content row">
	<div class="document columns nine push-three">
		<div class="body"><a class="button pale improve" href="https://github.com/cakephp/docs/edit/master/en/development/errors.rst" target="_blank">Improve this Doc</a>
  <div class="section" id="error-handling">
<h1>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h1>
<p>For 2.0 <tt class="docutils literal"><span class="pre">Object::cakeError()</span></tt> has been removed. Instead it has been replaced with
a number of exceptions. All of the core classes that previously called cakeError
are now throwing exceptions. This lets you either choose to handle the errors
in your application code, or let the built-in exception handling deal with them.</p>
<p>There is more control than ever for error and exception handling in CakePHP 2.0.
You can configure which methods you want to set as the default error handler,
and exception handler using configure.</p>
<div class="section" id="error-configuration">
<h2>Error configuration<a class="headerlink" href="#error-configuration" title="Permalink to this headline">¶</a></h2>
<p>Error configuration is done inside your application&#8217;s <tt class="docutils literal"><span class="pre">app/Config/core.php</span></tt>
file. You can define a callback to be fired each time your application triggers
any PHP error - exceptions are handled <a class="reference internal" href="exceptions.html"><em>Exceptions</em></a> separately.
The callback can be any PHP callable, including an anonymous function. The
default error handling configuration looks like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;handler&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ErrorHandler::handleError&#39;</span><span class="p">,</span>
    <span class="s1">&#39;level&#39;</span> <span class="o">=&gt;</span> <span class="k">E_ALL</span> <span class="o">&amp;</span> <span class="o">~</span><span class="nx">E_DEPRECATED</span><span class="p">,</span>
    <span class="s1">&#39;trace&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
<span class="p">));</span>
</pre></div>
</div>
<p>You have 5 built-in options when configuring error handlers:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">handler</span></tt> - callback - The callback to handle errors. You can set this to any
callable type, including anonymous functions.</li>
<li><tt class="docutils literal"><span class="pre">level</span></tt> - int - The level of errors you are interested in capturing. Use the
built-in PHP error constants, and bitmasks to select the level of error you
are interested in.</li>
<li><tt class="docutils literal"><span class="pre">trace</span></tt> - boolean - Include stack traces for errors in log files. Stack traces
will be included in the log after each error. This is helpful for finding
where/when errors are being raised.</li>
<li><tt class="docutils literal"><span class="pre">consoleHandler</span></tt> - callback - The callback used to handle errors when
running in the console. If undefined, CakePHP&#8217;s default handlers will be
used.</li>
</ul>
<p>ErrorHandler by default, displays errors when <tt class="docutils literal"><span class="pre">debug</span></tt> &gt; 0, and logs errors when
debug = 0. The type of errors captured in both cases is controlled by <tt class="docutils literal"><span class="pre">Error.level</span></tt>.
The fatal error handler will be called independent of <tt class="docutils literal"><span class="pre">debug</span></tt> level or <tt class="docutils literal"><span class="pre">Error.level</span></tt>
configuration, but the result will be different based on <tt class="docutils literal"><span class="pre">debug</span></tt> level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you use a custom error handler, the trace setting will have no effect,
unless you refer to it in your error handling function.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.2: </span>The <tt class="docutils literal"><span class="pre">Error.consoleHandler</span></tt> option was added in 2.2.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Changed in version 2.2: </span>The <tt class="docutils literal"><span class="pre">Error.handler</span></tt> and <tt class="docutils literal"><span class="pre">Error.consoleHandler</span></tt> will receive the fatal error
codes as well. The default behavior is show a page to internal server error
(<tt class="docutils literal"><span class="pre">debug</span></tt> disabled) or a page with the message, file and line (<tt class="docutils literal"><span class="pre">debug</span></tt> enabled).</p>
</div>
</div>
<div class="section" id="creating-your-own-error-handler">
<h2>Creating your own error handler<a class="headerlink" href="#creating-your-own-error-handler" title="Permalink to this headline">¶</a></h2>
<p>You can create an error handler out of any callback type. For example you could
use a class called <tt class="docutils literal"><span class="pre">AppError</span></tt> to handle your errors. The following would
need to be done:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">//in app/Config/core.php</span>
<span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Error.handler&#39;</span><span class="p">,</span> <span class="s1">&#39;AppError::handleError&#39;</span><span class="p">);</span>

<span class="c1">//in app/Config/bootstrap.php</span>
<span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;AppError&#39;</span><span class="p">,</span> <span class="s1">&#39;Lib&#39;</span><span class="p">);</span>

<span class="c1">//in app/Lib/AppError.php</span>
<span class="k">class</span> <span class="nc">AppError</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">handleError</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$description</span><span class="p">,</span> <span class="nv">$file</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="nv">$line</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$context</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">&#39;There has been an error!&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This class/method will print out &#8216;There has been an error!&#8217; each time an error
occurs. Since you can define an error handler as any callback type, you could
use an anonymous function if you are using PHP5.3 or greater.</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Error.handler&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$description</span><span class="p">,</span> <span class="nv">$file</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$context</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;Oh no something bad happened&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>It is important to remember that errors captured by the configured error handler will be php
errors, and that if you need custom error handling, you probably also want to configure
<a class="reference internal" href="exceptions.html"><em>Exceptions</em></a> handling as well.</p>
</div>
<div class="section" id="changing-fatal-error-behavior">
<h2>Changing fatal error behavior<a class="headerlink" href="#changing-fatal-error-behavior" title="Permalink to this headline">¶</a></h2>
<p>Since CakePHP 2.2 the <tt class="docutils literal"><span class="pre">Error.handler</span></tt> will receive the fatal error codes as well.
If you do not want to show the cake error page, you can override it like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">//in app/Config/core.php</span>
<span class="nx">Configure</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Error.handler&#39;</span><span class="p">,</span> <span class="s1">&#39;AppError::handleError&#39;</span><span class="p">);</span>

<span class="c1">//in app/Config/bootstrap.php</span>
<span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;AppError&#39;</span><span class="p">,</span> <span class="s1">&#39;Lib&#39;</span><span class="p">);</span>

<span class="c1">//in app/Lib/AppError.php</span>
<span class="k">class</span> <span class="nc">AppError</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">handleError</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$description</span><span class="p">,</span> <span class="nv">$file</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="nv">$line</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$context</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">list</span><span class="p">(,</span> <span class="nv">$level</span><span class="p">)</span> <span class="o">=</span> <span class="nx">ErrorHandler</span><span class="o">::</span><span class="na">mapErrorCode</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$level</span> <span class="o">===</span> <span class="nx">LOG_ERROR</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Ignore fatal error. It will keep the PHP error message only</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ErrorHandler</span><span class="o">::</span><span class="na">handleError</span><span class="p">(</span>
            <span class="nv">$code</span><span class="p">,</span>
            <span class="nv">$description</span><span class="p">,</span>
            <span class="nv">$file</span><span class="p">,</span>
            <span class="nv">$line</span><span class="p">,</span>
            <span class="nv">$context</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to keep the default fatal error behavior, you can call <tt class="docutils literal"><span class="pre">ErrorHandler::handleFatalError()</span></tt>
from your custom handler.</p>
</div>
</div>


		</div>
	</div>

	<div class="sidebar columns three pull-nine">
<div id="sidebar-navigation" class="hide-on-phones">
	<h2 class="hide-on-desktops">Table of Contents</h2>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cakephp-overview.html">CakePHP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries.html">Core Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Console and Shells</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../development.html">Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="routing.html">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="sessions.html">Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="exceptions.html">Exceptions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Error Handling</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest.html">REST</a></li>
<li class="toctree-l2"><a class="reference internal" href="dispatch-filters.html">Dispatcher Filters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

<div class="page-contents">
	<h3>Page contents</h3>
	<ul>
<li><a class="reference internal" href="#">Error Handling</a><ul>
<li><a class="reference internal" href="#error-configuration">Error configuration</a></li>
<li><a class="reference internal" href="#creating-your-own-error-handler">Creating your own error handler</a></li>
<li><a class="reference internal" href="#changing-fatal-error-behavior">Changing fatal error behavior</a></li>
</ul>
</li>
</ul>

</div>
	</div>

</div>

<div class="content row">
	<ul class="related-pages inline">
	<li>
		<a href="../genindex.html" title="General Index" accesskey="I">index</a>
	</li>
	<li>
		<a href="debugging.html" title="Debugging" accesskey="N">next</a>
	</li>
	<li>
		<a href="exceptions.html" title="Exceptions" accesskey="P">previous</a>
	</li>
	</ul>
</div>

	<div class="footer-push"> </div>
</div>






<div class="footer">
	<div class="row">
		<div class="columns six offset-by-three contribute">
			<strong>发现翻译错误?</strong>
			请在下面留言<br />
			<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">[ 我要加入翻译 ]</a>
		</div>
	</div>
	
	<div class="row">
		<div class="columns nine offset-by-three copyright">
					&copy; Copyright 2014, Cake Software Foundation, Inc.
				Last updated on Sep 04, 2015.
				Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
		</div>
	</div>
</div>

<div id="nav-modal" class="reveal-modal"> </div>
<div id="inline-search-results"></div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->

<!-- Grunt Live Reload -->
<script src="http://192.168.56.113:35729/livereload.js"></script>
  </body>
</html>