
<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="HttpSocket" lang="en" name="title" />
<meta content="array name,array data,query parameter,query string,php class,string query,test type,string data,google,query results,webservices,apis,parameters,cakephp,meth,search results" lang="en" name="keywords" />

    <title>HttpSocket &mdash; CakePHP Cookbook 2.x documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/app.js"></script>
    <script type="text/javascript" src="../_static/modernizr.foundation.js"></script>
    <script type="text/javascript" src="../_static/foundation.js"></script>
    <link rel="top" title="CakePHP Cookbook 2.x documentation" href="../index.html" />
    <link rel="up" title="Utilities" href="../core-libraries/toc-utilities.html" />
    <link rel="next" title="Inflector" href="inflector.html" />
    <link rel="prev" title="Hash" href="hash.html" />
<link href="../_static/favicon.ico" type="image/x-icon" rel="icon" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="alternate" hreflang="pt" href="../../pt/core-utility-libraries/httpsocket.html" /><link rel="alternate" hreflang="es" href="../../es/core-utility-libraries/httpsocket.html" /><link rel="alternate" hreflang="ja" href="../../ja/core-utility-libraries/httpsocket.html" /><link rel="alternate" hreflang="fr" href="../../fr/core-utility-libraries/httpsocket.html" /><link rel="alternate" hreflang="zh_CN" href="../../zh/core-utility-libraries/httpsocket.html" />

<link rel="search" type="application/opensearchdescription+xml" title="CakePHP Book 2.x Search" href="../_static/opensearchdescription-book-2-x.xml">
<script type="text/javascript">
window.lang = "en";
</script>

  </head>
  <body>

<div id="container">

<div id="cakephp-global-navigation">
	<ul>
		<li class="main"><a href="http://cakephp.org">CakePHP</a></li>
		<li class="primary"><a href="#" class="empty">Downloads</a>
			<ul class="second-level">
				<li><a href="https://github.com/cakephp/cakephp/tags">Releases</a></li>
				<li><a href="http://pear.cakephp.org">Pear channel</a></li>
			</ul>
		</li>
		<li class="primary"><a href="#" class="empty">Documentation</a>
			<ul class="second-level">
				<li><a href="http://api.cakephp.org">API</a></li>
				<li><a href="http://book.cakephp.org">Book</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://community.cakephp.org">Community</a>
			<ul class="second-level">
				<li><a href="http://webchat.freenode.net/?channels=cakephp&uio=MT1mYWxzZSY5PXRydWUmMTE9MjQ2b8">Help &amp; Support</a></li>
				<li><a href="https://github.com/cakephp/cakephp/issues">Issues</a></li>
				<li><a href="http://bakery.cakephp.org">The Bakery</a></li>
				<li><a href="http://stackoverflow.com/tags/cakephp">Stack Overflow</a></li>
				<li><a href="http://www.facebook.com/groups/cake.community">Facebook Group</a></li>
				<li><a href="http://goo.gl/mSC0s">Google+ Community</a></li>
				<li><a href="http://www.youtube.com/user/CakePHP">YouTube Channel</a></li>
				<li><a href="http://podcast.cakephp.org">CakePHP Podcast</a></li>
				<li><a href="http://twitter.com/CakePHP">Follow us on Twitter</a></li>
				<li><a href="http://groups.google.com/group/cake-php">Google Group</a></li>
				<li><a href="http://github.com/cakephp/cakephp/contributors">Contributors</a></li>
				<li><a href="http://plugins.cakephp.org">Plugins &amp; Packages</a></li>
				<li><a href="http://community.cakephp.org/get-involved">Get Involved</a></li>
				<li><a href="http://community.cakephp.org/guidelines">Guidelines</a></li>
				<li><a href="http://cakefest.org">CakeFest</a></li>
				<li><a href="http://cakephp.org/logos">Logo</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://cakephp.org/services">Services</a>
			<ul class="second-level">
				<li><a href="http://certification.cakephp.org">Certification</a></li>
				<li><a href="http://cakephp.org/services/consultation">Consultation</a></li>
				<li><a href="http://cakephp.org/services/support">Support</a></li>
				<li><a href="http://training.cakephp.org">Training</a></li>
			</ul>
		</li>
	</ul>
</div>

<div class="masthead">
	<div class="header-backing"></div>
	<div class="searchbar row">
		<div class="columns three phone-one">
			<a class="logo" href="../contents.html">
			<img src="../_static/cake-logo.png" alt="CakePHP" width="70" />
			</a>
		</div>
		
<div id="searchbox" class="columns nine phone-three">

	<form id="searchform" class="search" action="../search.html" method="get">
		<input class="search-input" autocomplete="off" type="search" name="q" size="18" />
		<input class="search-submit search-big button red" type="submit" value="Search" />
		<input type="hidden" name="check_keywords" value="yes" />
		<input type="hidden" name="area" value="default" />

		<a href="#" id="tablet-nav" class="show-on-phones pale button small">Nav</a>
	</form>

</div>
	</div>
</div>
<div class="breadcrumb-header">
	<div class="related row">
		<div class="columns three root-link">
			<a href="../contents.html">Cookbook 2.x</a>
		</div>
		<div class="columns nine">
			<ul class="inline breadcrumb">
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../core-libraries.html"  itemprop="url"><span itemprop="title">Core Libraries</span></a>
			</li>
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../core-libraries/toc-utilities.html" accesskey="U" itemprop="url"><span itemprop="title">Utilities</span></a>
			</li>
			</ul>
			<div class="versions dropdown">
				<a href="#">2.x Book</a>
				<ul>
					<li><a href="http://book.cakephp.org/3.0/en">3.0 Book</a></li>
					<li><a href="http://book.cakephp.org/1.3/en/">1.3 Book</a></li>
					<li><a href="http://book.cakephp.org/1.2/en/">1.2 Book</a></li>
					<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
				</ul>
			</div>

			<div class="languages dropdown">
				<a href="#">en</a>

				<ul>
				
					<li></li>
				
					<li><a href="../../pt/core-utility-libraries/httpsocket.html">pt</a></li>
				
					<li><a href="../../es/core-utility-libraries/httpsocket.html">es</a></li>
				
					<li><a href="../../ja/core-utility-libraries/httpsocket.html">ja</a></li>
				
					<li><a href="../../fr/core-utility-libraries/httpsocket.html">fr</a></li>
				
					<li><a href="../../zh/core-utility-libraries/httpsocket.html">zh_CN</a></li>
				
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="content row">
	<div class="document columns nine push-three">
		<div class="body"><a class="button pale improve" href="https://github.com/cakephp/docs/edit/master/en/core-utility-libraries/httpsocket.rst" target="_blank">Improve this Doc</a>
  <div class="section" id="httpsocket">
<h1>HttpSocket<a class="headerlink" href="#httpsocket" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="HttpSocket">
<em class="property">class </em><tt class="descname">HttpSocket</tt><big>(</big><em>mixed $config = array()</em><big>)</big><a class="headerlink" href="#HttpSocket" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>CakePHP includes an HttpSocket class which can be used easily for
making requests. It is a great way to communicate with external webservices, or
remote apis.</p>
<div class="section" id="making-a-request">
<h2>Making a request<a class="headerlink" href="#making-a-request" title="Permalink to this headline">¶</a></h2>
<p>You can use HttpSocket to create most kinds of HTTP requests with the different
HTTP methods.</p>
<dl class="method">
<dt id="HttpSocket::get">
<tt class="descclassname">HttpSocket::</tt><tt class="descname">get</tt><big>(</big><em>$uri</em>, <em>$query</em>, <em>$request</em><big>)</big><a class="headerlink" href="#HttpSocket::get" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">$query</span></tt> parameter, can either be a query string, or an array of keys
and values. The get method makes a simple HTTP GET request returning the
results:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;HttpSocket&#39;</span><span class="p">,</span> <span class="s1">&#39;Network/Http&#39;</span><span class="p">);</span>

<span class="nv">$HttpSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpSocket</span><span class="p">();</span>

<span class="c1">// string query</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$HttpSocket</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;http://www.google.com/search&#39;</span><span class="p">,</span> <span class="s1">&#39;q=cakephp&#39;</span><span class="p">);</span>

<span class="c1">// array query</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$HttpSocket</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;http://www.google.com/search&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;q&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cakephp&#39;</span><span class="p">));</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HttpSocket::post">
<tt class="descclassname">HttpSocket::</tt><tt class="descname">post</tt><big>(</big><em>$uri</em>, <em>$data</em>, <em>$request</em><big>)</big><a class="headerlink" href="#HttpSocket::post" title="Permalink to this definition">¶</a></dt>
<dd><p>The post method makes a simple HTTP POST request returning the
results.</p>
<p>The parameters for the <tt class="docutils literal"><span class="pre">post</span></tt> method are almost the same as the
get method, <tt class="docutils literal"><span class="pre">$uri</span></tt> is the web address where the request is being
made; <tt class="docutils literal"><span class="pre">$query</span></tt> is the data to be posted, either as a string, or as
an array of keys and values:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;HttpSocket&#39;</span><span class="p">,</span> <span class="s1">&#39;Network/Http&#39;</span><span class="p">);</span>

<span class="nv">$HttpSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpSocket</span><span class="p">();</span>

<span class="c1">// string data</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$HttpSocket</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span>
    <span class="s1">&#39;http://example.com/add&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name=test&amp;type=user&#39;</span>
<span class="p">);</span>

<span class="c1">// array data</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user&#39;</span><span class="p">);</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$HttpSocket</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://example.com/add&#39;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HttpSocket::put">
<tt class="descclassname">HttpSocket::</tt><tt class="descname">put</tt><big>(</big><em>$uri</em>, <em>$data</em>, <em>$request</em><big>)</big><a class="headerlink" href="#HttpSocket::put" title="Permalink to this definition">¶</a></dt>
<dd><p>The put method makes a simple HTTP PUT request returning the
results.</p>
<p>The parameters for the <tt class="docutils literal"><span class="pre">put</span></tt> method is the same as the
<a class="reference internal" href="#HttpSocket::post" title="HttpSocket::post"><tt class="xref php php-meth docutils literal"><span class="pre">post()</span></tt></a> method.</p>
</dd></dl>

<dl class="method">
<dt id="HttpSocket::delete">
<tt class="descclassname">HttpSocket::</tt><tt class="descname">delete</tt><big>(</big><em>$uri</em>, <em>$query</em>, <em>$request</em><big>)</big><a class="headerlink" href="#HttpSocket::delete" title="Permalink to this definition">¶</a></dt>
<dd><p>The delete method makes a simple HTTP DELETE request returning the
results.</p>
<p>The parameters for the <tt class="docutils literal"><span class="pre">delete</span></tt> method is the same as the
<a class="reference internal" href="#HttpSocket::get" title="HttpSocket::get"><tt class="xref php php-meth docutils literal"><span class="pre">get()</span></tt></a> method. The <tt class="docutils literal"><span class="pre">$query</span></tt> parameter can either be a string or an array
of query string arguments for the request.</p>
</dd></dl>

<dl class="method">
<dt id="HttpSocket::patch">
<tt class="descclassname">HttpSocket::</tt><tt class="descname">patch</tt><big>(</big><em>$uri</em>, <em>$data</em>, <em>$request</em><big>)</big><a class="headerlink" href="#HttpSocket::patch" title="Permalink to this definition">¶</a></dt>
<dd><p>The patch method makes a simple HTTP PATCH request returning the
results.</p>
<p>The parameters for the <tt class="docutils literal"><span class="pre">patch</span></tt> method is the same as the
<a class="reference internal" href="#HttpSocket::post" title="HttpSocket::post"><tt class="xref php php-meth docutils literal"><span class="pre">post()</span></tt></a> method.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.4.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="HttpSocket::request">
<tt class="descclassname">HttpSocket::</tt><tt class="descname">request</tt><big>(</big><em>$request</em><big>)</big><a class="headerlink" href="#HttpSocket::request" title="Permalink to this definition">¶</a></dt>
<dd><p>The base request method, which is called from all the wrappers
(get, post, put, delete). Returns the results of the request.</p>
<p>$request is a keyed array of various options. Here is the format
and default settings:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nv">$request</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;method&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
    <span class="s1">&#39;uri&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;scheme&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="mi">80</span><span class="p">,</span>
        <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="s1">&#39;pass&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="s1">&#39;query&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="s1">&#39;fragment&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span>
    <span class="p">),</span>
    <span class="s1">&#39;auth&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;method&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Basic&#39;</span><span class="p">,</span>
        <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="s1">&#39;pass&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span>
    <span class="p">),</span>
    <span class="s1">&#39;version&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;line&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
    <span class="s1">&#39;header&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;Connection&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span>
        <span class="s1">&#39;User-Agent&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CakePHP&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;raw&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
    <span class="s1">&#39;redirect&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
    <span class="s1">&#39;cookies&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="handling-the-response">
<h2>Handling the response<a class="headerlink" href="#handling-the-response" title="Permalink to this headline">¶</a></h2>
<p>Responses from requests made with <tt class="docutils literal"><span class="pre">HttpSocket</span></tt> are instances of
<tt class="docutils literal"><span class="pre">HttpResponse</span></tt>. This object gives you a few accessor methods to access the
contents of an HTTP response. This class implements the
<a class="reference external" href="http://php.net/manual/en/class.arrayaccess.php">ArrayAccess</a> and
<a class="reference external" href="http://www.php.net/manual/en/language.oop5.magic.php#language.oop5.magic.tostring">__toString()</a>,
so you can continue using the <tt class="docutils literal"><span class="pre">$http-&gt;response</span></tt> as array and the return of
request methods as string:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;HttpSocket&#39;</span><span class="p">,</span> <span class="s1">&#39;Network/Http&#39;</span><span class="p">);</span>

<span class="nv">$http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpSocket</span><span class="p">();</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$http</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;http://www.cakephp.org&#39;</span><span class="p">);</span>

<span class="c1">// Check the body for the presence of a title tag.</span>
<span class="nv">$titlePos</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">,</span> <span class="s1">&#39;&lt;title&gt;&#39;</span><span class="p">);</span>

<span class="c1">// Get the status code for the response.</span>
<span class="nv">$code</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">HttpResponse</span></tt> has the following attributes:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">body</span></tt> returns body of HTTP response (normally the HTML).</li>
<li><tt class="docutils literal"><span class="pre">headers</span></tt> returns array with headers.</li>
<li><tt class="docutils literal"><span class="pre">cookies</span></tt> returns array with new cookies (cookies from others request are not stored here).</li>
<li><tt class="docutils literal"><span class="pre">httpVersion</span></tt> returns string with HTTP version (from first line in response).</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt> returns the integer with HTTP code.</li>
<li><tt class="docutils literal"><span class="pre">reasonPhrase</span></tt> returns the string with HTTP code response.</li>
<li><tt class="docutils literal"><span class="pre">raw</span></tt> returns the unchanged response from server.</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">HttpResponse</span></tt> also exposes the following methods:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">body()</span></tt> returns the body</li>
<li><tt class="docutils literal"><span class="pre">isOk()</span></tt> returns if code is 200;</li>
<li><tt class="docutils literal"><span class="pre">isRedirect()</span></tt> returns if code is 301, 302, 303 or 307 and the <em>Location</em> header is set.</li>
<li><tt class="docutils literal"><span class="pre">getHeader()</span></tt> allows you to fetch headers, see the next section.</li>
</ul>
<div class="section" id="getting-headers-from-a-response">
<h3>Getting headers from a response<a class="headerlink" href="#getting-headers-from-a-response" title="Permalink to this headline">¶</a></h3>
<p>Following others places in core, the HttpSocket does not change the casing of
headers. <span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2616.html"><strong>RFC 2616</strong></a> states that headers are case insensitive, and HttpSocket
preserves the values the remote host sends:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="nx">OK</span>
<span class="nx">Date</span><span class="o">:</span> <span class="nx">Mon</span><span class="p">,</span> <span class="mi">16</span> <span class="nx">Apr</span> <span class="mi">2007</span> <span class="mo">04</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span><span class="mi">16</span> <span class="nx">GMT</span>
<span class="nx">server</span><span class="o">:</span> <span class="nx">CakeHttp</span> <span class="nx">Server</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">tyPe</span><span class="o">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span>
</pre></div>
</div>
<p>Your <tt class="docutils literal"><span class="pre">$response-&gt;headers</span></tt> (or <tt class="docutils literal"><span class="pre">$response['header']</span></tt>) will contain the exact
keys sent. In order to safely access the header fields, it&#8217;s best to use
<tt class="docutils literal"><span class="pre">getHeader()</span></tt>. If your headers looks like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">Date</span><span class="o">:</span> <span class="nx">Mon</span><span class="p">,</span> <span class="mi">16</span> <span class="nx">Apr</span> <span class="mi">2007</span> <span class="mo">04</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span><span class="mi">16</span> <span class="nx">GMT</span>
<span class="nx">server</span><span class="o">:</span> <span class="nx">CakeHttp</span> <span class="nx">Server</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">tyPe</span><span class="o">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span>
</pre></div>
</div>
<p>You could fetch the above headers by calling:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// $response is an instance of HttpResponse</span>
<span class="c1">// get the Content-Type header.</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">);</span>

<span class="c1">// get the date</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeader</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Headers can be fetched case-insensitively.</p>
</div>
<div class="section" id="automatically-handling-a-redirect-response">
<h3>Automatically handling a redirect response<a class="headerlink" href="#automatically-handling-a-redirect-response" title="Permalink to this headline">¶</a></h3>
<p>When the response has a valid redirect status code (see <tt class="docutils literal"><span class="pre">HttpResponse::isRedirect</span></tt>),
an extra request can be automatically done according to the received <em>Location</em> header:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;HttpSocket&#39;</span><span class="p">,</span> <span class="s1">&#39;Network/Http&#39;</span><span class="p">);</span>

<span class="nv">$HttpSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpSocket</span><span class="p">();</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$HttpSocket</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;http://example.com/redirecting_url&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;redirect&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">));</span>
</pre></div>
</div>
<p>The <em>redirect</em> option can take the following values</p>
<ul class="simple">
<li><strong>true</strong> : all redirecting responses will fire a consequent new request</li>
<li><strong>integer</strong> : the set value is the maximum number of redirections allowed (after reaching it, the <em>redirect</em> value is considered as <strong>false</strong>)</li>
<li><strong>false</strong> (default) : no consequent request will be fired</li>
</ul>
<p>The returned <tt class="docutils literal"><span class="pre">$response</span></tt> will be the final one, according to the settings.</p>
</div>
<div class="section" id="handling-ssl-certificates">
<span id="http-socket-ssl-options"></span><h3>Handling SSL certificates<a class="headerlink" href="#handling-ssl-certificates" title="Permalink to this headline">¶</a></h3>
<p>When making requests to SSL services HttpSocket will attempt to validate the SSL
certifcate using peer validation. If the certificate fails peer validation or
does not match the hostname being accessed the connection will fail, and an
exception will be thrown. By default HttpSocket will use the mozilla certificate
authority file to verify SSL certificates. You can use the following options to
configure how SSL certificates are handled:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ssl_verify_peer</span></tt> Set to false to disable SSL verification. This is
<strong>not recommended</strong>.</li>
<li><tt class="docutils literal"><span class="pre">ssl_verify_host</span></tt> Set to false if you wish to ignore hostname match errors
when validating certificates.</li>
<li><tt class="docutils literal"><span class="pre">ssl_allow_self_signed</span></tt> Set to true to enable self-signed certificates to be
accepted. This requires <tt class="docutils literal"><span class="pre">ssl_verify_peer</span></tt> to be enabled.</li>
<li><tt class="docutils literal"><span class="pre">ssl_cafile</span></tt> Set to the absolute path of the Certificate Authority file that
you wish to use for verifying SSL certificates.</li>
</ul>
<p>These options are provided as constructor arguments:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpSocket</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;ssl_allow_self_signed&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
<span class="p">));</span>
</pre></div>
</div>
<p>Would allow self-signed certificates for all requests made with the created
socket.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3: </span>SSL certificate validation was added in 2.3.</p>
</div>
</div>
<div class="section" id="creating-a-custom-response-class">
<h3>Creating a custom response class<a class="headerlink" href="#creating-a-custom-response-class" title="Permalink to this headline">¶</a></h3>
<p>You can create your own response class to use with HttpSocket. You could create
the file <tt class="docutils literal"><span class="pre">app/Lib/Network/Http/YourResponse.php</span></tt> with the content:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;HttpResponse&#39;</span><span class="p">,</span> <span class="s1">&#39;Network/Http&#39;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">YourResponse</span> <span class="k">extends</span> <span class="nx">HttpResponse</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">parseResponse</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">parseResponse</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
        <span class="c1">// Make what you want</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Before your request you&#8217;ll need to change the responseClass property:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;HttpSocket&#39;</span><span class="p">,</span> <span class="s1">&#39;Network/Http&#39;</span><span class="p">);</span>

<span class="nv">$http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpSocket</span><span class="p">();</span>
<span class="nv">$http</span><span class="o">-&gt;</span><span class="na">responseClass</span> <span class="o">=</span> <span class="s1">&#39;YourResponse&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Changed in version 2.3: </span>As of 2.3.0 you should extend <tt class="docutils literal"><span class="pre">HttpSocketResponse</span></tt> instead. This
avoids a common issue with the HTTP PECL extension.</p>
</div>
</div>
<div class="section" id="downloading-the-results">
<h3>Downloading the results<a class="headerlink" href="#downloading-the-results" title="Permalink to this headline">¶</a></h3>
<p>HttpSocket has a new method called <cite>setContentResource()</cite>. By setting a resource
with this method, the content will be written to this resource, using
<cite>fwrite()</cite>. To you download a file, you can do:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;HttpSocket&#39;</span><span class="p">,</span> <span class="s1">&#39;Network/Http&#39;</span><span class="p">);</span>

<span class="nv">$http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpSocket</span><span class="p">();</span>
<span class="nv">$f</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nx">TMP</span> <span class="o">.</span> <span class="s1">&#39;bakery.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">);</span>
<span class="nv">$http</span><span class="o">-&gt;</span><span class="na">setContentResource</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
<span class="nv">$http</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;http://bakery.cakephp.org/comments.rss&#39;</span><span class="p">);</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The headers are not included in file, you will only get the body content
written to your resource. To disable saving into the resource, use
<tt class="docutils literal"><span class="pre">$http-&gt;setContentResource(false)</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="using-authentication">
<h2>Using authentication<a class="headerlink" href="#using-authentication" title="Permalink to this headline">¶</a></h2>
<p>HttpSocket supports a HTTP Basic and Digest authentication methods out of the
box. You can also create custom authentication objects to support protocols
like OAuth. To use any authentication system you need to configure the
<tt class="docutils literal"><span class="pre">HttpSocket</span></tt> instance:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">&#39;HttpSocket&#39;</span><span class="p">,</span> <span class="s1">&#39;Network/Http&#39;</span><span class="p">);</span>

<span class="nv">$http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpSocket</span><span class="p">();</span>
<span class="nv">$http</span><span class="o">-&gt;</span><span class="na">configAuth</span><span class="p">(</span><span class="s1">&#39;Basic&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The above would configure the <tt class="docutils literal"><span class="pre">HttpSocket</span></tt> instance to use Basic
authentication using <tt class="docutils literal"><span class="pre">user</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt> as the credentials.</p>
<div class="section" id="creating-a-custom-authentication-object">
<h3>Creating a custom authentication object<a class="headerlink" href="#creating-a-custom-authentication-object" title="Permalink to this headline">¶</a></h3>
<p>You can now create your own authentication method to use with HttpSocket. You
could create the file <tt class="docutils literal"><span class="pre">app/Lib/Network/Http/YourMethodAuthentication.php</span></tt> with the
content:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">YourMethodAuthentication</span> <span class="p">{</span>

<span class="sd">/**</span>
<span class="sd"> * Authentication</span>
<span class="sd"> *</span>
<span class="sd"> * @param HttpSocket $http</span>
<span class="sd"> * @param array $authInfo</span>
<span class="sd"> * @return void</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">authentication</span><span class="p">(</span><span class="nx">HttpSocket</span> <span class="nv">$http</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$authInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Do something, for example set $http-&gt;request[&#39;header&#39;][&#39;Authentication&#39;] value</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>To configure HttpSocket to use your auth configuration, you can use the new
method <tt class="docutils literal"><span class="pre">configAuth()</span></tt>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$http</span><span class="o">-&gt;</span><span class="na">configAuth</span><span class="p">(</span><span class="s1">&#39;YourMethod&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;config1&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="s1">&#39;config2&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;value2&#39;</span><span class="p">));</span>
<span class="nv">$http</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;http://secure.your-site.com&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">authentication()</span></tt> method will be called to append the request headers.</p>
</div>
<div class="section" id="using-a-httpsocket-with-a-proxy">
<h3>Using a HttpSocket with a proxy<a class="headerlink" href="#using-a-httpsocket-with-a-proxy" title="Permalink to this headline">¶</a></h3>
<p>As part of auth configuration, you can configure proxy authentication. You can
create your customized method to proxy authentication in the same class of
authentication. For example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">YourMethodAuthentication</span> <span class="p">{</span>

<span class="sd">/**</span>
<span class="sd"> * Authentication</span>
<span class="sd"> *</span>
<span class="sd"> * @param HttpSocket $http</span>
<span class="sd"> * @param array $authInfo</span>
<span class="sd"> * @return void</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">authentication</span><span class="p">(</span><span class="nx">HttpSocket</span> <span class="nv">$http</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$authInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Do something, for example set $http-&gt;request[&#39;header&#39;][&#39;Authentication&#39;] value</span>
    <span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * Proxy Authentication</span>
<span class="sd"> *</span>
<span class="sd"> * @param HttpSocket $http</span>
<span class="sd"> * @param array $proxyInfo</span>
<span class="sd"> * @return void</span>
<span class="sd"> */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">proxyAuthentication</span><span class="p">(</span><span class="nx">HttpSocket</span> <span class="nv">$http</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$proxyInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Do something, for example set $http-&gt;request[&#39;header&#39;][&#39;Proxy-Authentication&#39;] value</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To use a proxy, you must call the <tt class="docutils literal"><span class="pre">HttpSocket::configProxy()</span></tt> similar to
<tt class="docutils literal"><span class="pre">HttpSocket::configAuth()</span></tt>.</p>
</div>
</div>
</div>
</div>


		</div>
	</div>

	<div class="sidebar columns three pull-nine">
<div id="sidebar-navigation" class="hide-on-phones">
	<h2 class="hide-on-desktops">Table of Contents</h2>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cakephp-overview.html">CakePHP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Models</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../core-libraries.html">Core Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../core-libraries/toc-general-purpose.html">General Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-libraries/toc-behaviors.html">Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-libraries/toc-components.html">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-libraries/toc-helpers.html">Helpers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../core-libraries/toc-utilities.html">Utilities</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../core-libraries/caching.html">Caching</a></li>
<li class="toctree-l3"><a class="reference internal" href="email.html">CakeEmail</a></li>
<li class="toctree-l3"><a class="reference internal" href="file-folder.html">Folder &amp; File</a></li>
<li class="toctree-l3"><a class="reference internal" href="hash.html">Hash</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">HttpSocket</a></li>
<li class="toctree-l3"><a class="reference internal" href="inflector.html">Inflector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-libraries/internationalization-and-localization.html">Internationalization &amp; Localization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-libraries/logging.html">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="number.html">CakeNumber</a></li>
<li class="toctree-l3"><a class="reference internal" href="router.html">Router</a></li>
<li class="toctree-l3"><a class="reference internal" href="sanitize.html">Data Sanitization</a></li>
<li class="toctree-l3"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="set.html">Set</a></li>
<li class="toctree-l3"><a class="reference internal" href="string.html">String</a></li>
<li class="toctree-l3"><a class="reference internal" href="time.html">CakeTime</a></li>
<li class="toctree-l3"><a class="reference internal" href="xml.html">Xml</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Console and Shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

<div class="page-contents">
	<h3>Page contents</h3>
	<ul>
<li><a class="reference internal" href="#">HttpSocket</a><ul>
<li><a class="reference internal" href="#making-a-request">Making a request</a></li>
<li><a class="reference internal" href="#handling-the-response">Handling the response</a><ul>
<li><a class="reference internal" href="#getting-headers-from-a-response">Getting headers from a response</a></li>
<li><a class="reference internal" href="#automatically-handling-a-redirect-response">Automatically handling a redirect response</a></li>
<li><a class="reference internal" href="#handling-ssl-certificates">Handling SSL certificates</a></li>
<li><a class="reference internal" href="#creating-a-custom-response-class">Creating a custom response class</a></li>
<li><a class="reference internal" href="#downloading-the-results">Downloading the results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-authentication">Using authentication</a><ul>
<li><a class="reference internal" href="#creating-a-custom-authentication-object">Creating a custom authentication object</a></li>
<li><a class="reference internal" href="#using-a-httpsocket-with-a-proxy">Using a HttpSocket with a proxy</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
	</div>

</div>

<div class="content row">
	<ul class="related-pages inline">
	<li>
		<a href="../genindex.html" title="General Index" accesskey="I">index</a>
	</li>
	<li>
		<a href="inflector.html" title="Inflector" accesskey="N">next</a>
	</li>
	<li>
		<a href="hash.html" title="Hash" accesskey="P">previous</a>
	</li>
	</ul>
</div>

	<div class="footer-push"> </div>
</div>






<div class="footer">
	<div class="row">
		<div class="columns six offset-by-three contribute">
			<strong>发现翻译错误?</strong>
			请在下面留言<br />
			<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">[ 我要加入翻译 ]</a>
		</div>
	</div>
	
	<div class="row">
		<div class="columns nine offset-by-three copyright">
					&copy; Copyright 2014, Cake Software Foundation, Inc.
				Last updated on Jul 10, 2016.
				Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
		</div>
	</div>
</div>

<div id="nav-modal" class="reveal-modal"> </div>
<div id="inline-search-results"></div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->

<!-- Grunt Live Reload -->
<script src="http://192.168.56.113:35729/livereload.js"></script>
  </body>
</html>