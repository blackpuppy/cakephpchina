
<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Tree" lang="en" name="title" />
<meta content="auto increment,literal representation,parent id,table categories,database table,hierarchical data,null value,menu system,intricacies,access control,hierarchy,logic,elements,trees" lang="en" name="keywords" />

    <title>Tree &mdash; CakePHP Cookbook 2.x documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/app.js"></script>
    <script type="text/javascript" src="../../_static/modernizr.foundation.js"></script>
    <script type="text/javascript" src="../../_static/foundation.js"></script>
    <link rel="top" title="CakePHP Cookbook 2.x documentation" href="../../index.html" />
    <link rel="up" title="Behaviors" href="../toc-behaviors.html" />
    <link rel="next" title="Components" href="../toc-components.html" />
    <link rel="prev" title="Translate" href="translate.html" />
<link href="../../_static/favicon.ico" type="image/x-icon" rel="icon" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="alternate" hreflang="pt" href="../../../pt/core-libraries/behaviors/tree.html" /><link rel="alternate" hreflang="es" href="../../../es/core-libraries/behaviors/tree.html" /><link rel="alternate" hreflang="ja" href="../../../ja/core-libraries/behaviors/tree.html" /><link rel="alternate" hreflang="fr" href="../../../fr/core-libraries/behaviors/tree.html" /><link rel="alternate" hreflang="zh_CN" href="../../../zh/core-libraries/behaviors/tree.html" />

<link rel="search" type="application/opensearchdescription+xml" title="CakePHP Book 2.x Search" href="../../_static/opensearchdescription-book-2-x.xml">
<script type="text/javascript">
window.lang = "en";
</script>

  </head>
  <body>

<div id="container">

<div id="cakephp-global-navigation">
	<ul>
		<li class="main"><a href="http://cakephp.org">CakePHP</a></li>
		<li class="primary"><a href="#" class="empty">Downloads</a>
			<ul class="second-level">
				<li><a href="https://github.com/cakephp/cakephp/tags">Releases</a></li>
				<li><a href="http://pear.cakephp.org">Pear channel</a></li>
			</ul>
		</li>
		<li class="primary"><a href="#" class="empty">Documentation</a>
			<ul class="second-level">
				<li><a href="http://api.cakephp.org">API</a></li>
				<li><a href="http://book.cakephp.org">Book</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://community.cakephp.org">Community</a>
			<ul class="second-level">
				<li><a href="http://webchat.freenode.net/?channels=cakephp&uio=MT1mYWxzZSY5PXRydWUmMTE9MjQ2b8">Help &amp; Support</a></li>
				<li><a href="https://github.com/cakephp/cakephp/issues">Issues</a></li>
				<li><a href="http://bakery.cakephp.org">The Bakery</a></li>
				<li><a href="http://stackoverflow.com/tags/cakephp">Stack Overflow</a></li>
				<li><a href="http://www.facebook.com/groups/cake.community">Facebook Group</a></li>
				<li><a href="http://goo.gl/mSC0s">Google+ Community</a></li>
				<li><a href="http://www.youtube.com/user/CakePHP">YouTube Channel</a></li>
				<li><a href="http://podcast.cakephp.org">CakePHP Podcast</a></li>
				<li><a href="http://twitter.com/CakePHP">Follow us on Twitter</a></li>
				<li><a href="http://groups.google.com/group/cake-php">Google Group</a></li>
				<li><a href="http://github.com/cakephp/cakephp/contributors">Contributors</a></li>
				<li><a href="http://plugins.cakephp.org">Plugins &amp; Packages</a></li>
				<li><a href="http://community.cakephp.org/get-involved">Get Involved</a></li>
				<li><a href="http://community.cakephp.org/guidelines">Guidelines</a></li>
				<li><a href="http://cakefest.org">CakeFest</a></li>
				<li><a href="http://cakephp.org/logos">Logo</a></li>
			</ul>
		</li>
		<li class="primary"><a href="http://cakephp.org/services">Services</a>
			<ul class="second-level">
				<li><a href="http://cakephp.org/services/certification">Certification</a></li>
				<li><a href="http://cakephp.org/services/consultation">Consultation</a></li>
				<li><a href="http://cakephp.org/services/support">Support</a></li>
				<li><a href="http://training.cakephp.org">Training</a></li>
			</ul>
		</li>
	</ul>
</div>

<div class="masthead">
	<div class="header-backing"></div>
	<div class="searchbar row">
		<div class="columns three phone-one">
			<a class="logo" href="../../contents.html">
			<img src="../../_static/cake-logo.png" alt="CakePHP" width="70" />
			</a>
		</div>
		
<div id="searchbox" class="columns nine phone-three">

	<form id="searchform" class="search" action="../../search.html" method="get">
		<input class="search-input" autocomplete="off" type="search" name="q" size="18" />
		<input class="search-submit search-big button red" type="submit" value="Search" />
		<input type="hidden" name="check_keywords" value="yes" />
		<input type="hidden" name="area" value="default" />

		<a href="#" id="tablet-nav" class="show-on-phones pale button small">Nav</a>
	</form>

</div>
	</div>
</div>
<div class="breadcrumb-header">
	<div class="related row">
		<div class="columns three root-link">
			<a href="../../contents.html">Cookbook 2.x</a>
		</div>
		<div class="columns nine">
			<ul class="inline breadcrumb">
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../../core-libraries.html"  itemprop="url"><span itemprop="title">Core Libraries</span></a>
			</li>
			<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
				<a href="../toc-behaviors.html" accesskey="U" itemprop="url"><span itemprop="title">Behaviors</span></a>
			</li>
			</ul>
			<div class="versions dropdown">
				<a href="#">2.x Book</a>
				<ul>
					<li><a href="http://book.cakephp.org/3.0/en">3.0 Book</a></li>
					<li><a href="http://book.cakephp.org/1.3/en/">1.3 Book</a></li>
					<li><a href="http://book.cakephp.org/1.2/en/">1.2 Book</a></li>
					<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
				</ul>
			</div>

			<div class="languages dropdown">
				<a href="#">en</a>

				<ul>
				
					<li></li>
				
					<li><a href="../../../pt/core-libraries/behaviors/tree.html">pt</a></li>
				
					<li><a href="../../../es/core-libraries/behaviors/tree.html">es</a></li>
				
					<li><a href="../../../ja/core-libraries/behaviors/tree.html">ja</a></li>
				
					<li><a href="../../../fr/core-libraries/behaviors/tree.html">fr</a></li>
				
					<li><a href="../../../zh/core-libraries/behaviors/tree.html">zh_CN</a></li>
				
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="content row">
	<div class="document columns nine push-three">
		<div class="body"><a class="button pale improve" href="https://github.com/cakephp/docs/edit/master/en/core-libraries/behaviors/tree.rst" target="_blank">Improve this Doc</a>
  <div class="section" id="tree">
<h1>Tree<a class="headerlink" href="#tree" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="TreeBehavior">
<em class="property">class </em><tt class="descname">TreeBehavior</tt><a class="headerlink" href="#TreeBehavior" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>It&#8217;s fairly common to want to store hierarchical data in a database
table. Examples of such data might be categories with unlimited
subcategories, data related to a multilevel menu system or a
literal representation of hierarchy such as is used to store access
control objects with ACL logic.</p>
<p>For small trees of data, or where the data is only a few levels
deep it is simple to add a parent_id field to your database table
and use this to keep track of which item is the parent of what.
Bundled with cake however, is a powerful behavior which allows you
to use the benefits of
<a class="reference external" href="http://www.sitepoint.com/hierarchical-data-database-2/">MPTT logic</a>
without worrying about any of the intricacies of the technique -
unless you want to ;).</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>To use the tree behavior, your database table needs 3 fields as
listed below (all are ints):</p>
<ul class="simple">
<li>parent - default fieldname is parent_id, to store the id of the
parent object</li>
<li>left - default fieldname is lft, to store the lft value of the
current row.</li>
<li>right - default fieldname is rght, to store the rght value of
the current row.</li>
</ul>
<p>If you are familiar with MPTT logic you may wonder why a parent
field exists - quite simply it&#8217;s easier to do certain tasks if a
direct parent link is stored on the database - such as finding
direct children.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">parent</span></tt> field must be able to have a NULL value! It might
seem to work if you just give the top elements a parent value of
zero, but reordering the tree (and possible other operations) will
fail.</p>
</div>
</div>
<div class="section" id="basic-usage">
<h2>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>The tree behavior has a lot packed into it, but let&#8217;s start with a
simple example - create the following database table and put some
data in it:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">categories</span> <span class="p">(</span>
    <span class="nx">id</span> <span class="nx">INTEGER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nx">UNSIGNED</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="nx">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nx">parent_id</span> <span class="nx">INTEGER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nx">lft</span> <span class="nx">INTEGER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nx">rght</span> <span class="nx">INTEGER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nx">name</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">PRIMARY</span> <span class="nx">KEY</span>  <span class="p">(</span><span class="nx">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;My Categories&#39;</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Fun&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Sport&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Surfing&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Extreme knitting&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Friends&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;Gerald&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Gwendolyn&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;Work&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">29</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Reports&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;Annual&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;Trips&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;National&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;International&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">);</span>
</pre></div>
</div>
<p>For the purpose of checking that everything is setup correctly, we
can create a test method and output the contents of our category
tree to see what it looks like. With a simple controller:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CategoriesController</span> <span class="k">extends</span> <span class="nx">AppController</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">generateTreeList</span><span class="p">(</span>
          <span class="k">null</span><span class="p">,</span>
          <span class="k">null</span><span class="p">,</span>
          <span class="k">null</span><span class="p">,</span>
          <span class="s1">&#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;</span>
        <span class="p">);</span>
        <span class="nx">debug</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span> <span class="k">die</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and an even simpler model definition:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// app/Model/Category.php</span>
<span class="k">class</span> <span class="nc">Category</span> <span class="k">extends</span> <span class="nx">AppModel</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$actsAs</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Tree&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can check what our category tree data looks like by visiting
/categories You should see something like this:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Reports</p>
<blockquote>
<div><ul class="simple">
<li>Annual</li>
<li>Status</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="section" id="adding-data">
<h3>Adding data<a class="headerlink" href="#adding-data" title="Permalink to this headline">¶</a></h3>
<p>In the previous section, we used existing data and checked that it
looked hierarchal via the method <tt class="docutils literal"><span class="pre">generateTreeList</span></tt>. However,
usually you would add your data in exactly the same way as you
would for any model. For example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// pseudo controller code</span>
<span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">][</span><span class="s1">&#39;parent_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Skating&#39;</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</pre></div>
</div>
<p>When using the tree behavior it&#8217;s not necessary to do any more than
set the parent_id, and the tree behavior will take care of the
rest. If you don&#8217;t set the parent_id, the tree behavior will add
to the tree making your new addition a new top level entry:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// pseudo controller code</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Other People\&#39;s Categories&#39;</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</pre></div>
</div>
<p>Running the above two code snippets would alter your tree as
follows:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
<li>Skating <strong>New</strong></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Reports</p>
<blockquote>
<div><ul class="simple">
<li>Annual</li>
<li>Status</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Other People&#8217;s Categories <strong>New</strong></p>
</li>
</ul>
</div>
<div class="section" id="modifying-data">
<h3>Modifying data<a class="headerlink" href="#modifying-data" title="Permalink to this headline">¶</a></h3>
<p>Modifying data is as transparent as adding new data. If you modify
something, but do not change the parent_id field - the structure
of your data will remain unchanged. For example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// pseudo controller code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// id of Extreme knitting</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Extreme fishing&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>The above code did not affect the parent_id field - even if the
parent_id is included in the data that is passed to save if the
value doesn&#8217;t change, neither does the data structure. Therefore
the tree of data would now look like:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme fishing <strong>Updated</strong></li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Reports</p>
<blockquote>
<div><ul class="simple">
<li>Annual</li>
<li>Status</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Other People&#8217;s Categories</p>
</li>
</ul>
<p>Moving data around in your tree is also a simple affair. Let&#8217;s say
that Extreme fishing does not belong under Sport, but instead
should be located under Other People&#8217;s Categories. With the
following code:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// pseudo controller code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// id of Extreme fishing</span>
<span class="nv">$newParentId</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span>
  <span class="s1">&#39;id&#39;</span><span class="p">,</span>
  <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Other People\&#39;s Categories&#39;</span><span class="p">)</span>
<span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$newParentId</span><span class="p">));</span>
</pre></div>
</div>
<p>As would be expected the structure would be modified to:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Reports</p>
<blockquote>
<div><ul class="simple">
<li>Annual</li>
<li>Status</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Other People&#8217;s Categories</p>
<blockquote>
<div><ul class="simple">
<li>Extreme fishing <strong>Moved</strong></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="deleting-data">
<h3>Deleting data<a class="headerlink" href="#deleting-data" title="Permalink to this headline">¶</a></h3>
<p>The tree behavior provides a number of ways to manage deleting
data. To start with the simplest example; let&#8217;s say that the
reports category is no longer useful. To remove it
<em>and any children it may have</em> just call delete as you would for
any model. For example with the following code:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// pseudo controller code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</pre></div>
</div>
<p>The category tree would be modified as follows:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Other People&#8217;s Categories</p>
<blockquote>
<div><ul class="simple">
<li>Extreme fishing</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="querying-and-using-your-data">
<h3>Querying and using your data<a class="headerlink" href="#querying-and-using-your-data" title="Permalink to this headline">¶</a></h3>
<p>Using and manipulating hierarchical data can be a tricky business.
In addition to the core find methods, with the tree behavior there
are a few more tree-orientated permutations at your disposal.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most tree behavior methods return and rely on data being sorted by
the <tt class="docutils literal"><span class="pre">lft</span></tt> field. If you call <tt class="docutils literal"><span class="pre">find()</span></tt> and do not order by
<tt class="docutils literal"><span class="pre">lft</span></tt>, or call a tree behavior method and pass a sort order, you
may get undesirable results.</p>
</div>
<dl class="class">
<dt>
<em class="property">class </em><tt class="descname">TreeBehavior</tt></dt>
<dd><dl class="method">
<dt id="TreeBehavior::children">
<tt class="descname">children</tt><big>(</big><em>$id = null</em>, <em>$direct = false</em>, <em>$fields = null</em>, <em>$order = null</em>, <em>$limit = null</em>, <em>$page = 1</em>, <em>$recursive = null</em><big>)</big><a class="headerlink" href="#TreeBehavior::children" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$id</strong> &#8211; The ID of the record to look up</li>
<li><strong>$direct</strong> &#8211; Set to true to return only the direct descendants</li>
<li><strong>$fields</strong> &#8211; Single string field name or array of fields to include in the return</li>
<li><strong>$order</strong> &#8211; SQL string of ORDER BY conditions</li>
<li><strong>$limit</strong> &#8211; SQL LIMIT statement</li>
<li><strong>$page</strong> &#8211; for accessing paged results</li>
<li><strong>$recursive</strong> &#8211; Number of levels deep for recursive associated Models</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <tt class="docutils literal"><span class="pre">children</span></tt> method takes the primary key value (the id) of a
row and returns the children, by default in the order they appear
in the tree. The second optional parameter defines whether or not
only direct children should be returned. Using the example data
from the previous section:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$allChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// a flat array with 11 items</span>
<span class="c1">// -- or --</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$allChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">();</span> <span class="c1">// a flat array with 11 items</span>

<span class="c1">// Only return direct children</span>
<span class="nv">$directChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span> <span class="c1">// a flat array with</span>
                                                      <span class="c1">// 2 items</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you want a recursive array use <tt class="docutils literal"><span class="pre">find('threaded')</span></tt></p>
</div>
<dl class="method">
<dt id="TreeBehavior::childCount">
<tt class="descname">childCount</tt><big>(</big><em>$id = null</em>, <em>$direct = false</em><big>)</big><a class="headerlink" href="#TreeBehavior::childCount" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>As with the method <tt class="docutils literal"><span class="pre">children</span></tt>, <tt class="docutils literal"><span class="pre">childCount</span></tt> takes the primary
key value (the id) of a row and returns how many children it has.
The second optional parameter defines whether or not only direct
children are counted. Using the example data from the previous
section:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$totalChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">childCount</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// will output 11</span>
<span class="c1">// -- or --</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$directChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">childCount</span><span class="p">();</span> <span class="c1">// will output 11</span>

<span class="c1">// Only counts the direct descendants of this category</span>
<span class="nv">$numChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">childCount</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span> <span class="c1">// will output 2</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::generateTreeList">
<tt class="descname">generateTreeList</tt><big>(</big><em>$conditions=null</em>, <em>$keyPath=null</em>, <em>$valuePath=null</em>, <em>$spacer= '_'</em>, <em>$recursive=null</em><big>)</big><a class="headerlink" href="#TreeBehavior::generateTreeList" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$conditions</strong> &#8211; Uses the same conditional options as find().</li>
<li><strong>$keyPath</strong> &#8211; Path to the field to use for the key.</li>
<li><strong>$valuePath</strong> &#8211; Path to the field to use for the label.</li>
<li><strong>$spacer</strong> &#8211; The string to use in front of each item to indicate depth.</li>
<li><strong>$recursive</strong> &#8211; The number of levels deep to fetch associated records</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method will return data similar to
<a class="reference internal" href="../../models/retrieving-your-data.html#model-find-list"><em>find(&#8216;list&#8217;)</em></a> but with a nested prefix that is specified
in the <tt class="docutils literal"><span class="pre">spacer</span></tt> option to show the structure of your data. Below is
an example of what you can expect this method to return:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$treelist</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">generateTreeList</span><span class="p">();</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">array</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;My Categories&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;_Fun&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;__Sport&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;___Surfing&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;___Skating&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;__Friends&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;___Gerald&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;___Gwendolyn&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;_Work&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;__Trips&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;___National&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;___International&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;Other People&#39;s Categories&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;_Extreme fishing&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::formatTreeList">
<tt class="descname">formatTreeList</tt><big>(</big><em>$results</em>, <em>$options=array()</em><big>)</big><a class="headerlink" href="#TreeBehavior::formatTreeList" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="versionadded">
<p><span class="versionmodified">New in version 2.7.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$results</strong> &#8211; Results of a find(&#8216;all&#8217;) call.</li>
<li><strong>$options</strong> &#8211; Options to pass into.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method will return data similar to
<a class="reference internal" href="../../models/retrieving-your-data.html#model-find-list"><em>find(&#8216;list&#8217;)</em></a> but with a nested prefix that is specified
in the <tt class="docutils literal"><span class="pre">spacer</span></tt> option to show the structure of your data.</p>
<p>Supported options are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">keyPath</span></tt>: A string path to the key, i.e. &#8220;{n}.Post.id&#8221;.</li>
<li><tt class="docutils literal"><span class="pre">valuePath</span></tt>: A string path to the value, i.e. &#8220;{n}.Post.title&#8221;.</li>
<li><tt class="docutils literal"><span class="pre">spacer</span></tt>: The character or characters which will be repeated.</li>
</ul>
<p>An example would be:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$results</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">formatTreeList</span><span class="p">(</span><span class="nv">$results</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;spacer&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;--&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::getParentNode">
<tt class="descname">getParentNode</tt><big>(</big><big>)</big><a class="headerlink" href="#TreeBehavior::getParentNode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This convenience function will, as the name suggests, return the
parent node for any node, or <em>false</em> if the node has no parent (it&#8217;s
the root node). For example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$parent</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">getParentNode</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">//&lt;- id for fun</span>
<span class="c1">// $parent contains All categories</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::getPath">
<tt class="descname">getPath</tt><big>(</big><em>$id = null</em>, <em>$fields = null</em>, <em>$recursive = null</em><big>)</big><a class="headerlink" href="#TreeBehavior::getPath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The &#8216;path&#8217; when referring to hierarchal data is how you get from
where you are to the top. So for example the path from the category
&#8220;International&#8221; is:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">...</p>
</li>
<li><p class="first">Work</p>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>...</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Using the id of &#8220;International&#8221; getPath will return each of the
parents in turn (starting from the top).</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$parents</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">getPath</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// contents of $parents</span>
<span class="k">array</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;Category&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;My Categories&#39;</span><span class="p">,</span> <span class="o">..</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;Category&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Work&#39;</span><span class="p">,</span> <span class="o">..</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;Category&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Trips&#39;</span><span class="p">,</span> <span class="o">..</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;Category&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;International&#39;</span><span class="p">,</span> <span class="o">..</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h2>
<p>The tree behavior doesn&#8217;t only work in the background, there are a
number of specific methods defined in the behavior to cater for all
your hierarchical data needs, and any unexpected problems that
might arise in the process.</p>
<dl class="method">
<dt id="TreeBehavior::moveDown">
<tt class="descclassname">TreeBehavior::</tt><tt class="descname">moveDown</tt><big>(</big><big>)</big><a class="headerlink" href="#TreeBehavior::moveDown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Used to move a single node down the tree. You need to provide the
ID of the element to be moved and a positive number of how many
positions the node should be moved down. All child nodes for the
specified node will also be moved.</p>
<p>Here is an example of a controller action (in a controller named
Categories) that moves a specified node down the tree:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">movedown</span><span class="p">(</span><span class="nv">$id</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$delta</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">())</span> <span class="p">{</span>
       <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundException</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Invalid category&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">moveDown</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$delta</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Session</span><span class="o">-&gt;</span><span class="na">setFlash</span><span class="p">(</span>
          <span class="s1">&#39;Please provide the number of positions the field should be&#39;</span> <span class="o">.</span>
          <span class="s1">&#39;moved down.&#39;</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example, if you&#8217;d like to move the &#8220;Sport&#8221; ( id of 3 ) category one
position down, you would request: /categories/movedown/3/1.</p>
<dl class="method">
<dt id="TreeBehavior::moveUp">
<tt class="descclassname">TreeBehavior::</tt><tt class="descname">moveUp</tt><big>(</big><big>)</big><a class="headerlink" href="#TreeBehavior::moveUp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Used to move a single node up the tree. You need to provide the ID
of the element to be moved and a positive number of how many
positions the node should be moved up. All child nodes will also be
moved.</p>
<p>Here&#8217;s an example of a controller action (in a controller named
Categories) that moves a node up the tree:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">moveup</span><span class="p">(</span><span class="nv">$id</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$delta</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">())</span> <span class="p">{</span>
       <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundException</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Invalid category&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">moveUp</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$delta</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Session</span><span class="o">-&gt;</span><span class="na">setFlash</span><span class="p">(</span>
          <span class="s1">&#39;Please provide a number of positions the category should&#39;</span> <span class="o">.</span>
          <span class="s1">&#39;be moved up.&#39;</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example, if you would like to move the category &#8220;Gwendolyn&#8221; ( id of 8 ) up
one position you would request /categories/moveup/8/1. Now
the order of Friends will be Gwendolyn, Gerald.</p>
<dl class="method">
<dt id="TreeBehavior::removeFromTree">
<tt class="descclassname">TreeBehavior::</tt><tt class="descname">removeFromTree</tt><big>(</big><em>$id = null</em>, <em>$delete = false</em><big>)</big><a class="headerlink" href="#TreeBehavior::removeFromTree" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Using this method will either delete or move a node but retain its
sub-tree, which will be reparented one level higher. It offers more
control than <a class="reference internal" href="../../models/deleting-data.html#model-delete"><em>delete</em></a>, which for a model
using the tree behavior will remove the specified node and all of
its children.</p>
<p>Taking the following tree as a starting point:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Running the following code with the id for &#8216;Sport&#8217;:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Node</span><span class="o">-&gt;</span><span class="na">removeFromTree</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</pre></div>
</div>
<p>The Sport node will be become a top level node:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Sport <strong>Moved</strong></p>
</li>
</ul>
<p>This demonstrates the default behavior of <tt class="docutils literal"><span class="pre">removeFromTree</span></tt> of
moving the node to have no parent, and re-parenting all children.</p>
<p>If however the following code snippet was used with the id for
&#8216;Sport&#8217;:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Node</span><span class="o">-&gt;</span><span class="na">removeFromTree</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<p>The tree would become</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>This demonstrates the alternate use for <tt class="docutils literal"><span class="pre">removeFromTree</span></tt>, the
children have been reparented and &#8216;Sport&#8217; has been deleted.</p>
<dl class="method">
<dt id="TreeBehavior::reorder">
<tt class="descclassname">TreeBehavior::</tt><tt class="descname">reorder</tt><big>(</big><em>array('id' =&gt; null</em>, <em>'field' =&gt; $Model-&gt;displayField</em>, <em>'order' =&gt; 'ASC'</em>, <em>'verify' =&gt; true)</em><big>)</big><a class="headerlink" href="#TreeBehavior::reorder" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Reorders the nodes (and child nodes) of the tree according to the
field and direction specified in the parameters. This method does
not change the parent of any node.</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">reorder</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="c1">//id of record to use as top node for reordering, default: $Model-&gt;id</span>
    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="p">,</span>
    <span class="c1">//which field to use in reordering, default: $Model-&gt;displayField</span>
    <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="p">,</span>
    <span class="c1">//direction to order, default: &#39;ASC&#39;</span>
    <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="p">,</span>
    <span class="c1">//whether or not to verify the tree before reorder, default: true</span>
    <span class="s1">&#39;verify&#39;</span> <span class="o">=&gt;</span>
<span class="p">));</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have saved your data or made other operations on the model,
you might want to set <tt class="docutils literal"><span class="pre">$model-&gt;id</span> <span class="pre">=</span> <span class="pre">null</span></tt> before calling
<tt class="docutils literal"><span class="pre">reorder</span></tt>. Otherwise only the current node and it&#8217;s children will
be reordered.</p>
</div>
</div>
<div class="section" id="data-integrity">
<h2>Data Integrity<a class="headerlink" href="#data-integrity" title="Permalink to this headline">¶</a></h2>
<p>Due to the nature of complex self referential data structures such
as trees and linked lists, they can occasionally become broken by a
careless call. Take heart, for all is not lost! The Tree Behavior
contains several previously undocumented features designed to
recover from such situations.</p>
<dl class="method">
<dt id="TreeBehavior::recover">
<tt class="descclassname">TreeBehavior::</tt><tt class="descname">recover</tt><big>(</big><em>$mode = 'parent'</em>, <em>$missingParentAction = null</em><big>)</big><a class="headerlink" href="#TreeBehavior::recover" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <tt class="docutils literal"><span class="pre">mode</span></tt> parameter is used to specify the source of info that
is valid/correct. The opposite source of data will be populated
based upon that source of info. E.g. if the MPTT fields are corrupt
or empty, with the <tt class="docutils literal"><span class="pre">$mode</span> <span class="pre">'parent'</span></tt> the values of the
<tt class="docutils literal"><span class="pre">parent_id</span></tt> field will be used to populate the left and right
fields. The <tt class="docutils literal"><span class="pre">missingParentAction</span></tt> parameter only applies to
&#8220;parent&#8221; mode and determines what to do if the parent field
contains an id that is not present.</p>
<p>Available <tt class="docutils literal"><span class="pre">$mode</span></tt> options:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'parent'</span></tt> - use the existing <tt class="docutils literal"><span class="pre">parent_id</span></tt>&#8216;s to update the
<tt class="docutils literal"><span class="pre">lft</span></tt> and <tt class="docutils literal"><span class="pre">rght</span></tt> fields</li>
<li><tt class="docutils literal"><span class="pre">'tree'</span></tt> - use the existing <tt class="docutils literal"><span class="pre">lft</span></tt> and <tt class="docutils literal"><span class="pre">rght</span></tt> fields to
update <tt class="docutils literal"><span class="pre">parent_id</span></tt></li>
</ul>
<p>Available <tt class="docutils literal"><span class="pre">missingParentActions</span></tt> options when using
<tt class="docutils literal"><span class="pre">mode='parent'</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">null</span></tt> - do nothing and carry on</li>
<li><tt class="docutils literal"><span class="pre">'return'</span></tt> - do nothing and return</li>
<li><tt class="docutils literal"><span class="pre">'delete'</span></tt> - delete the node</li>
<li><tt class="docutils literal"><span class="pre">int</span></tt> - set the parent_id to this id</li>
</ul>
<p>Example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="c1">// Rebuild all the left and right fields based on the parent_id</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">recover</span><span class="p">();</span>
<span class="c1">// or</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">recover</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">);</span>

<span class="c1">// Rebuild all the parent_id&#39;s based on the lft and rght fields</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">recover</span><span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="method">
<dt>
<tt class="descclassname">TreeBehavior::</tt><tt class="descname">reorder</tt><big>(</big><em>$options = array()</em><big>)</big></dt>
<dd></dd></dl>

<p>Reorders the nodes (and child nodes) of the tree according to the
field and direction specified in the parameters. This method does
not change the parent of any node.</p>
<p>Reordering affects all nodes in the tree by default, however the
following options can affect the process:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'id'</span></tt> - only reorder nodes below this node.</li>
<li><tt class="docutils literal"><span class="pre">'field</span></tt>&#8216; - field to use for sorting, default is the
<tt class="docutils literal"><span class="pre">displayField</span></tt> for the model.</li>
<li><tt class="docutils literal"><span class="pre">'order'</span></tt> - <tt class="docutils literal"><span class="pre">'ASC'</span></tt> for ascending, <tt class="docutils literal"><span class="pre">'DESC'</span></tt> for descending
sort.</li>
<li><tt class="docutils literal"><span class="pre">'verify'</span></tt> - whether or not to verify the tree prior to
resorting.</li>
</ul>
<p><tt class="docutils literal"><span class="pre">$options</span></tt> is used to pass all extra parameters, and has the
following possible keys by default, all of which are optional:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
    <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">displayField</span><span class="p">,</span>
    <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ASC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;verify&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::verify">
<tt class="descclassname">TreeBehavior::</tt><tt class="descname">verify</tt><big>(</big><big>)</big><a class="headerlink" href="#TreeBehavior::verify" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Returns <tt class="docutils literal"><span class="pre">true</span></tt> if the tree is valid otherwise an array of errors,
with fields for type, incorrect index and message.</p>
<p>Each record in the output array is an array of the form (type, id,
message)</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">type</span></tt> is either <tt class="docutils literal"><span class="pre">'index'</span></tt> or <tt class="docutils literal"><span class="pre">'node'</span></tt></li>
<li><tt class="docutils literal"><span class="pre">'id'</span></tt> is the id of the erroneous node.</li>
<li><tt class="docutils literal"><span class="pre">'message'</span></tt> depends on the error</li>
</ul>
<p>Example Use:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">verify</span><span class="p">();</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">node</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">3</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">left</span> <span class="k">and</span> <span class="nx">right</span> <span class="nx">values</span> <span class="nx">identical</span>
        <span class="p">)</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">node</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">2</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">The</span> <span class="k">parent</span> <span class="nx">node</span> <span class="mi">999</span> <span class="nx">doesn</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">exist</span>
        <span class="p">)</span>
    <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">index</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">123</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">missing</span>
        <span class="p">)</span>
    <span class="p">[</span><span class="mi">99</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">node</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">163</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">left</span> <span class="nx">greater</span> <span class="nx">than</span> <span class="nx">right</span>
        <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="node-level-depth">
<h2>Node Level (Depth)<a class="headerlink" href="#node-level-depth" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.7.</span></p>
</div>
<p>Knowing the depth of tree nodes can be useful when you want to retrieve nodes
only upto a certain level for e.g. when generating menus. You can use the
<tt class="docutils literal"><span class="pre">level</span></tt> option to specify the field that will save level of each node:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span class="k">public</span> <span class="nv">$actAs</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Tree&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;level&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="c1">// Defaults to null, i.e. no level saving</span>
<span class="p">));</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::getLevel">
<tt class="descclassname">TreeBehavior::</tt><tt class="descname">getLevel</tt><big>(</big><em>$id</em><big>)</big><a class="headerlink" href="#TreeBehavior::getLevel" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="versionadded">
<p><span class="versionmodified">New in version 2.7.</span></p>
</div>
<p>If you are not caching the level of nodes using the <tt class="docutils literal"><span class="pre">level</span></tt> option in settings,
you can use this method to get level of a particular node.</p>
</div>
</div>


		</div>
	</div>

	<div class="sidebar columns three pull-nine">
<div id="sidebar-navigation" class="hide-on-phones">
	<h2 class="hide-on-desktops">Table of Contents</h2>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cakephp-overview.html">CakePHP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../views.html">Views</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../models.html">Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../models/associations-linking-models-together.html">Associations: Linking Models Together</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/retrieving-your-data.html">Retrieving Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/saving-your-data.html">Saving Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/deleting-data.html">Deleting Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/data-validation.html">Data Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/callback-methods.html">Callback Methods</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../models/behaviors.html">Behaviors</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="acl.html">ACL</a></li>
<li class="toctree-l3"><a class="reference internal" href="containable.html">Containable</a></li>
<li class="toctree-l3"><a class="reference internal" href="translate.html">Translate</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Tree</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../models/datasources.html">DataSources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/model-attributes.html">Model Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/additional-methods-and-properties.html">Additional Methods and Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/virtual-fields.html">Virtual fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/transactions.html">Transactions</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../core-libraries.html">Core Libraries</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../toc-general-purpose.html">General Purpose</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../global-constants-and-functions.html">Global Constants and Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core-utility-libraries/app.html">App Class</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../events.html">Events System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collections.html">Collections</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../toc-behaviors.html">Behaviors</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="acl.html">ACL</a></li>
<li class="toctree-l3"><a class="reference internal" href="containable.html">Containable</a></li>
<li class="toctree-l3"><a class="reference internal" href="translate.html">Translate</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Tree</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../toc-components.html">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../toc-helpers.html">Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../toc-utilities.html">Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../console-and-shells.html">Console and Shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices.html">Appendices</a></li>
</ul>

</div>

<div class="page-contents">
	<h3>Page contents</h3>
	<ul>
<li><a class="reference internal" href="#">Tree</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a><ul>
<li><a class="reference internal" href="#adding-data">Adding data</a></li>
<li><a class="reference internal" href="#modifying-data">Modifying data</a></li>
<li><a class="reference internal" href="#deleting-data">Deleting data</a></li>
<li><a class="reference internal" href="#querying-and-using-your-data">Querying and using your data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-usage">Advanced Usage</a></li>
<li><a class="reference internal" href="#data-integrity">Data Integrity</a></li>
<li><a class="reference internal" href="#node-level-depth">Node Level (Depth)</a></li>
</ul>
</li>
</ul>

</div>
	</div>

</div>

<div class="content row">
	<ul class="related-pages inline">
	<li>
		<a href="../../genindex.html" title="General Index" accesskey="I">index</a>
	</li>
	<li>
		<a href="../toc-components.html" title="Components" accesskey="N">next</a>
	</li>
	<li>
		<a href="translate.html" title="Translate" accesskey="P">previous</a>
	</li>
	</ul>
</div>

	<div class="footer-push"> </div>
</div>






<div class="footer">
	<div class="row">
		<div class="columns six offset-by-three contribute">
			<strong>发现翻译错误?</strong>
			请在下方留言<br />
			<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">[ 我要加入翻译 ]</a>
		</div>
	</div>
	
	<div class="row">
		<div class="columns nine offset-by-three copyright">
					&copy; Copyright 2014, Cake Software Foundation, Inc.
				Last updated on Aug 31, 2015.
				Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
			Sponsored by <a href="http://www.shinetechzhengzhou.com/" target="_blank">盛安德郑州</a>
		</div>
	</div>
</div>

<div id="nav-modal" class="reveal-modal"> </div>
<div id="inline-search-results"></div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
  </body>
</html>