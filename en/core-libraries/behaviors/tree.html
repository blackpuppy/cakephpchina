

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Tree" lang="en" name="title" />
<meta content="auto increment,literal representation,parent id,table categories,database table,hierarchical data,null value,menu system,intricacies,access control,hierarchy,logic,elements,trees" lang="en" name="keywords" />

    <title>Tree</title>
    <link href="../../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../../_static/app.js"></script>

    <link rel="alternate" hreflang="pt" href="../../../pt/core-libraries/behaviors/tree.html" /><link rel="alternate" hreflang="es" href="../../../es/core-libraries/behaviors/tree.html" /><link rel="alternate" hreflang="ja" href="../../../ja/core-libraries/behaviors/tree.html" /><link rel="alternate" hreflang="fr" href="../../../fr/core-libraries/behaviors/tree.html" /><link rel="alternate" hreflang="zh" href="../../../zh/core-libraries/behaviors/tree.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within CakePHP Cookbook 2.x documentation" href="../../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="CakePHP Cookbook 2.x documentation" href="../../index.html" />
    <link rel="up" title="Behaviors" href="../../models/behaviors.html" />
    <link rel="next" title="DataSources" href="../../models/datasources.html" />
    <link rel="prev" title="Translate" href="translate.html" />

    <script type="text/javascript">
    window.lang = "en";
    </script>
  </head>
  <body>

<div id="container">
	
	<header class="nav-down">
		<div class="container-fluid hidden-xs hidden-sm">
			<div class="row">
				<div class="col-sm-3 col-md-3">
					<a class="logo-cake" href="http://cakephp.org">
						<img src="../../_static/logo-cake.png" alt="CakePHP" />
					</a>
				</div>

				<div class="col-sm-9 col-md-9">
					<nav class="navbar-right">
						<ul class="menu">
							<li class="first">
								<a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
								<ul class="submenu">
									
<li><a href="http://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>CookBook</a></li>
<li><a href="http://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="http://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="http://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="http://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
								</ul>
							</li>

							<li><a href="http://cakephp.org/business-solutions">Business Solutions</a></li>
							<li><a href="http://cakephp.org/showcase">Showcase</a></li>

							<li>
								<a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
								<div class="megamenu full">
									<div class="row">
										<div class="col-6 pl30">
											<ul class="megamenu-list">
												
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="http://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="http://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="http://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="http://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="http://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="http://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="http://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
											</ul>
										</div>
										<div class="col-6 pl30">
											<ul class="megamenu-list">
												
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="http://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="http://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="http://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="http://cakedc.com"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
											</ul>
										</div>
									</div>
								</div>
							</li>
						</ul>
					</nav>
				</div>
			</div>
		</div>

		
		<div class="container-fluid hidden-md hidden-lg">
			<div class="row">
				<div class="col-sm-6 col-xs-6">
					<a class="logo-cake" href="http://cakephp.org">
						<img src="../../_static/logo-cake.png" alt="CakePHP" />
					</a>
				</div>

				<div class="col-sm-6 col-xs-6">
					<div class="navbar-right">
						<button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
							<i class="fa fa-bars toggle-modal"></i>
						</button>
					</div>
					<div id="wrap">
						<form class="search" action="../../search.html" method="get">
							<input name="q" type="search" placeholder="What are you looking for?">
							<input id="search_submit" value="Search" type="submit">
						</form>
					</div>
				</div>
			</div>
		</div>

		
		<section id="nav-cook" class="hidden-xs hidden-sm">
			<div class="container-fluid ">
				<div class="row ">
					<div class="col-md-12 back-book">
						<div class="col-md-4 col-md-offset-1 text-center t-cook-nav p0 hidden-sm hidden-xs">
							<h2>
								<a href="../../contents.html">
									<span class="glyph_range icon-submenu icon-submenu-cook">B</span>
									CakePHP 2.x <strong>Cookbook</strong>
								</a>
							</h2>
						</div>

						<div class="col-md-4 hidden-sm">
							<form class="search" action="../../search.html" method="get">
								<input type="hidden" name="check_keywords" value="yes" />
								<input type="hidden" name="area" value="default" />

								<div class="col-md-10 p0">
									<input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
								</div>
								<div class="col-md-2 p0 search-cook">
									<button type="submit">
										<span class="glyph_range icon-submenu icon-submenu-cook">A</span>
									</button>
								</div>
							</form>
						</div>

						
						<div class="col-md-3">
							<div class="col-md-6 p0">
								<div class="col-md-7 t-language p0">
									<h6>Language:</h6>
								</div>
								<div class="col-md-5 p0">
									<ul class="nav navbar-nav">
										<li class="dropdown">
											<a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
													role="button" aria-haspopup="true" aria-expanded="false" href="#">
														en
														<i class="fa fa-menu-en fa-chevron-down"></i>
													</a>
											<ul class="dropdown-menu">
											
												<li></li>
											
												<li><a href="../../../pt/core-libraries/behaviors/tree.html">pt</a></li>
											
												<li><a href="../../../es/core-libraries/behaviors/tree.html">es</a></li>
											
												<li><a href="../../../ja/core-libraries/behaviors/tree.html">ja</a></li>
											
												<li><a href="../../../fr/core-libraries/behaviors/tree.html">fr</a></li>
											
												<li><a href="../../../zh/core-libraries/behaviors/tree.html">zh</a></li>
											
											</ul>
										</li>
									</ul>
								</div>
							</div>

							<div class="col-md-6 p0">
								<div class="col-md-7 t-language p0">
									<h6>Version:</h6>
								</div>
								<div class="col-md-5 p0">
									<ul class="nav navbar-nav">
										<li class="dropdown">
											<a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">2.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
											<ul class="dropdown-menu">
												<li><a href="http://book.cakephp.org/3.0/en">3.x Book</a></li>
												<li><a href="http://book.cakephp.org/2.0/en">2.x Book</a></li>
												<li><a href="http://book.cakephp.org/1.3/en/">1.3 Book</a></li>
												<li><a href="http://book.cakephp.org/1.2/en/">1.2 Book</a></li>
												<li><a href="http://book.cakephp.org/1.1/en">1.1 Book</a></li>
											</ul>
										</li>
									</ul>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</section>
	</header>

	
	<section class="nav-btn visible-sm visible-xs">
		<div class="container">
			<div class="row">
				<div class="col-sm-6 col-xs-6 text-center">
					<button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
				</div>

				<div class="col-sm-6 col-xs-6 text-center">
					<button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
				</div>
			</div>
		</div>
	</section>

	
	<div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title-cookbook" id="modal-header"></h4>
				</div>
				<div class="modal-body"></div>
			</div>
		</div>
	</div>

<div class="container page-container"><div id="improve-slideout">
		<i class="fa fa-pencil icon-improve"></i>
		<a href="https://github.com/cakephp/docs/edit/master/en/core-libraries/behaviors/tree.rst" target="_blank">
			<div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
		</a>
	</div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

	
	<div class="row">
		<div class="col-sm-12 col-md-9 col-md-push-3 space-left push-off"><div class="page-contents col-sm-5">
				<h3>Page Contents</h3>
				<ul>
<li><a class="reference internal" href="#">Tree</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a><ul>
<li><a class="reference internal" href="#adding-data">Adding data</a></li>
<li><a class="reference internal" href="#modifying-data">Modifying data</a></li>
<li><a class="reference internal" href="#deleting-data">Deleting data</a></li>
<li><a class="reference internal" href="#querying-and-using-your-data">Querying and using your data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-usage">Advanced Usage</a></li>
<li><a class="reference internal" href="#data-integrity">Data Integrity</a></li>
<li><a class="reference internal" href="#node-level-depth">Node Level (Depth)</a></li>
</ul>
</li>
</ul>

			</div><div class="document-body">
			
  <div class="section" id="tree">
<h1>Tree<a class="headerlink" href="#tree" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="TreeBehavior">
<em class="property">class </em><code class="descname">TreeBehavior</code><a class="headerlink" href="#TreeBehavior" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>It&#8217;s fairly common to want to store hierarchical data in a database
table. Examples of such data might be categories with unlimited
subcategories, data related to a multilevel menu system or a
literal representation of hierarchy such as is used to store access
control objects with ACL logic.</p>
<p>For small trees of data, or where the data is only a few levels
deep it is simple to add a parent_id field to your database table
and use this to keep track of which item is the parent of what.
Bundled with cake however, is a powerful behavior which allows you
to use the benefits of
<a class="reference external" href="http://www.sitepoint.com/hierarchical-data-database-2/">MPTT logic</a>
without worrying about any of the intricacies of the technique -
unless you want to ;).</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>To use the tree behavior, your database table needs 3 fields as
listed below (all are ints):</p>
<ul class="simple">
<li>parent - default fieldname is parent_id, to store the id of the
parent object</li>
<li>left - default fieldname is lft, to store the lft value of the
current row.</li>
<li>right - default fieldname is rght, to store the rght value of
the current row.</li>
</ul>
<p>If you are familiar with MPTT logic you may wonder why a parent
field exists - quite simply it&#8217;s easier to do certain tasks if a
direct parent link is stored on the database - such as finding
direct children.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">parent</span></code> field must be able to have a NULL value! It might
seem to work if you just give the top elements a parent value of
zero, but reordering the tree (and possible other operations) will
fail.</p>
</div>
</div>
<div class="section" id="basic-usage">
<h2>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>The tree behavior has a lot packed into it, but let&#8217;s start with a
simple example - create the following database table and put some
data in it:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">categories</span> <span class="p">(</span>
    <span class="nx">id</span> <span class="nx">INTEGER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nx">UNSIGNED</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="nx">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nx">parent_id</span> <span class="nx">INTEGER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nx">lft</span> <span class="nx">INTEGER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nx">rght</span> <span class="nx">INTEGER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nx">name</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">PRIMARY</span> <span class="nx">KEY</span>  <span class="p">(</span><span class="nx">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;My Categories&#39;</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Fun&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Sport&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Surfing&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Extreme knitting&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Friends&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;Gerald&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Gwendolyn&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;Work&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">29</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Reports&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;Annual&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;Trips&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;National&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
<span class="nx">INSERT</span> <span class="nx">INTO</span>
  <span class="sb">`categories`</span> <span class="p">(</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`name`</span><span class="p">,</span> <span class="sb">`parent_id`</span><span class="p">,</span> <span class="sb">`lft`</span><span class="p">,</span> <span class="sb">`rght`</span><span class="p">)</span>
<span class="nx">VALUES</span>
  <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;International&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">);</span>
</pre></div>
</div>
<p>For the purpose of checking that everything is setup correctly, we
can create a test method and output the contents of our category
tree to see what it looks like. With a simple controller:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CategoriesController</span> <span class="k">extends</span> <span class="nx">AppController</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">generateTreeList</span><span class="p">(</span>
          <span class="k">null</span><span class="p">,</span>
          <span class="k">null</span><span class="p">,</span>
          <span class="k">null</span><span class="p">,</span>
          <span class="s1">&#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;</span>
        <span class="p">);</span>
        <span class="nx">debug</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span> <span class="k">die</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and an even simpler model definition:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// app/Model/Category.php</span>
<span class="k">class</span> <span class="nc">Category</span> <span class="k">extends</span> <span class="nx">AppModel</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$actsAs</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Tree&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can check what our category tree data looks like by visiting
/categories You should see something like this:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Reports</p>
<blockquote>
<div><ul class="simple">
<li>Annual</li>
<li>Status</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="section" id="adding-data">
<h3>Adding data<a class="headerlink" href="#adding-data" title="Permalink to this headline">¶</a></h3>
<p>In the previous section, we used existing data and checked that it
looked hierarchal via the method <code class="docutils literal"><span class="pre">generateTreeList</span></code>. However,
usually you would add your data in exactly the same way as you
would for any model. For example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// pseudo controller code</span>
<span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">][</span><span class="s1">&#39;parent_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Skating&#39;</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</pre></div>
</div>
<p>When using the tree behavior it&#8217;s not necessary to do any more than
set the parent_id, and the tree behavior will take care of the
rest. If you don&#8217;t set the parent_id, the tree behavior will add
to the tree making your new addition a new top level entry:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// pseudo controller code</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Other People\&#39;s Categories&#39;</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</pre></div>
</div>
<p>Running the above two code snippets would alter your tree as
follows:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
<li>Skating <strong>New</strong></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Reports</p>
<blockquote>
<div><ul class="simple">
<li>Annual</li>
<li>Status</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Other People&#8217;s Categories <strong>New</strong></p>
</li>
</ul>
</div>
<div class="section" id="modifying-data">
<h3>Modifying data<a class="headerlink" href="#modifying-data" title="Permalink to this headline">¶</a></h3>
<p>Modifying data is as transparent as adding new data. If you modify
something, but do not change the parent_id field - the structure
of your data will remain unchanged. For example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// pseudo controller code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// id of Extreme knitting</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Extreme fishing&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>The above code did not affect the parent_id field - even if the
parent_id is included in the data that is passed to save if the
value doesn&#8217;t change, neither does the data structure. Therefore
the tree of data would now look like:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme fishing <strong>Updated</strong></li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Reports</p>
<blockquote>
<div><ul class="simple">
<li>Annual</li>
<li>Status</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Other People&#8217;s Categories</p>
</li>
</ul>
<p>Moving data around in your tree is also a simple affair. Let&#8217;s say
that Extreme fishing does not belong under Sport, but instead
should be located under Other People&#8217;s Categories. With the
following code:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// pseudo controller code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// id of Extreme fishing</span>
<span class="nv">$newParentId</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span>
  <span class="s1">&#39;id&#39;</span><span class="p">,</span>
  <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Other People\&#39;s Categories&#39;</span><span class="p">)</span>
<span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$newParentId</span><span class="p">));</span>
</pre></div>
</div>
<p>As would be expected the structure would be modified to:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Reports</p>
<blockquote>
<div><ul class="simple">
<li>Annual</li>
<li>Status</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Other People&#8217;s Categories</p>
<blockquote>
<div><ul class="simple">
<li>Extreme fishing <strong>Moved</strong></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="deleting-data">
<h3>Deleting data<a class="headerlink" href="#deleting-data" title="Permalink to this headline">¶</a></h3>
<p>The tree behavior provides a number of ways to manage deleting
data. To start with the simplest example; let&#8217;s say that the
reports category is no longer useful. To remove it
<em>and any children it may have</em> just call delete as you would for
any model. For example with the following code:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// pseudo controller code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</pre></div>
</div>
<p>The category tree would be modified as follows:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Friends</p>
<blockquote>
<div><ul class="simple">
<li>Gerald</li>
<li>Gwendolyn</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Work</p>
<blockquote>
<div><ul>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>National</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Other People&#8217;s Categories</p>
<blockquote>
<div><ul class="simple">
<li>Extreme fishing</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="querying-and-using-your-data">
<h3>Querying and using your data<a class="headerlink" href="#querying-and-using-your-data" title="Permalink to this headline">¶</a></h3>
<p>Using and manipulating hierarchical data can be a tricky business.
In addition to the core find methods, with the tree behavior there
are a few more tree-orientated permutations at your disposal.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most tree behavior methods return and rely on data being sorted by
the <code class="docutils literal"><span class="pre">lft</span></code> field. If you call <code class="docutils literal"><span class="pre">find()</span></code> and do not order by
<code class="docutils literal"><span class="pre">lft</span></code>, or call a tree behavior method and pass a sort order, you
may get undesirable results.</p>
</div>
<dl class="class">
<dt>
<em class="property">class </em><code class="descname">TreeBehavior</code></dt>
<dd><dl class="method">
<dt id="TreeBehavior::children">
<code class="descname">children</code><span class="sig-paren">(</span><em>$id = null</em>, <em>$direct = false</em>, <em>$fields = null</em>, <em>$order = null</em>, <em>$limit = null</em>, <em>$page = 1</em>, <em>$recursive = null</em><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::children" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$id</strong> &#8211; The ID of the record to look up</li>
<li><strong>$direct</strong> &#8211; Set to true to return only the direct descendants</li>
<li><strong>$fields</strong> &#8211; Single string field name or array of fields to include in the return</li>
<li><strong>$order</strong> &#8211; SQL string of ORDER BY conditions</li>
<li><strong>$limit</strong> &#8211; SQL LIMIT statement</li>
<li><strong>$page</strong> &#8211; for accessing paged results</li>
<li><strong>$recursive</strong> &#8211; Number of levels deep for recursive associated Models</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">children</span></code> method takes the primary key value (the id) of a
row and returns the children, by default in the order they appear
in the tree. The second optional parameter defines whether or not
only direct children should be returned. Using the example data
from the previous section:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$allChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// a flat array with 11 items</span>
<span class="c1">// -- or --</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$allChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">();</span> <span class="c1">// a flat array with 11 items</span>

<span class="c1">// Only return direct children</span>
<span class="nv">$directChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span> <span class="c1">// a flat array with</span>
                                                      <span class="c1">// 2 items</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you want a recursive array use <code class="docutils literal"><span class="pre">find('threaded')</span></code></p>
</div>
<dl class="method">
<dt id="TreeBehavior::childCount">
<code class="descname">childCount</code><span class="sig-paren">(</span><em>$id = null</em>, <em>$direct = false</em><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::childCount" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>As with the method <code class="docutils literal"><span class="pre">children</span></code>, <code class="docutils literal"><span class="pre">childCount</span></code> takes the primary
key value (the id) of a row and returns how many children it has.
The second optional parameter defines whether or not only direct
children are counted. Using the example data from the previous
section:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$totalChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">childCount</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// will output 11</span>
<span class="c1">// -- or --</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$directChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">childCount</span><span class="p">();</span> <span class="c1">// will output 11</span>

<span class="c1">// Only counts the direct descendants of this category</span>
<span class="nv">$numChildren</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">childCount</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span> <span class="c1">// will output 2</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::generateTreeList">
<code class="descname">generateTreeList</code><span class="sig-paren">(</span><em>$conditions=null</em>, <em>$keyPath=null</em>, <em>$valuePath=null</em>, <em>$spacer= '_'</em>, <em>$recursive=null</em><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::generateTreeList" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$conditions</strong> &#8211; Uses the same conditional options as find().</li>
<li><strong>$keyPath</strong> &#8211; Path to the field to use for the key, i.e. &#8220;{n}.Post.id&#8221;.</li>
<li><strong>$valuePath</strong> &#8211; Path to the field to use for the label, i.e.
&#8220;{n}.Post.title&#8221;.</li>
<li><strong>$spacer</strong> &#8211; The string to use in front of each item to indicate depth.</li>
<li><strong>$recursive</strong> &#8211; The number of levels deep to fetch associated records</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method will return data similar to
<a class="reference internal" href="../../models/retrieving-your-data.html#model-find-list"><span class="std std-ref">find(&#8216;list&#8217;)</span></a> but with a nested prefix that is specified
in the <code class="docutils literal"><span class="pre">spacer</span></code> option to show the structure of your data. Below is
an example of what you can expect this method to return:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$treelist</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">generateTreeList</span><span class="p">();</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">array</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;My Categories&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;_Fun&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;__Sport&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;___Surfing&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;___Skating&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;__Friends&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;___Gerald&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;___Gwendolyn&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;_Work&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;__Trips&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;___National&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;___International&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">&quot;Other People&#39;s Categories&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="s2">&quot;_Extreme fishing&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::formatTreeList">
<code class="descname">formatTreeList</code><span class="sig-paren">(</span><em>$results</em>, <em>$options=array()</em><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::formatTreeList" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="versionadded">
<p><span class="versionmodified">New in version 2.7.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$results</strong> &#8211; Results of a find(&#8216;all&#8217;) call.</li>
<li><strong>$options</strong> &#8211; Options to pass into.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method will return data similar to
<a class="reference internal" href="../../models/retrieving-your-data.html#model-find-list"><span class="std std-ref">find(&#8216;list&#8217;)</span></a> but with a nested prefix that is specified
in the <code class="docutils literal"><span class="pre">spacer</span></code> option to show the structure of your data.</p>
<p>Supported options are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">keyPath</span></code>: A string path to the key, i.e. &#8220;{n}.Post.id&#8221;.</li>
<li><code class="docutils literal"><span class="pre">valuePath</span></code>: A string path to the value, i.e. &#8220;{n}.Post.title&#8221;.</li>
<li><code class="docutils literal"><span class="pre">spacer</span></code>: The character or characters which will be repeated.</li>
</ul>
<p>An example would be:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$results</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">formatTreeList</span><span class="p">(</span><span class="nv">$results</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;spacer&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;--&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::getParentNode">
<code class="descname">getParentNode</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::getParentNode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This convenience function will, as the name suggests, return the
parent node for any node, or <em>false</em> if the node has no parent (it&#8217;s
the root node). For example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$parent</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">getParentNode</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">//&lt;- id for fun</span>
<span class="c1">// $parent contains All categories</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::getPath">
<code class="descname">getPath</code><span class="sig-paren">(</span><em>$id = null</em>, <em>$fields = null</em>, <em>$recursive = null</em><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::getPath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The &#8216;path&#8217; when referring to hierarchal data is how you get from
where you are to the top. So for example the path from the category
&#8220;International&#8221; is:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">...</p>
</li>
<li><p class="first">Work</p>
</li>
<li><p class="first">Trips</p>
<blockquote>
<div><ul class="simple">
<li>...</li>
<li>International</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Using the id of &#8220;International&#8221; getPath will return each of the
parents in turn (starting from the top).</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$parents</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">getPath</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// contents of $parents</span>
<span class="k">array</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;Category&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;My Categories&#39;</span><span class="p">,</span> <span class="o">..</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;Category&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Work&#39;</span><span class="p">,</span> <span class="o">..</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;Category&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Trips&#39;</span><span class="p">,</span> <span class="o">..</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=&gt;</span>  <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;Category&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;International&#39;</span><span class="p">,</span> <span class="o">..</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h2>
<p>The tree behavior doesn&#8217;t only work in the background, there are a
number of specific methods defined in the behavior to cater for all
your hierarchical data needs, and any unexpected problems that
might arise in the process.</p>
<dl class="method">
<dt id="TreeBehavior::moveDown">
<code class="descclassname">TreeBehavior::</code><code class="descname">moveDown</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::moveDown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Used to move a single node down the tree. You need to provide the
ID of the element to be moved and a positive number of how many
positions the node should be moved down. All child nodes for the
specified node will also be moved.</p>
<p>Here is an example of a controller action (in a controller named
Categories) that moves a specified node down the tree:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">movedown</span><span class="p">(</span><span class="nv">$id</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$delta</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">())</span> <span class="p">{</span>
       <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundException</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Invalid category&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">moveDown</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$delta</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Session</span><span class="o">-&gt;</span><span class="na">setFlash</span><span class="p">(</span>
          <span class="s1">&#39;Please provide the number of positions the field should be&#39;</span> <span class="o">.</span>
          <span class="s1">&#39;moved down.&#39;</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example, if you&#8217;d like to move the &#8220;Sport&#8221; ( id of 3 ) category one
position down, you would request: /categories/movedown/3/1.</p>
<dl class="method">
<dt id="TreeBehavior::moveUp">
<code class="descclassname">TreeBehavior::</code><code class="descname">moveUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::moveUp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Used to move a single node up the tree. You need to provide the ID
of the element to be moved and a positive number of how many
positions the node should be moved up. All child nodes will also be
moved.</p>
<p>Here&#8217;s an example of a controller action (in a controller named
Categories) that moves a node up the tree:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">moveup</span><span class="p">(</span><span class="nv">$id</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$delta</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">())</span> <span class="p">{</span>
       <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundException</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Invalid category&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">moveUp</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$delta</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Session</span><span class="o">-&gt;</span><span class="na">setFlash</span><span class="p">(</span>
          <span class="s1">&#39;Please provide a number of positions the category should&#39;</span> <span class="o">.</span>
          <span class="s1">&#39;be moved up.&#39;</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example, if you would like to move the category &#8220;Gwendolyn&#8221; ( id of 8 ) up
one position you would request /categories/moveup/8/1. Now
the order of Friends will be Gwendolyn, Gerald.</p>
<dl class="method">
<dt id="TreeBehavior::removeFromTree">
<code class="descclassname">TreeBehavior::</code><code class="descname">removeFromTree</code><span class="sig-paren">(</span><em>$id = null</em>, <em>$delete = false</em><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::removeFromTree" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Using this method will either delete or move a node but retain its
sub-tree, which will be reparented one level higher. It offers more
control than <a class="reference internal" href="../../models/deleting-data.html#model-delete"><span class="std std-ref">delete</span></a>, which for a model
using the tree behavior will remove the specified node and all of
its children.</p>
<p>Taking the following tree as a starting point:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul>
<li><p class="first">Sport</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Running the following code with the id for &#8216;Sport&#8217;:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Node</span><span class="o">-&gt;</span><span class="na">removeFromTree</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</pre></div>
</div>
<p>The Sport node will be become a top level node:</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Sport <strong>Moved</strong></p>
</li>
</ul>
<p>This demonstrates the default behavior of <code class="docutils literal"><span class="pre">removeFromTree</span></code> of
moving the node to have no parent, and re-parenting all children.</p>
<p>If however the following code snippet was used with the id for
&#8216;Sport&#8217;:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Node</span><span class="o">-&gt;</span><span class="na">removeFromTree</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<p>The tree would become</p>
<ul>
<li><p class="first">My Categories</p>
<blockquote>
<div><ul>
<li><p class="first">Fun</p>
<blockquote>
<div><ul class="simple">
<li>Surfing</li>
<li>Extreme knitting</li>
<li>Skating</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>This demonstrates the alternate use for <code class="docutils literal"><span class="pre">removeFromTree</span></code>, the
children have been reparented and &#8216;Sport&#8217; has been deleted.</p>
<dl class="method">
<dt id="TreeBehavior::reorder">
<code class="descclassname">TreeBehavior::</code><code class="descname">reorder</code><span class="sig-paren">(</span><em>array('id' =&gt; null</em>, <em>'field' =&gt; $Model-&gt;displayField</em>, <em>'order' =&gt; 'ASC'</em>, <em>'verify' =&gt; true)</em><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::reorder" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Reorders the nodes (and child nodes) of the tree according to the
field and direction specified in the parameters. This method does
not change the parent of any node.</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">reorder</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="c1">//id of record to use as top node for reordering, default: $Model-&gt;id</span>
    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="p">,</span>
    <span class="c1">//which field to use in reordering, default: $Model-&gt;displayField</span>
    <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="p">,</span>
    <span class="c1">//direction to order, default: &#39;ASC&#39;</span>
    <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="p">,</span>
    <span class="c1">//whether or not to verify the tree before reorder, default: true</span>
    <span class="s1">&#39;verify&#39;</span> <span class="o">=&gt;</span>
<span class="p">));</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have saved your data or made other operations on the model,
you might want to set <code class="docutils literal"><span class="pre">$model-&gt;id</span> <span class="pre">=</span> <span class="pre">null</span></code> before calling
<code class="docutils literal"><span class="pre">reorder</span></code>. Otherwise only the current node and it&#8217;s children will
be reordered.</p>
</div>
</div>
<div class="section" id="data-integrity">
<h2>Data Integrity<a class="headerlink" href="#data-integrity" title="Permalink to this headline">¶</a></h2>
<p>Due to the nature of complex self referential data structures such
as trees and linked lists, they can occasionally become broken by a
careless call. Take heart, for all is not lost! The Tree Behavior
contains several previously undocumented features designed to
recover from such situations.</p>
<dl class="method">
<dt id="TreeBehavior::recover">
<code class="descclassname">TreeBehavior::</code><code class="descname">recover</code><span class="sig-paren">(</span><em>$mode = 'parent'</em>, <em>$missingParentAction = null</em><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::recover" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <code class="docutils literal"><span class="pre">mode</span></code> parameter is used to specify the source of info that
is valid/correct. The opposite source of data will be populated
based upon that source of info. E.g. if the MPTT fields are corrupt
or empty, with the <code class="docutils literal"><span class="pre">$mode</span> <span class="pre">'parent'</span></code> the values of the
<code class="docutils literal"><span class="pre">parent_id</span></code> field will be used to populate the left and right
fields. The <code class="docutils literal"><span class="pre">missingParentAction</span></code> parameter only applies to
&#8220;parent&#8221; mode and determines what to do if the parent field
contains an id that is not present.</p>
<p>Available <code class="docutils literal"><span class="pre">$mode</span></code> options:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">'parent'</span></code> - use the existing <code class="docutils literal"><span class="pre">parent_id</span></code>&#8216;s to update the
<code class="docutils literal"><span class="pre">lft</span></code> and <code class="docutils literal"><span class="pre">rght</span></code> fields</li>
<li><code class="docutils literal"><span class="pre">'tree'</span></code> - use the existing <code class="docutils literal"><span class="pre">lft</span></code> and <code class="docutils literal"><span class="pre">rght</span></code> fields to
update <code class="docutils literal"><span class="pre">parent_id</span></code></li>
</ul>
<p>Available <code class="docutils literal"><span class="pre">missingParentActions</span></code> options when using
<code class="docutils literal"><span class="pre">mode='parent'</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">null</span></code> - do nothing and carry on</li>
<li><code class="docutils literal"><span class="pre">'return'</span></code> - do nothing and return</li>
<li><code class="docutils literal"><span class="pre">'delete'</span></code> - delete the node</li>
<li><code class="docutils literal"><span class="pre">int</span></code> - set the parent_id to this id</li>
</ul>
<p>Example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Rebuild all the left and right fields based on the parent_id</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">recover</span><span class="p">();</span>
<span class="c1">// or</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">recover</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">);</span>

<span class="c1">// Rebuild all the parent_id&#39;s based on the lft and rght fields</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">recover</span><span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="method">
<dt>
<code class="descclassname">TreeBehavior::</code><code class="descname">reorder</code><span class="sig-paren">(</span><em>$options = array()</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<p>Reorders the nodes (and child nodes) of the tree according to the
field and direction specified in the parameters. This method does
not change the parent of any node.</p>
<p>Reordering affects all nodes in the tree by default, however the
following options can affect the process:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">'id'</span></code> - only reorder nodes below this node.</li>
<li><code class="docutils literal"><span class="pre">'field</span></code>&#8216; - field to use for sorting, default is the
<code class="docutils literal"><span class="pre">displayField</span></code> for the model.</li>
<li><code class="docutils literal"><span class="pre">'order'</span></code> - <code class="docutils literal"><span class="pre">'ASC'</span></code> for ascending, <code class="docutils literal"><span class="pre">'DESC'</span></code> for descending
sort.</li>
<li><code class="docutils literal"><span class="pre">'verify'</span></code> - whether or not to verify the tree prior to
resorting.</li>
</ul>
<p><code class="docutils literal"><span class="pre">$options</span></code> is used to pass all extra parameters, and has the
following possible keys by default, all of which are optional:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
    <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">displayField</span><span class="p">,</span>
    <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ASC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;verify&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::verify">
<code class="descclassname">TreeBehavior::</code><code class="descname">verify</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::verify" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Returns <code class="docutils literal"><span class="pre">true</span></code> if the tree is valid otherwise an array of errors,
with fields for type, incorrect index and message.</p>
<p>Each record in the output array is an array of the form (type, id,
message)</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">type</span></code> is either <code class="docutils literal"><span class="pre">'index'</span></code> or <code class="docutils literal"><span class="pre">'node'</span></code></li>
<li><code class="docutils literal"><span class="pre">'id'</span></code> is the id of the erroneous node.</li>
<li><code class="docutils literal"><span class="pre">'message'</span></code> depends on the error</li>
</ul>
<p>Example Use:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Category</span><span class="o">-&gt;</span><span class="na">verify</span><span class="p">();</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">node</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">3</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">left</span> <span class="k">and</span> <span class="nx">right</span> <span class="nx">values</span> <span class="nx">identical</span>
        <span class="p">)</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">node</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">2</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">The</span> <span class="k">parent</span> <span class="nx">node</span> <span class="mi">999</span> <span class="nx">doesn</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">exist</span>
        <span class="p">)</span>
    <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">index</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">123</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">missing</span>
        <span class="p">)</span>
    <span class="p">[</span><span class="mi">99</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">node</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">163</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nx">left</span> <span class="nx">greater</span> <span class="nx">than</span> <span class="nx">right</span>
        <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="node-level-depth">
<h2>Node Level (Depth)<a class="headerlink" href="#node-level-depth" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.7.</span></p>
</div>
<p>Knowing the depth of tree nodes can be useful when you want to retrieve nodes
only upto a certain level for e.g. when generating menus. You can use the
<code class="docutils literal"><span class="pre">level</span></code> option to specify the field that will save level of each node:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nv">$actAs</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Tree&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;level&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="c1">// Defaults to null, i.e. no level saving</span>
<span class="p">));</span>
</pre></div>
</div>
<dl class="method">
<dt id="TreeBehavior::getLevel">
<code class="descclassname">TreeBehavior::</code><code class="descname">getLevel</code><span class="sig-paren">(</span><em>$id</em><span class="sig-paren">)</span><a class="headerlink" href="#TreeBehavior::getLevel" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="versionadded">
<p><span class="versionmodified">New in version 2.7.</span></p>
</div>
<p>If you are not caching the level of nodes using the <code class="docutils literal"><span class="pre">level</span></code> option in settings,
you can use this method to get level of a particular node.</p>
</div>
</div>


			</div>
		</div>

		
		<div class="col-md-3 col-md-pull-9 pull-off hidden-xs hidden-sm" lang="en">
			<aside class="sidebar">
				<div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cakephp-overview.html">CakePHP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">Models</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../core-libraries.html">Core Libraries</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../toc-general-purpose.html">General Purpose</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../global-constants-and-functions.html">Global Constants and Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core-utility-libraries/app.html">App Class</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../events.html">Events System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collections.html">Collections</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../toc-behaviors.html">Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../toc-components.html">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../toc-helpers.html">Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../toc-utilities.html">Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../console-and-shells.html">Shells, Tasks &amp; Console Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices.html">Appendices</a></li>
</ul>

</div>

				</div>
			</aside>
			<aside class="sidebar">
				<div class="mb30 row">
				</div>
			</aside>
		</div>
	</div>
</div>

<section id="socials" class="back-3">
	<div class="container-fluid">
		<div class="row">
			<div class="col-xs-12 col-sm-12 col-md-4  social text-center">
				<div class="col-sm-3 col-xs-3">
					<div id="fb-root"></div>
						<script>(function(d, s, id) {
						  var js, fjs = d.getElementsByTagName(s)[0];
						  if (d.getElementById(id)) return;
						  js = d.createElement(s); js.id = id;
						  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
						  fjs.parentNode.insertBefore(js, fjs);
						}(document, 'script', 'facebook-jssdk'));
						</script>
						<div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
				</div>

				<div class="col-sm-3 col-xs-3">
					<iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
				</div>

				<div class="col-sm-3 col-xs-3">
					<iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
				</div>

				<div class="col-sm-3 col-xs-3">
					<a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
				</div>
			</div>

			<div class="col-xs-12 col-sm-12 col-md-8 social-footer text-center ">
				<a href="#">发现翻译错误? 请在下面留言</a>
				<a href="https://github.com/blackpuppy/docs/wiki" target="_blank">我要加入翻译</a>
				<a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
				<a href="http://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
				<a href="http://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
				<a href="http://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
				<a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
				<a href="http://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
				<a href="http://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
				<a href="http://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
			</div>
		</div>
	</div>
</section>

<footer id="footer" class="footer-wrapper">
	<div class="container">

		<div class="row col-p30">
			<div class="col-sm-12 col-md-3">
				<div class="footer-widget t-footer">
					<div class="col-md-12">
						<a href="https://www.openhub.net/p/cakephp">
							<img src="../../_static/open-hub.png">
						</a>
						<div class="mt10">
							<a href="https://www.rackspace.com/">
								<img src="../../_static/rackspace.png">
							</a>
						</div>
					</div>
				</div>
			</div>

			<div class="col-sm-12 col-md-9">
				<div class="col-md-3 col-sm-6 business-solution">
					<ul class="footer-menu">
						<li class="menu-title">
	<a href="http://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
	<a href="http://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
					</ul>
				</div>

				<div class="col-md-3 col-sm-6">
					<ul class="footer-menu">
						
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="http://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>CookBook</a></li>
<li><a href="http://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="http://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="http://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="http://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
					</ul>
				</div>

				<div class="col-md-3 col-sm-6">
					<ul class="footer-menu">
						
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="http://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="http://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="http://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="http://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="http://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="http://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="http://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
					</ul>
				</div>

				<div class="col-md-3 col-sm-6">
					<ul class="footer-menu">
						
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="http://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="http://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="http://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="http://cakedc.com"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
					</ul>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 text-center mt30">
				<p class="copyright">
							&copy; Copyright 2016, Cake Software Foundation, Inc.
						Last updated on Aug 12, 2016.
						Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
				</p>
			</div>
		</div>
	</div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-743287-3']);
	_gaq.push(['_trackPageview']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F201cbc61deaf9f7ffb521fb23e83db40' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"cakephpchina"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
  </body>
</html>